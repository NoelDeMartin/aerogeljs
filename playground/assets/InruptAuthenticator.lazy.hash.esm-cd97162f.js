import{g as Pi,c as Ti}from"./index-c424c1b1.js";const Tn=crypto,kn=s=>s instanceof CryptoKey,Bt=new TextEncoder,hn=new TextDecoder;function ki(...s){const n=s.reduce((c,{length:v})=>c+v,0),u=new Uint8Array(n);let o=0;for(const c of s)u.set(c,o),o+=c.length;return u}const Ri=s=>{let n=s;typeof n=="string"&&(n=Bt.encode(n));const u=32768,o=[];for(let c=0;c<n.length;c+=u)o.push(String.fromCharCode.apply(null,n.subarray(c,c+u)));return btoa(o.join(""))},xr=s=>Ri(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");let Mr=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(n){var u;super(n),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(u=Error.captureStackTrace)==null||u.call(Error,this,this.constructor)}},Rn=class extends Mr{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Qt=class extends Mr{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Ci=class extends Mr{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};function Pt(s,n="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${n} must be ${s}`)}function ur(s,n){return s.name===n}function Pr(s){return parseInt(s.name.slice(4),10)}function Ii(s){switch(s){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ui(s,n){if(n.length&&!n.some(u=>s.usages.includes(u))){let u="CryptoKey does not support this operation, its usages must include ";if(n.length>2){const o=n.pop();u+=`one of ${n.join(", ")}, or ${o}.`}else n.length===2?u+=`one of ${n[0]} or ${n[1]}.`:u+=`${n[0]}.`;throw new TypeError(u)}}function Di(s,n,...u){switch(n){case"HS256":case"HS384":case"HS512":{if(!ur(s.algorithm,"HMAC"))throw Pt("HMAC");const o=parseInt(n.slice(2),10);if(Pr(s.algorithm.hash)!==o)throw Pt(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ur(s.algorithm,"RSASSA-PKCS1-v1_5"))throw Pt("RSASSA-PKCS1-v1_5");const o=parseInt(n.slice(2),10);if(Pr(s.algorithm.hash)!==o)throw Pt(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ur(s.algorithm,"RSA-PSS"))throw Pt("RSA-PSS");const o=parseInt(n.slice(2),10);if(Pr(s.algorithm.hash)!==o)throw Pt(`SHA-${o}`,"algorithm.hash");break}case"EdDSA":{if(s.algorithm.name!=="Ed25519"&&s.algorithm.name!=="Ed448")throw Pt("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!ur(s.algorithm,"ECDSA"))throw Pt("ECDSA");const o=Ii(n);if(s.algorithm.namedCurve!==o)throw Pt(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ui(s,u)}function Cn(s,n,...u){var o;if(u.length>2){const c=u.pop();s+=`one of type ${u.join(", ")}, or ${c}.`}else u.length===2?s+=`one of type ${u[0]} or ${u[1]}.`:s+=`of type ${u[0]}.`;return n==null?s+=` Received ${n}`:typeof n=="function"&&n.name?s+=` Received function ${n.name}`:typeof n=="object"&&n!=null&&(o=n.constructor)!=null&&o.name&&(s+=` Received an instance of ${n.constructor.name}`),s}const ln=(s,...n)=>Cn("Key must be ",s,...n);function In(s,n,...u){return Cn(`Key for the ${s} algorithm must be `,n,...u)}const Un=s=>kn(s),wt=["CryptoKey"],Li=(...s)=>{const n=s.filter(Boolean);if(n.length===0||n.length===1)return!0;let u;for(const o of n){const c=Object.keys(o);if(!u||u.size===0){u=new Set(c);continue}for(const v of c){if(u.has(v))return!1;u.add(v)}}return!0};function Ni(s){return typeof s=="object"&&s!==null}function Oi(s){if(!Ni(s)||Object.prototype.toString.call(s)!=="[object Object]")return!1;if(Object.getPrototypeOf(s)===null)return!0;let n=s;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(s)===n}const Hi=(s,n)=>{if(s.startsWith("RS")||s.startsWith("PS")){const{modulusLength:u}=n.algorithm;if(typeof u!="number"||u<2048)throw new TypeError(`${s} requires key modulusLength to be 2048 bits or larger`)}},Mi=(s,n)=>{if(!(n instanceof Uint8Array)){if(!Un(n))throw new TypeError(In(s,n,...wt,"Uint8Array"));if(n.type!=="secret")throw new TypeError(`${wt.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},Bi=(s,n,u)=>{if(!Un(n))throw new TypeError(In(s,n,...wt));if(n.type==="secret")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(u==="sign"&&n.type==="public")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(u==="decrypt"&&n.type==="public")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(n.algorithm&&u==="verify"&&n.type==="private")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(n.algorithm&&u==="encrypt"&&n.type==="private")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},ji=(s,n,u)=>{s.startsWith("HS")||s==="dir"||s.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(s)?Mi(s,n):Bi(s,n,u)};function Ki(s,n,u,o,c){if(c.crit!==void 0&&(o==null?void 0:o.crit)===void 0)throw new s('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(l=>typeof l!="string"||l.length===0))throw new s('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let v;u!==void 0?v=new Map([...Object.entries(u),...n.entries()]):v=n;for(const l of o.crit){if(!v.has(l))throw new Rn(`Extension Header Parameter "${l}" is not recognized`);if(c[l]===void 0)throw new s(`Extension Header Parameter "${l}" is missing`);if(v.get(l)&&o[l]===void 0)throw new s(`Extension Header Parameter "${l}" MUST be integrity protected`)}return new Set(o.crit)}function Vi(s,n){const u=`SHA-${s.slice(-3)}`;switch(s){case"HS256":case"HS384":case"HS512":return{hash:u,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:u,name:"RSA-PSS",saltLength:s.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:u,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:u,name:"ECDSA",namedCurve:n.namedCurve};case"EdDSA":return{name:n.name};default:throw new Rn(`alg ${s} is not supported either by JOSE or your javascript runtime`)}}function Ji(s,n,u){if(kn(n))return Di(n,s,u),n;if(n instanceof Uint8Array){if(!s.startsWith("HS"))throw new TypeError(ln(n,...wt));return Tn.subtle.importKey("raw",n,{hash:`SHA-${s.slice(-3)}`,name:"HMAC"},!1,[u])}throw new TypeError(ln(n,...wt,"Uint8Array"))}const Dt=s=>Math.floor(s.getTime()/1e3),Dn=60,Ln=Dn*60,Br=Ln*24,Wi=Br*7,qi=Br*365.25,$i=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Tr=s=>{const n=$i.exec(s);if(!n||n[4]&&n[1])throw new TypeError("Invalid time period format");const u=parseFloat(n[2]),o=n[3].toLowerCase();let c;switch(o){case"sec":case"secs":case"second":case"seconds":case"s":c=Math.round(u);break;case"minute":case"minutes":case"min":case"mins":case"m":c=Math.round(u*Dn);break;case"hour":case"hours":case"hr":case"hrs":case"h":c=Math.round(u*Ln);break;case"day":case"days":case"d":c=Math.round(u*Br);break;case"week":case"weeks":case"w":c=Math.round(u*Wi);break;default:c=Math.round(u*qi);break}return n[1]==="-"||n[4]==="ago"?-c:c},zi=async(s,n,u)=>{const o=await Ji(s,n,"sign");Hi(s,o);const c=await Tn.subtle.sign(Vi(s,o.algorithm),o,u);return new Uint8Array(c)};let Gi=class{constructor(n){if(!(n instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=n}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}async sign(n,u){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Qt("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Li(this._protectedHeader,this._unprotectedHeader))throw new Qt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader},c=Ki(Qt,new Map([["b64",!0]]),u==null?void 0:u.crit,this._protectedHeader,o);let v=!0;if(c.has("b64")&&(v=this._protectedHeader.b64,typeof v!="boolean"))throw new Qt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:l}=o;if(typeof l!="string"||!l)throw new Qt('JWS "alg" (Algorithm) Header Parameter missing or invalid');ji(l,n,"sign");let w=this._payload;v&&(w=Bt.encode(xr(w)));let S;this._protectedHeader?S=Bt.encode(xr(JSON.stringify(this._protectedHeader))):S=Bt.encode("");const d=ki(S,Bt.encode("."),w),f=await zi(l,n,d),h={signature:xr(f),payload:""};return v&&(h.payload=hn.decode(w)),this._unprotectedHeader&&(h.header=this._unprotectedHeader),this._protectedHeader&&(h.protected=hn.decode(S)),h}},Yi=class{constructor(n){this._flattened=new Gi(n)}setProtectedHeader(n){return this._flattened.setProtectedHeader(n),this}async sign(n,u){const o=await this._flattened.sign(n,u);if(o.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}};function Lt(s,n){if(!Number.isFinite(n))throw new TypeError(`Invalid ${s} input`);return n}let Xi=class{constructor(n={}){if(!Oi(n))throw new TypeError("JWT Claims Set MUST be an object");this._payload=n}setIssuer(n){return this._payload={...this._payload,iss:n},this}setSubject(n){return this._payload={...this._payload,sub:n},this}setAudience(n){return this._payload={...this._payload,aud:n},this}setJti(n){return this._payload={...this._payload,jti:n},this}setNotBefore(n){return typeof n=="number"?this._payload={...this._payload,nbf:Lt("setNotBefore",n)}:n instanceof Date?this._payload={...this._payload,nbf:Lt("setNotBefore",Dt(n))}:this._payload={...this._payload,nbf:Dt(new Date)+Tr(n)},this}setExpirationTime(n){return typeof n=="number"?this._payload={...this._payload,exp:Lt("setExpirationTime",n)}:n instanceof Date?this._payload={...this._payload,exp:Lt("setExpirationTime",Dt(n))}:this._payload={...this._payload,exp:Dt(new Date)+Tr(n)},this}setIssuedAt(n){return typeof n>"u"?this._payload={...this._payload,iat:Dt(new Date)}:n instanceof Date?this._payload={...this._payload,iat:Lt("setIssuedAt",Dt(n))}:typeof n=="string"?this._payload={...this._payload,iat:Lt("setIssuedAt",Dt(new Date)+Tr(n))}:this._payload={...this._payload,iat:Lt("setIssuedAt",n)},this}},Qi=class extends Xi{setProtectedHeader(n){return this._protectedHeader=n,this}async sign(n,u){var c;const o=new Yi(Bt.encode(JSON.stringify(this._payload)));if(o.setProtectedHeader(this._protectedHeader),Array.isArray((c=this._protectedHeader)==null?void 0:c.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Ci("JWTs MUST NOT use unencoded payload");return o.sign(n,u)}},cr;const Zi=new Uint8Array(16);function eo(){if(!cr&&(cr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!cr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cr(Zi)}const We=[];for(let s=0;s<256;++s)We.push((s+256).toString(16).slice(1));function to(s,n=0){return We[s[n+0]]+We[s[n+1]]+We[s[n+2]]+We[s[n+3]]+"-"+We[s[n+4]]+We[s[n+5]]+"-"+We[s[n+6]]+We[s[n+7]]+"-"+We[s[n+8]]+We[s[n+9]]+"-"+We[s[n+10]]+We[s[n+11]]+We[s[n+12]]+We[s[n+13]]+We[s[n+14]]+We[s[n+15]]}const ro=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),dn={randomUUID:ro};function jr(s,n,u){if(dn.randomUUID&&!n&&!s)return dn.randomUUID();s=s||{};const o=s.random||(s.rng||eo)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,n){u=u||0;for(let c=0;c<16;++c)n[u+c]=o[c];return n}return to(o)}const Nn="solidClientAuthn:",no=["ES256","RS256"],je={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"},fn=5,io="openid",oo="offline_access",so="webid",ao=[io,oo,so].join(" ");class uo{constructor(n){this.handleables=n,this.handleables=n}async getProperHandler(n){const u=await Promise.all(this.handleables.map(o=>o.canHandle(...n)));for(let o=0;o<u.length;o+=1)if(u[o])return this.handleables[o];return null}async canHandle(...n){return await this.getProperHandler(n)!==null}async handle(...n){const u=await this.getProperHandler(n);if(u)return u.handle(...n);throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${n.map(o=>{try{return JSON.stringify(o)}catch{return o.toString()}}).join(", ")}`)}}function On(s){try{const n=new URL(s),u=!n.searchParams.has("code")&&!n.searchParams.has("state"),o=n.hash==="";return u&&o}catch{return!1}}function co(s){const n=new URL(s);return n.searchParams.delete("state"),n.searchParams.delete("code"),n.searchParams.delete("error"),n.searchParams.delete("error_description"),n.searchParams.delete("iss"),n}class ho{constructor(n,u){this.storageUtility=n,this.redirector=u,this.parametersGuard=o=>o.issuerConfiguration.grantTypesSupported!==void 0&&o.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1&&o.redirectUrl!==void 0,this.storageUtility=n,this.redirector=u}async canHandle(n){return this.parametersGuard(n)}async handleRedirect({oidcLoginOptions:n,state:u,codeVerifier:o,targetUrl:c}){if(!this.parametersGuard(n))throw new Error("The authorization code grant requires a redirectUrl.");await Promise.all([this.storageUtility.setForUser(u,{sessionId:n.sessionId}),this.storageUtility.setForUser(n.sessionId,{codeVerifier:o,issuer:n.issuer.toString(),redirectUrl:n.redirectUrl,dpop:n.dpop?"true":"false"})]),this.redirector.redirect(c,{handleRedirect:n.handleRedirect})}}class lo{constructor(n){this.sessionInfoManager=n,this.sessionInfoManager=n}async canHandle(){return!0}async handle(n){await this.sessionInfoManager.clear(n)}}class fo{constructor(n){this.redirector=n,this.redirector=n}async canHandle(n,u){return(u==null?void 0:u.logoutType)==="idp"}async handle(n,u){if((u==null?void 0:u.logoutType)!=="idp")throw new Error("Attempting to call idp logout handler to perform app logout");if(u.toLogoutUrl===void 0)throw new Error("Cannot perform IDP logout. Did you log in using the OIDC authentication flow?");this.redirector.redirect(u.toLogoutUrl(u),{handleRedirect:u.handleRedirect})}}class go{constructor(n,u){this.handlers=[new lo(n),new fo(u)]}async canHandle(){return!0}async handle(n,u){for(const o of this.handlers)await o.canHandle(n,u)&&await o.handle(n,u)}}function Hn(){return{isLoggedIn:!1,sessionId:jr(),fetch:(...s)=>fetch(...s)}}async function Mn(s,n){await Promise.all([n.deleteAllUserData(s,{secure:!1}),n.deleteAllUserData(s,{secure:!0})])}class po{constructor(n){this.storageUtility=n,this.storageUtility=n}update(n,u){throw new Error("Not Implemented")}get(n){throw new Error("Not implemented")}async getAll(){throw new Error("Not implemented")}async clear(n){return Mn(n,this.storageUtility)}async register(n){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}}function yo({endSessionEndpoint:s,idTokenHint:n,postLogoutRedirectUri:u,state:o}){const c=new URL(s);return n!==void 0&&c.searchParams.append("id_token_hint",n),u!==void 0&&(c.searchParams.append("post_logout_redirect_uri",u),o!==void 0&&c.searchParams.append("state",o)),c.toString()}function vo({endSessionEndpoint:s,idTokenHint:n}){if(s!==void 0)return function({state:o,postLogoutUrl:c}){return yo({endSessionEndpoint:s,idTokenHint:n,state:o,postLogoutRedirectUri:c})}}function mo(s){return typeof s=="string"&&["DPoP","Bearer"].includes(s)}function Bn(s){try{return new URL(s),!0}catch{return!1}}function _o(s){return s.clientId!==void 0&&!Bn(s.clientId)}function So(s,n){return n.scopesSupported.includes("webid")&&s.clientId!==void 0&&Bn(s.clientId)}function wo(s){return typeof s=="string"&&["dynamic","static","solid-oidc"].includes(s)}async function bo(s,n,u,o){let c;if(So(s,n))c={clientId:s.clientId,clientName:s.clientName,clientType:"solid-oidc"};else if(_o(s))c={clientId:s.clientId,clientSecret:s.clientSecret,clientName:s.clientName,clientType:"static"};else return o.getClient({sessionId:s.sessionId,clientName:s.clientName,redirectUrl:s.redirectUrl},n);const v={clientId:c.clientId,clientType:c.clientType};return c.clientType==="static"&&(v.clientSecret=c.clientSecret),c.clientName&&(v.clientName=c.clientName),await u.setForUser(s.sessionId,v),c}const gn=(s,n)=>fetch(s,n);let Eo=class{constructor(n,u,o,c,v){this.loginHandler=n,this.redirectHandler=u,this.logoutHandler=o,this.sessionInfoManager=c,this.issuerConfigFetcher=v,this.fetch=gn,this.logout=async(l,w)=>{await this.logoutHandler.handle(l,(w==null?void 0:w.logoutType)==="idp"?{...w,toLogoutUrl:this.boundLogout}:w),this.fetch=gn,delete this.boundLogout},this.getSessionInfo=async l=>this.sessionInfoManager.get(l),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.loginHandler=n,this.redirectHandler=u,this.logoutHandler=o,this.sessionInfoManager=c,this.issuerConfigFetcher=v}};async function jn(s,n,u){try{const[o,c,v,l]=await Promise.all([n.getForUser(s,"issuer",{errorIfNull:!0}),n.getForUser(s,"codeVerifier"),n.getForUser(s,"redirectUrl"),n.getForUser(s,"dpop",{errorIfNull:!0})]);await n.deleteForUser(s,"codeVerifier");const w=await u.fetchConfig(o);return{codeVerifier:c,redirectUrl:v,issuerConfig:w,dpop:l==="true"}}catch(o){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${s}]: ${o}`)}}class Fo{constructor(n,u){this.secureStorage=n,this.insecureStorage=u,this.secureStorage=n,this.insecureStorage=u}getKey(n){return`solidClientAuthenticationUser:${n}`}async getUserData(n,u){const o=await(u?this.secureStorage:this.insecureStorage).get(this.getKey(n));if(o===void 0)return{};try{return JSON.parse(o)}catch{throw new Error(`Data for user [${n}] in [${u?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${o}`)}}async setUserData(n,u,o){await(o?this.secureStorage:this.insecureStorage).set(this.getKey(n),JSON.stringify(u))}async get(n,u){const o=await(u!=null&&u.secure?this.secureStorage:this.insecureStorage).get(n);if(o===void 0&&(u!=null&&u.errorIfNull))throw new Error(`[${n}] is not stored`);return o}async set(n,u,o){return(o!=null&&o.secure?this.secureStorage:this.insecureStorage).set(n,u)}async delete(n,u){return(u!=null&&u.secure?this.secureStorage:this.insecureStorage).delete(n)}async getForUser(n,u,o){const c=await this.getUserData(n,o==null?void 0:o.secure);let v;if((!c||!c[u])&&(v=void 0),v=c[u],v===void 0&&(o!=null&&o.errorIfNull))throw new Error(`Field [${u}] for user [${n}] is not stored`);return v||void 0}async setForUser(n,u,o){let c;try{c=await this.getUserData(n,o==null?void 0:o.secure)}catch{c={}}await this.setUserData(n,{...c,...u},o==null?void 0:o.secure)}async deleteForUser(n,u,o){const c=await this.getUserData(n,o==null?void 0:o.secure);delete c[u],await this.setUserData(n,c,o==null?void 0:o.secure)}async deleteAllUserData(n,u){await(u!=null&&u.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(n))}}class Ao{constructor(){this.map={}}async get(n){return this.map[n]||void 0}async set(n,u){this.map[n]=u}async delete(n){delete this.map[n]}}class Dr extends Error{constructor(n){super(n)}}let xo=class extends Error{constructor(n){super(`Invalid response from OIDC provider: missing fields ${n}`),this.missingFields=n}},Po=class extends Error{constructor(n,u,o){super(n),this.error=u,this.errorDescription=o}};function To(s){const n=new URL(s);return new URL(n.pathname,n.origin).toString()}async function ko(s,n,u){return new Qi({htu:To(s),htm:n.toUpperCase(),jti:jr()}).setProtectedHeader({alg:no[0],jwk:u.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(u.privateKey,{})}const Kn=600;function Ro(s){return[401,403].includes(s)}async function Co(s,n,u,o){var c;const v=new Headers(o==null?void 0:o.headers);return v.set("Authorization",`DPoP ${n}`),v.set("DPoP",await ko(s,(c=o==null?void 0:o.method)!==null&&c!==void 0?c:"get",u)),{...o,headers:v}}async function Io(s,n,u,o){if(u!==void 0)return Co(s,n,u,o);const c=new Headers(o==null?void 0:o.headers);return c.set("Authorization",`Bearer ${n}`),{...o,headers:c}}async function pn(s,n,u,o){return fetch(n,await Io(n.toString(),s,o,u))}async function Uo(s,n,u){var o;const c=await s.tokenRefresher.refresh(s.sessionId,s.refreshToken,n);return u==null||u.emit(je.SESSION_EXTENDED,(o=c.expiresIn)!==null&&o!==void 0?o:Kn),typeof c.refreshToken=="string"&&(u==null||u.emit(je.NEW_REFRESH_TOKEN,c.refreshToken)),{accessToken:c.accessToken,refreshToken:c.refreshToken,expiresIn:c.expiresIn}}const kr=s=>s!==void 0?s-fn>0?s-fn:s:Kn;async function Do(s,n){var u;let o=s,c;const v=n==null?void 0:n.refreshOptions;if(v!==void 0){const l=async()=>{var w,S,d,f;try{const{accessToken:h,refreshToken:b,expiresIn:I}=await Uo(v,n.dpopKey,n.eventEmitter);o=h,b!==void 0&&(v.refreshToken=b),clearTimeout(c),c=setTimeout(l,kr(I)*1e3),(w=n.eventEmitter)===null||w===void 0||w.emit(je.TIMEOUT_SET,c)}catch(h){h instanceof Po&&((S=n==null?void 0:n.eventEmitter)===null||S===void 0||S.emit(je.ERROR,h.error,h.errorDescription),(d=n==null?void 0:n.eventEmitter)===null||d===void 0||d.emit(je.SESSION_EXPIRED)),h instanceof xo&&h.missingFields.includes("access_token")&&((f=n==null?void 0:n.eventEmitter)===null||f===void 0||f.emit(je.SESSION_EXPIRED))}};c=setTimeout(l,kr(n.expiresIn)*1e3),(u=n.eventEmitter)===null||u===void 0||u.emit(je.TIMEOUT_SET,c)}else if(n!==void 0&&n.eventEmitter!==void 0){const l=setTimeout(()=>{n.eventEmitter.emit(je.SESSION_EXPIRED)},kr(n.expiresIn)*1e3);n.eventEmitter.emit(je.TIMEOUT_SET,l)}return async(l,w)=>{let S=await pn(o,l,w,n==null?void 0:n.dpopKey);const d=!S.ok&&!Ro(S.status);return S.ok||d||S.url!==l&&(n==null?void 0:n.dpopKey)!==void 0&&(S=await pn(o,S.url,w,n.dpopKey)),S}}var Kr={exports:{}},jt=typeof Reflect=="object"?Reflect:null,yn=jt&&typeof jt.apply=="function"?jt.apply:function(n,u,o){return Function.prototype.apply.call(n,u,o)},gr;jt&&typeof jt.ownKeys=="function"?gr=jt.ownKeys:Object.getOwnPropertySymbols?gr=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:gr=function(n){return Object.getOwnPropertyNames(n)};function Lo(s){console&&console.warn&&console.warn(s)}var Vn=Number.isNaN||function(n){return n!==n};function be(){be.init.call(this)}Kr.exports=be;Kr.exports.once=Mo;be.EventEmitter=be;be.prototype._events=void 0;be.prototype._eventsCount=0;be.prototype._maxListeners=void 0;var vn=10;function mr(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(be,"defaultMaxListeners",{enumerable:!0,get:function(){return vn},set:function(s){if(typeof s!="number"||s<0||Vn(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");vn=s}});be.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};be.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||Vn(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Jn(s){return s._maxListeners===void 0?be.defaultMaxListeners:s._maxListeners}be.prototype.getMaxListeners=function(){return Jn(this)};be.prototype.emit=function(n){for(var u=[],o=1;o<arguments.length;o++)u.push(arguments[o]);var c=n==="error",v=this._events;if(v!==void 0)c=c&&v.error===void 0;else if(!c)return!1;if(c){var l;if(u.length>0&&(l=u[0]),l instanceof Error)throw l;var w=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw w.context=l,w}var S=v[n];if(S===void 0)return!1;if(typeof S=="function")yn(S,this,u);else for(var d=S.length,f=Gn(S,d),o=0;o<d;++o)yn(f[o],this,u);return!0};function Wn(s,n,u,o){var c,v,l;if(mr(u),v=s._events,v===void 0?(v=s._events=Object.create(null),s._eventsCount=0):(v.newListener!==void 0&&(s.emit("newListener",n,u.listener?u.listener:u),v=s._events),l=v[n]),l===void 0)l=v[n]=u,++s._eventsCount;else if(typeof l=="function"?l=v[n]=o?[u,l]:[l,u]:o?l.unshift(u):l.push(u),c=Jn(s),c>0&&l.length>c&&!l.warned){l.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=s,w.type=n,w.count=l.length,Lo(w)}return s}be.prototype.addListener=function(n,u){return Wn(this,n,u,!1)};be.prototype.on=be.prototype.addListener;be.prototype.prependListener=function(n,u){return Wn(this,n,u,!0)};function No(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qn(s,n,u){var o={fired:!1,wrapFn:void 0,target:s,type:n,listener:u},c=No.bind(o);return c.listener=u,o.wrapFn=c,c}be.prototype.once=function(n,u){return mr(u),this.on(n,qn(this,n,u)),this};be.prototype.prependOnceListener=function(n,u){return mr(u),this.prependListener(n,qn(this,n,u)),this};be.prototype.removeListener=function(n,u){var o,c,v,l,w;if(mr(u),c=this._events,c===void 0)return this;if(o=c[n],o===void 0)return this;if(o===u||o.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete c[n],c.removeListener&&this.emit("removeListener",n,o.listener||u));else if(typeof o!="function"){for(v=-1,l=o.length-1;l>=0;l--)if(o[l]===u||o[l].listener===u){w=o[l].listener,v=l;break}if(v<0)return this;v===0?o.shift():Oo(o,v),o.length===1&&(c[n]=o[0]),c.removeListener!==void 0&&this.emit("removeListener",n,w||u)}return this};be.prototype.off=be.prototype.removeListener;be.prototype.removeAllListeners=function(n){var u,o,c;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[n]),this;if(arguments.length===0){var v=Object.keys(o),l;for(c=0;c<v.length;++c)l=v[c],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=o[n],typeof u=="function")this.removeListener(n,u);else if(u!==void 0)for(c=u.length-1;c>=0;c--)this.removeListener(n,u[c]);return this};function $n(s,n,u){var o=s._events;if(o===void 0)return[];var c=o[n];return c===void 0?[]:typeof c=="function"?u?[c.listener||c]:[c]:u?Ho(c):Gn(c,c.length)}be.prototype.listeners=function(n){return $n(this,n,!0)};be.prototype.rawListeners=function(n){return $n(this,n,!1)};be.listenerCount=function(s,n){return typeof s.listenerCount=="function"?s.listenerCount(n):zn.call(s,n)};be.prototype.listenerCount=zn;function zn(s){var n=this._events;if(n!==void 0){var u=n[s];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}be.prototype.eventNames=function(){return this._eventsCount>0?gr(this._events):[]};function Gn(s,n){for(var u=new Array(n),o=0;o<n;++o)u[o]=s[o];return u}function Oo(s,n){for(;n+1<s.length;n++)s[n]=s[n+1];s.pop()}function Ho(s){for(var n=new Array(s.length),u=0;u<n.length;++u)n[u]=s[u].listener||s[u];return n}function Mo(s,n){return new Promise(function(u,o){function c(l){s.removeListener(n,v),o(l)}function v(){typeof s.removeListener=="function"&&s.removeListener("error",c),u([].slice.call(arguments))}Yn(s,n,v,{once:!0}),n!=="error"&&Bo(s,c,{once:!0})})}function Bo(s,n,u){typeof s.on=="function"&&Yn(s,"error",n,u)}function Yn(s,n,u,o){if(typeof s.on=="function")o.once?s.once(n,u):s.on(n,u);else if(typeof s.addEventListener=="function")s.addEventListener(n,function c(v){o.once&&s.removeEventListener(n,c),u(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var jo=Kr.exports;const Ko=Pi(jo);var Xn={exports:{}};(function(s,n){(function(o,c){s.exports=c()})(Ti,function(){return function(u){var o={};function c(v){if(o[v])return o[v].exports;var l=o[v]={i:v,l:!1,exports:{}};return u[v].call(l.exports,l,l.exports,c),l.l=!0,l.exports}return c.m=u,c.c=o,c.d=function(v,l,w){c.o(v,l)||Object.defineProperty(v,l,{enumerable:!0,get:w})},c.r=function(v){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(v,"__esModule",{value:!0})},c.t=function(v,l){if(1&l&&(v=c(v)),8&l||4&l&&typeof v=="object"&&v&&v.__esModule)return v;var w=Object.create(null);if(c.r(w),Object.defineProperty(w,"default",{enumerable:!0,value:v}),2&l&&typeof v!="string")for(var S in v)c.d(w,S,(function(d){return v[d]}).bind(null,S));return w},c.n=function(v){var l=v&&v.__esModule?function(){return v.default}:function(){return v};return c.d(l,"a",l),l},c.o=function(v,l){return Object.prototype.hasOwnProperty.call(v,l)},c.p="",c(c.s=22)}([function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0});var v=function(){function d(f,h){for(var b=0;b<h.length;b++){var I=h[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(f,I.key,I)}}return function(f,h,b){return h&&d(f.prototype,h),b&&d(f,b),f}}(),l={debug:function(){},info:function(){},warn:function(){},error:function(){}},w=void 0,S=void 0;(o.Log=function(){function d(){(function(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")})(this,d)}return d.reset=function(){S=3,w=l},d.debug=function(){if(S>=4){for(var h=arguments.length,b=Array(h),I=0;I<h;I++)b[I]=arguments[I];w.debug.apply(w,Array.from(b))}},d.info=function(){if(S>=3){for(var h=arguments.length,b=Array(h),I=0;I<h;I++)b[I]=arguments[I];w.info.apply(w,Array.from(b))}},d.warn=function(){if(S>=2){for(var h=arguments.length,b=Array(h),I=0;I<h;I++)b[I]=arguments[I];w.warn.apply(w,Array.from(b))}},d.error=function(){if(S>=1){for(var h=arguments.length,b=Array(h),I=0;I<h;I++)b[I]=arguments[I];w.error.apply(w,Array.from(b))}},v(d,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return S},set:function(h){if(!(0<=h&&h<=4))throw new Error("Invalid log level");S=h}},{key:"logger",get:function(){return w},set:function(h){if(!h.debug&&h.info&&(h.debug=h.info),!(h.debug&&h.info&&h.warn&&h.error))throw new Error("Invalid logger");w=h}}]),d}()).reset()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0});var v=function(){function d(f,h){for(var b=0;b<h.length;b++){var I=h[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(f,I.key,I)}}return function(f,h,b){return h&&d(f.prototype,h),b&&d(f,b),f}}(),l={setInterval:function(d){function f(h,b){return d.apply(this,arguments)}return f.toString=function(){return d.toString()},f}(function(d,f){return setInterval(d,f)}),clearInterval:function(d){function f(h){return d.apply(this,arguments)}return f.toString=function(){return d.toString()},f}(function(d){return clearInterval(d)})},w=!1,S=null;o.Global=function(){function d(){(function(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")})(this,d)}return d._testing=function(){w=!0},d.setXMLHttpRequest=function(h){S=h},v(d,null,[{key:"location",get:function(){if(!w)return location}},{key:"localStorage",get:function(){if(!w&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!w&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!w&&typeof window<"u")return S||XMLHttpRequest}},{key:"timer",get:function(){if(!w)return l}}]),d}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.MetadataService=void 0;var v=function(){function f(h,b){for(var I=0;I<b.length;I++){var P=b[I];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(h,P.key,P)}}return function(h,b,I){return b&&f(h.prototype,b),I&&f(h,I),h}}(),l=c(0),w=c(7);function S(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}var d=".well-known/openid-configuration";o.MetadataService=function(){function f(h){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.JsonService;if(S(this,f),!h)throw l.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=h,this._jsonService=new b(["application/jwk-set+json"])}return f.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},f.prototype.getMetadata=function(){var b=this;return this._settings.metadata?(l.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(l.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(I){l.Log.debug("MetadataService.getMetadata: json received");var P=b._settings.metadataSeed||{};return b._settings.metadata=Object.assign({},P,I),b._settings.metadata})):(l.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},f.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},f.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},f.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},f.prototype.getTokenEndpoint=function(){var b=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",b)},f.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},f.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},f.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},f.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},f.prototype._getMetadataProperty=function(b){var I=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return l.Log.debug("MetadataService.getMetadataProperty for: "+b),this.getMetadata().then(function(P){if(l.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),P[b]===void 0){if(I===!0)return void l.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+b);throw l.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+b),new Error("Metadata does not contain property "+b)}return P[b]})},f.prototype.getSigningKeys=function(){var b=this;return this._settings.signingKeys?(l.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(I){return l.Log.debug("MetadataService.getSigningKeys: jwks_uri received",I),b._jsonService.getJson(I).then(function(P){if(l.Log.debug("MetadataService.getSigningKeys: key set received",P),!P.keys)throw l.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return b._settings.signingKeys=P.keys,b._settings.signingKeys})})},v(f,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(d)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=d))),this._metadataUrl}}]),f}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UrlUtility=void 0;var v=c(0),l=c(1);o.UrlUtility=function(){function w(){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.addQueryParam=function(d,f,h){return d.indexOf("?")<0&&(d+="?"),d[d.length-1]!=="?"&&(d+="&"),d+=encodeURIComponent(f),d+="=",d+=encodeURIComponent(h)},w.parseUrlFragment=function(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.Global;typeof d!="string"&&(d=h.location.href);var b=d.lastIndexOf(f);b>=0&&(d=d.substr(b+1)),f==="?"&&(b=d.indexOf("#"))>=0&&(d=d.substr(0,b));for(var I,P={},K=/([^&=]+)=([^&]*)/g,L=0;I=K.exec(d);)if(P[decodeURIComponent(I[1])]=decodeURIComponent(I[2].replace(/\+/g," ")),L++>50)return v.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",d),{error:"Response exceeded expected number of parameters"};for(var T in P)return P;return{}},w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.JoseUtil=void 0;var v=c(26),l=function(S){return S&&S.__esModule?S:{default:S}}(c(33));o.JoseUtil=(0,l.default)({jws:v.jws,KeyUtil:v.KeyUtil,X509:v.X509,crypto:v.crypto,hextob64u:v.hextob64u,b64tohex:v.b64tohex,AllowedSigningAlgs:v.AllowedSigningAlgs})},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClientSettings=void 0;var v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l=function(){function T(R,M){for(var J=0;J<M.length;J++){var G=M[J];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(R,G.key,G)}}return function(R,M,J){return M&&T(R.prototype,M),J&&T(R,J),R}}(),w=c(0),S=c(23),d=c(6),f=c(24),h=c(2);function b(T,R){if(!(T instanceof R))throw new TypeError("Cannot call a class as a function")}var I=".well-known/openid-configuration",P="id_token",K="openid",L="client_secret_post";o.OidcClientSettings=function(){function T(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=R.authority,J=R.metadataUrl,G=R.metadata,$=R.signingKeys,j=R.metadataSeed,re=R.client_id,ie=R.client_secret,B=R.response_type,oe=B===void 0?P:B,_e=R.scope,me=_e===void 0?K:_e,$e=R.redirect_uri,Ie=R.post_logout_redirect_uri,ze=R.client_authentication,Le=ze===void 0?L:ze,Ge=R.prompt,fe=R.display,ye=R.max_age,Ve=R.ui_locales,Ye=R.acr_values,tt=R.resource,rt=R.response_mode,ct=R.filterProtocolClaims,Et=ct===void 0||ct,Xe=R.loadUserInfo,nt=Xe===void 0||Xe,Ke=R.staleStateAge,xe=Ke===void 0?900:Ke,V=R.clockSkew,p=V===void 0?300:V,y=R.clockService,N=y===void 0?new S.ClockService:y,W=R.userInfoJwtIssuer,X=W===void 0?"OP":W,te=R.mergeClaims,ce=te!==void 0&&te,de=R.stateStore,Se=de===void 0?new d.WebStorageStateStore:de,ve=R.ResponseValidatorCtor,we=ve===void 0?f.ResponseValidator:ve,it=R.MetadataServiceCtor,ft=it===void 0?h.MetadataService:it,he=R.extraQueryParams,ke=he===void 0?{}:he,pe=R.extraTokenParams,ht=pe===void 0?{}:pe;b(this,T),this._authority=M,this._metadataUrl=J,this._metadata=G,this._metadataSeed=j,this._signingKeys=$,this._client_id=re,this._client_secret=ie,this._response_type=oe,this._scope=me,this._redirect_uri=$e,this._post_logout_redirect_uri=Ie,this._client_authentication=Le,this._prompt=Ge,this._display=fe,this._max_age=ye,this._ui_locales=Ve,this._acr_values=Ye,this._resource=tt,this._response_mode=rt,this._filterProtocolClaims=!!Et,this._loadUserInfo=!!nt,this._staleStateAge=xe,this._clockSkew=p,this._clockService=N,this._userInfoJwtIssuer=X,this._mergeClaims=!!ce,this._stateStore=Se,this._validator=new we(this),this._metadataService=new ft(this),this._extraQueryParams=(ke===void 0?"undefined":v(ke))==="object"?ke:{},this._extraTokenParams=(ht===void 0?"undefined":v(ht))==="object"?ht:{}}return T.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},l(T,[{key:"client_id",get:function(){return this._client_id},set:function(M){if(this._client_id)throw w.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=M}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(M){if(this._authority)throw w.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=M}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(I)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=I)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(M){this._metadata=M}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(M){this._metadataSeed=M}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(M){this._signingKeys=M}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(M){(M===void 0?"undefined":v(M))==="object"?this._extraQueryParams=M:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(M){(M===void 0?"undefined":v(M))==="object"?this._extraTokenParams=M:this._extraTokenParams={}}}]),T}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.WebStorageStateStore=void 0;var v=c(0),l=c(1);function w(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")}o.WebStorageStateStore=function(){function S(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=d.prefix,h=f===void 0?"oidc.":f,b=d.store,I=b===void 0?l.Global.localStorage:b;w(this,S),this._store=I,this._prefix=h}return S.prototype.set=function(f,h){return v.Log.debug("WebStorageStateStore.set",f),f=this._prefix+f,this._store.setItem(f,h),Promise.resolve()},S.prototype.get=function(f){v.Log.debug("WebStorageStateStore.get",f),f=this._prefix+f;var h=this._store.getItem(f);return Promise.resolve(h)},S.prototype.remove=function(f){v.Log.debug("WebStorageStateStore.remove",f),f=this._prefix+f;var h=this._store.getItem(f);return this._store.removeItem(f),Promise.resolve(h)},S.prototype.getAllKeys=function(){v.Log.debug("WebStorageStateStore.getAllKeys");for(var f=[],h=0;h<this._store.length;h++){var b=this._store.key(h);b.indexOf(this._prefix)===0&&f.push(b.substr(this._prefix.length))}return Promise.resolve(f)},S}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.JsonService=void 0;var v=c(0),l=c(1);function w(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")}o.JsonService=function(){function S(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.XMLHttpRequest,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;w(this,S),d&&Array.isArray(d)?this._contentTypes=d.slice():this._contentTypes=[],this._contentTypes.push("application/json"),h&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=f,this._jwtHandler=h}return S.prototype.getJson=function(f,h){var b=this;if(!f)throw v.Log.error("JsonService.getJson: No url passed"),new Error("url");return v.Log.debug("JsonService.getJson, url: ",f),new Promise(function(I,P){var K=new b._XMLHttpRequest;K.open("GET",f);var L=b._contentTypes,T=b._jwtHandler;K.onload=function(){if(v.Log.debug("JsonService.getJson: HTTP response received, status",K.status),K.status===200){var R=K.getResponseHeader("Content-Type");if(R){var M=L.find(function(J){if(R.startsWith(J))return!0});if(M=="application/jwt")return void T(K).then(I,P);if(M)try{return void I(JSON.parse(K.responseText))}catch(J){return v.Log.error("JsonService.getJson: Error parsing JSON response",J.message),void P(J)}}P(Error("Invalid response Content-Type: "+R+", from URL: "+f))}else P(Error(K.statusText+" ("+K.status+")"))},K.onerror=function(){v.Log.error("JsonService.getJson: network error"),P(Error("Network Error"))},h&&(v.Log.debug("JsonService.getJson: token passed, setting Authorization header"),K.setRequestHeader("Authorization","Bearer "+h)),K.send()})},S.prototype.postForm=function(f,h,b){var I=this;if(!f)throw v.Log.error("JsonService.postForm: No url passed"),new Error("url");return v.Log.debug("JsonService.postForm, url: ",f),new Promise(function(P,K){var L=new I._XMLHttpRequest;L.open("POST",f);var T=I._contentTypes;L.onload=function(){if(v.Log.debug("JsonService.postForm: HTTP response received, status",L.status),L.status!==200){if(L.status===400&&($=L.getResponseHeader("Content-Type"))&&T.find(function(j){if($.startsWith(j))return!0}))try{var G=JSON.parse(L.responseText);if(G&&G.error)return v.Log.error("JsonService.postForm: Error from server: ",G.error),void K(new Error(G.error))}catch(j){return v.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void K(j)}K(Error(L.statusText+" ("+L.status+")"))}else{var $;if(($=L.getResponseHeader("Content-Type"))&&T.find(function(j){if($.startsWith(j))return!0}))try{return void P(JSON.parse(L.responseText))}catch(j){return v.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void K(j)}K(Error("Invalid response Content-Type: "+$+", from URL: "+f))}},L.onerror=function(){v.Log.error("JsonService.postForm: network error"),K(Error("Network Error"))};var R="";for(var M in h){var J=h[M];J&&(R.length>0&&(R+="&"),R+=encodeURIComponent(M),R+="=",R+=encodeURIComponent(J))}L.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b!==void 0&&L.setRequestHeader("Authorization","Basic "+btoa(b)),L.send(R)})},S}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninRequest=void 0;var v=c(0),l=c(3),w=c(13);o.SigninRequest=function(){function S(d){var f=d.url,h=d.client_id,b=d.redirect_uri,I=d.response_type,P=d.scope,K=d.authority,L=d.data,T=d.prompt,R=d.display,M=d.max_age,J=d.ui_locales,G=d.id_token_hint,$=d.login_hint,j=d.acr_values,re=d.resource,ie=d.response_mode,B=d.request,oe=d.request_uri,_e=d.extraQueryParams,me=d.request_type,$e=d.client_secret,Ie=d.extraTokenParams,ze=d.skipUserInfo;if(function(tt,rt){if(!(tt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,S),!f)throw v.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!h)throw v.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!b)throw v.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!I)throw v.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!P)throw v.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!K)throw v.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Le=S.isOidc(I),Ge=S.isCode(I);ie||(ie=S.isCode(I)?"query":null),this.state=new w.SigninState({nonce:Le,data:L,client_id:h,authority:K,redirect_uri:b,code_verifier:Ge,request_type:me,response_mode:ie,client_secret:$e,scope:P,extraTokenParams:Ie,skipUserInfo:ze}),f=l.UrlUtility.addQueryParam(f,"client_id",h),f=l.UrlUtility.addQueryParam(f,"redirect_uri",b),f=l.UrlUtility.addQueryParam(f,"response_type",I),f=l.UrlUtility.addQueryParam(f,"scope",P),f=l.UrlUtility.addQueryParam(f,"state",this.state.id),Le&&(f=l.UrlUtility.addQueryParam(f,"nonce",this.state.nonce)),Ge&&(f=l.UrlUtility.addQueryParam(f,"code_challenge",this.state.code_challenge),f=l.UrlUtility.addQueryParam(f,"code_challenge_method","S256"));var fe={prompt:T,display:R,max_age:M,ui_locales:J,id_token_hint:G,login_hint:$,acr_values:j,resource:re,request:B,request_uri:oe,response_mode:ie};for(var ye in fe)fe[ye]&&(f=l.UrlUtility.addQueryParam(f,ye,fe[ye]));for(var Ve in _e)f=l.UrlUtility.addQueryParam(f,Ve,_e[Ve]);this.url=f}return S.isOidc=function(f){return!!f.split(/\s+/g).filter(function(h){return h==="id_token"})[0]},S.isOAuth=function(f){return!!f.split(/\s+/g).filter(function(h){return h==="token"})[0]},S.isCode=function(f){return!!f.split(/\s+/g).filter(function(h){return h==="code"})[0]},S}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.State=void 0;var v=function(){function d(f,h){for(var b=0;b<h.length;b++){var I=h[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(f,I.key,I)}}return function(f,h,b){return h&&d(f.prototype,h),b&&d(f,b),f}}(),l=c(0),w=function(f){return f&&f.__esModule?f:{default:f}}(c(14));function S(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}o.State=function(){function d(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.id,b=f.data,I=f.created,P=f.request_type;S(this,d),this._id=h||(0,w.default)(),this._data=b,this._created=typeof I=="number"&&I>0?I:parseInt(Date.now()/1e3),this._request_type=P}return d.prototype.toStorageString=function(){return l.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},d.fromStorageString=function(h){return l.Log.debug("State.fromStorageString"),new d(JSON.parse(h))},d.clearStaleState=function(h,b){var I=Date.now()/1e3-b;return h.getAllKeys().then(function(P){l.Log.debug("State.clearStaleState: got keys",P);for(var K=[],L=function(J){var G=P[J];R=h.get(G).then(function($){var j=!1;if($)try{var re=d.fromStorageString($);l.Log.debug("State.clearStaleState: got item from key: ",G,re.created),re.created<=I&&(j=!0)}catch(ie){l.Log.error("State.clearStaleState: Error parsing state for key",G,ie.message),j=!0}else l.Log.debug("State.clearStaleState: no item in storage for key: ",G),j=!0;if(j)return l.Log.debug("State.clearStaleState: removed item for key: ",G),h.remove(G)}),K.push(R)},T=0;T<P.length;T++){var R;L(T)}return l.Log.debug("State.clearStaleState: waiting on promise count:",K.length),Promise.all(K)})},v(d,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),d}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClient=void 0;var v=function(){function L(T,R){for(var M=0;M<R.length;M++){var J=R[M];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(T,J.key,J)}}return function(T,R,M){return R&&L(T.prototype,R),M&&L(T,M),T}}(),l=c(0),w=c(5),S=c(12),d=c(8),f=c(34),h=c(35),b=c(36),I=c(13),P=c(9);function K(L,T){if(!(L instanceof T))throw new TypeError("Cannot call a class as a function")}o.OidcClient=function(){function L(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,L),T instanceof w.OidcClientSettings?this._settings=T:this._settings=new w.OidcClientSettings(T)}return L.prototype.createSigninRequest=function(){var R=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},J=M.response_type,G=M.scope,$=M.redirect_uri,j=M.data,re=M.state,ie=M.prompt,B=M.display,oe=M.max_age,_e=M.ui_locales,me=M.id_token_hint,$e=M.login_hint,Ie=M.acr_values,ze=M.resource,Le=M.request,Ge=M.request_uri,fe=M.response_mode,ye=M.extraQueryParams,Ve=M.extraTokenParams,Ye=M.request_type,tt=M.skipUserInfo,rt=arguments[1];l.Log.debug("OidcClient.createSigninRequest");var ct=this._settings.client_id;J=J||this._settings.response_type,G=G||this._settings.scope,$=$||this._settings.redirect_uri,ie=ie||this._settings.prompt,B=B||this._settings.display,oe=oe||this._settings.max_age,_e=_e||this._settings.ui_locales,Ie=Ie||this._settings.acr_values,ze=ze||this._settings.resource,fe=fe||this._settings.response_mode,ye=ye||this._settings.extraQueryParams,Ve=Ve||this._settings.extraTokenParams;var Et=this._settings.authority;return d.SigninRequest.isCode(J)&&J!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(Xe){l.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",Xe);var nt=new d.SigninRequest({url:Xe,client_id:ct,redirect_uri:$,response_type:J,scope:G,data:j||re,authority:Et,prompt:ie,display:B,max_age:oe,ui_locales:_e,id_token_hint:me,login_hint:$e,acr_values:Ie,resource:ze,request:Le,request_uri:Ge,extraQueryParams:ye,extraTokenParams:Ve,request_type:Ye,response_mode:fe,client_secret:R._settings.client_secret,skipUserInfo:tt}),Ke=nt.state;return(rt=rt||R._stateStore).set(Ke.id,Ke.toStorageString()).then(function(){return nt})})},L.prototype.readSigninResponseState=function(R,M){var J=arguments.length>2&&arguments[2]!==void 0&&arguments[2];l.Log.debug("OidcClient.readSigninResponseState");var G=this._settings.response_mode==="query"||!this._settings.response_mode&&d.SigninRequest.isCode(this._settings.response_type),$=G?"?":"#",j=new f.SigninResponse(R,$);if(!j.state)return l.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));M=M||this._stateStore;var re=J?M.remove.bind(M):M.get.bind(M);return re(j.state).then(function(ie){if(!ie)throw l.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:I.SigninState.fromStorageString(ie),response:j}})},L.prototype.processSigninResponse=function(R,M){var J=this;return l.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(R,M,!0).then(function(G){var $=G.state,j=G.response;return l.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),J._validator.validateSigninResponse($,j)})},L.prototype.createSignoutRequest=function(){var R=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},J=M.id_token_hint,G=M.data,$=M.state,j=M.post_logout_redirect_uri,re=M.extraQueryParams,ie=M.request_type,B=arguments[1];return l.Log.debug("OidcClient.createSignoutRequest"),j=j||this._settings.post_logout_redirect_uri,re=re||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(oe){if(!oe)throw l.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");l.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",oe);var _e=new h.SignoutRequest({url:oe,id_token_hint:J,post_logout_redirect_uri:j,data:G||$,extraQueryParams:re,request_type:ie}),me=_e.state;return me&&(l.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(B=B||R._stateStore).set(me.id,me.toStorageString())),_e})},L.prototype.readSignoutResponseState=function(R,M){var J=arguments.length>2&&arguments[2]!==void 0&&arguments[2];l.Log.debug("OidcClient.readSignoutResponseState");var G=new b.SignoutResponse(R);if(!G.state)return l.Log.debug("OidcClient.readSignoutResponseState: No state in response"),G.error?(l.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",G.error),Promise.reject(new S.ErrorResponse(G))):Promise.resolve({state:void 0,response:G});var $=G.state;M=M||this._stateStore;var j=J?M.remove.bind(M):M.get.bind(M);return j($).then(function(re){if(!re)throw l.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:P.State.fromStorageString(re),response:G}})},L.prototype.processSignoutResponse=function(R,M){var J=this;return l.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(R,M,!0).then(function(G){var $=G.state,j=G.response;return $?(l.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),J._validator.validateSignoutResponse($,j)):(l.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),j)})},L.prototype.clearStaleState=function(R){return l.Log.debug("OidcClient.clearStaleState"),R=R||this._stateStore,P.State.clearStaleState(R,this.settings.staleStateAge)},v(L,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),L}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenClient=void 0;var v=c(7),l=c(2),w=c(0);function S(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}o.TokenClient=function(){function d(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.JsonService,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService;if(S(this,d),!f)throw w.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=f,this._jsonService=new h,this._metadataService=new b(this._settings)}return d.prototype.exchangeCode=function(){var h=this,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).grant_type=b.grant_type||"authorization_code",b.client_id=b.client_id||this._settings.client_id,b.client_secret=b.client_secret||this._settings.client_secret,b.redirect_uri=b.redirect_uri||this._settings.redirect_uri;var I=void 0,P=b._client_authentication||this._settings._client_authentication;return delete b._client_authentication,b.code?b.redirect_uri?b.code_verifier?b.client_id?b.client_secret||P!="client_secret_basic"?(P=="client_secret_basic"&&(I=b.client_id+":"+b.client_secret,delete b.client_id,delete b.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(K){return w.Log.debug("TokenClient.exchangeCode: Received token endpoint"),h._jsonService.postForm(K,b,I).then(function(L){return w.Log.debug("TokenClient.exchangeCode: response received"),L})})):(w.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(w.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(w.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(w.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(w.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},d.prototype.exchangeRefreshToken=function(){var h=this,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).grant_type=b.grant_type||"refresh_token",b.client_id=b.client_id||this._settings.client_id,b.client_secret=b.client_secret||this._settings.client_secret;var I=void 0,P=b._client_authentication||this._settings._client_authentication;return delete b._client_authentication,b.refresh_token?b.client_id?(P=="client_secret_basic"&&(I=b.client_id+":"+b.client_secret,delete b.client_id,delete b.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(K){return w.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),h._jsonService.postForm(K,b,I).then(function(L){return w.Log.debug("TokenClient.exchangeRefreshToken: response received"),L})})):(w.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(w.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},d}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.ErrorResponse=void 0;var v=c(0);function l(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")}function w(S,d){if(!S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||typeof d!="object"&&typeof d!="function"?S:d}o.ErrorResponse=function(S){function d(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.error,b=f.error_description,I=f.error_uri,P=f.state,K=f.session_state;if(l(this,d),!h)throw v.Log.error("No error passed to ErrorResponse"),new Error("error");var L=w(this,S.call(this,b||h));return L.name="ErrorResponse",L.error=h,L.error_description=b,L.error_uri=I,L.state=P,L.session_state=K,L}return function(h,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);h.prototype=Object.create(b&&b.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(h,b):h.__proto__=b)}(d,S),d}(Error)},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninState=void 0;var v=function(){function b(I,P){for(var K=0;K<P.length;K++){var L=P[K];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(I,L.key,L)}}return function(I,P,K){return P&&b(I.prototype,P),K&&b(I,K),I}}(),l=c(0),w=c(9),S=c(4),d=function(I){return I&&I.__esModule?I:{default:I}}(c(14));function f(b,I){if(!(b instanceof I))throw new TypeError("Cannot call a class as a function")}function h(b,I){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!I||typeof I!="object"&&typeof I!="function"?b:I}o.SigninState=function(b){function I(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},K=P.nonce,L=P.authority,T=P.client_id,R=P.redirect_uri,M=P.code_verifier,J=P.response_mode,G=P.client_secret,$=P.scope,j=P.extraTokenParams,re=P.skipUserInfo;f(this,I);var ie=h(this,b.call(this,arguments[0]));if(K===!0?ie._nonce=(0,d.default)():K&&(ie._nonce=K),M===!0?ie._code_verifier=(0,d.default)()+(0,d.default)()+(0,d.default)():M&&(ie._code_verifier=M),ie.code_verifier){var B=S.JoseUtil.hashString(ie.code_verifier,"SHA256");ie._code_challenge=S.JoseUtil.hexToBase64Url(B)}return ie._redirect_uri=R,ie._authority=L,ie._client_id=T,ie._response_mode=J,ie._client_secret=G,ie._scope=$,ie._extraTokenParams=j,ie._skipUserInfo=re,ie}return function(K,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);K.prototype=Object.create(L&&L.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(K,L):K.__proto__=L)}(I,b),I.prototype.toStorageString=function(){return l.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},I.fromStorageString=function(K){return l.Log.debug("SigninState.fromStorageString"),new I(JSON.parse(K))},v(I,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),I}(w.State)},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(){return(v!="undefined"&&v!==null&&v.getRandomValues!==void 0?l:w)().replace(/-/g,"")};var v=typeof window<"u"?window.crypto||window.msCrypto:null;function l(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(S){return(S^v.getRandomValues(new Uint8Array(1))[0]&15>>S/4).toString(16)})}function w(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(S){return(S^16*Math.random()>>S/4).toString(16)})}u.exports=o.default},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.User=void 0;var v=function(){function w(S,d){for(var f=0;f<d.length;f++){var h=d[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,h.key,h)}}return function(S,d,f){return d&&w(S.prototype,d),f&&w(S,f),S}}(),l=c(0);o.User=function(){function w(S){var d=S.id_token,f=S.session_state,h=S.access_token,b=S.refresh_token,I=S.token_type,P=S.scope,K=S.profile,L=S.expires_at,T=S.state;(function(M,J){if(!(M instanceof J))throw new TypeError("Cannot call a class as a function")})(this,w),this.id_token=d,this.session_state=f,this.access_token=h,this.refresh_token=b,this.token_type=I,this.scope=P,this.profile=K,this.expires_at=L,this.state=T}return w.prototype.toStorageString=function(){return l.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},w.fromStorageString=function(d){return l.Log.debug("User.fromStorageString"),new w(JSON.parse(d))},v(w,[{key:"expires_in",get:function(){if(this.expires_at){var d=parseInt(Date.now()/1e3);return this.expires_at-d}},set:function(d){var f=parseInt(d);if(typeof f=="number"&&f>0){var h=parseInt(Date.now()/1e3);this.expires_at=h+f}}},{key:"expired",get:function(){var d=this.expires_in;if(d!==void 0)return d<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.AccessTokenEvents=void 0;var v=c(0),l=c(46);function w(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")}o.AccessTokenEvents=function(){function S(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=d.accessTokenExpiringNotificationTime,h=f===void 0?60:f,b=d.accessTokenExpiringTimer,I=b===void 0?new l.Timer("Access token expiring"):b,P=d.accessTokenExpiredTimer,K=P===void 0?new l.Timer("Access token expired"):P;w(this,S),this._accessTokenExpiringNotificationTime=h,this._accessTokenExpiring=I,this._accessTokenExpired=K}return S.prototype.load=function(f){if(f.access_token&&f.expires_in!==void 0){var h=f.expires_in;if(v.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",h),h>0){var b=h-this._accessTokenExpiringNotificationTime;b<=0&&(b=1),v.Log.debug("AccessTokenEvents.load: registering expiring timer in:",b),this._accessTokenExpiring.init(b)}else v.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var I=h+1;v.Log.debug("AccessTokenEvents.load: registering expired timer in:",I),this._accessTokenExpired.init(I)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},S.prototype.unload=function(){v.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},S.prototype.addAccessTokenExpiring=function(f){this._accessTokenExpiring.addHandler(f)},S.prototype.removeAccessTokenExpiring=function(f){this._accessTokenExpiring.removeHandler(f)},S.prototype.addAccessTokenExpired=function(f){this._accessTokenExpired.addHandler(f)},S.prototype.removeAccessTokenExpired=function(f){this._accessTokenExpired.removeHandler(f)},S}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.Event=void 0;var v=c(0);o.Event=function(){function l(w){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,l),this._name=w,this._callbacks=[]}return l.prototype.addHandler=function(S){this._callbacks.push(S)},l.prototype.removeHandler=function(S){var d=this._callbacks.findIndex(function(f){return f===S});d>=0&&this._callbacks.splice(d,1)},l.prototype.raise=function(){v.Log.debug("Event: Raising event: "+this._name);for(var S=0;S<this._callbacks.length;S++){var d;(d=this._callbacks)[S].apply(d,arguments)}},l}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SessionMonitor=void 0;var v=function(){function f(h,b){for(var I=0;I<b.length;I++){var P=b[I];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(h,P.key,P)}}return function(h,b,I){return b&&f(h.prototype,b),I&&f(h,I),h}}(),l=c(0),w=c(19),S=c(1);function d(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}o.SessionMonitor=function(){function f(h){var b=this,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.CheckSessionIFrame,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:S.Global.timer;if(d(this,f),!h)throw l.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=h,this._CheckSessionIFrameCtor=I,this._timer=P,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(K){K?b._start(K):b._settings.monitorAnonymousSession&&b._userManager.querySessionStatus().then(function(L){var T={session_state:L.session_state};L.sub&&L.sid&&(T.profile={sub:L.sub,sid:L.sid}),b._start(T)}).catch(function(L){l.Log.error("SessionMonitor ctor: error from querySessionStatus:",L.message)})}).catch(function(K){l.Log.error("SessionMonitor ctor: error from getUser:",K.message)}))}return f.prototype._start=function(b){var I=this,P=b.session_state;P&&(b.profile?(this._sub=b.profile.sub,this._sid=b.profile.sid,l.Log.debug("SessionMonitor._start: session_state:",P,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,l.Log.debug("SessionMonitor._start: session_state:",P,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(P):this._metadataService.getCheckSessionIframe().then(function(K){if(K){l.Log.debug("SessionMonitor._start: Initializing check session iframe");var L=I._client_id,T=I._checkSessionInterval,R=I._stopCheckSessionOnError;I._checkSessionIFrame=new I._CheckSessionIFrameCtor(I._callback.bind(I),L,K,T,R),I._checkSessionIFrame.load().then(function(){I._checkSessionIFrame.start(P)})}else l.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(K){l.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",K.message)}))},f.prototype._stop=function(){var b=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(l.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var I=this._timer.setInterval(function(){b._timer.clearInterval(I),b._userManager.querySessionStatus().then(function(P){var K={session_state:P.session_state};P.sub&&P.sid&&(K.profile={sub:P.sub,sid:P.sid}),b._start(K)}).catch(function(P){l.Log.error("SessionMonitor: error from querySessionStatus:",P.message)})},1e3)},f.prototype._callback=function(){var b=this;this._userManager.querySessionStatus().then(function(I){var P=!0;I?I.sub===b._sub?(P=!1,b._checkSessionIFrame.start(I.session_state),I.sid===b._sid?l.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",I.session_state):(l.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",I.session_state),b._userManager.events._raiseUserSessionChanged())):l.Log.debug("SessionMonitor._callback: Different subject signed into OP:",I.sub):l.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),P&&(b._sub?(l.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),b._userManager.events._raiseUserSignedOut()):(l.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),b._userManager.events._raiseUserSignedIn()))}).catch(function(I){b._sub&&(l.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",I.message),b._userManager.events._raiseUserSignedOut())})},v(f,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),f}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CheckSessionIFrame=void 0;var v=c(0);function l(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")}o.CheckSessionIFrame=function(){function w(S,d,f,h){var b=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];l(this,w),this._callback=S,this._client_id=d,this._url=f,this._interval=h||2e3,this._stopOnError=b;var I=f.indexOf("/",f.indexOf("//")+2);this._frame_origin=f.substr(0,I),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=f}return w.prototype.load=function(){var d=this;return new Promise(function(f){d._frame.onload=function(){f()},window.document.body.appendChild(d._frame),d._boundMessageEvent=d._message.bind(d),window.addEventListener("message",d._boundMessageEvent,!1)})},w.prototype._message=function(d){d.origin===this._frame_origin&&d.source===this._frame.contentWindow&&(d.data==="error"?(v.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):d.data==="changed"?(v.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):v.Log.debug("CheckSessionIFrame: "+d.data+" message from check session op iframe"))},w.prototype.start=function(d){var f=this;if(this._session_state!==d){v.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=d;var h=function(){f._frame.contentWindow.postMessage(f._client_id+" "+f._session_state,f._frame_origin)};h(),this._timer=window.setInterval(h,this._interval)}},w.prototype.stop=function(){this._session_state=null,this._timer&&(v.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenRevocationClient=void 0;var v=c(0),l=c(2),w=c(1);function S(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")}var d="access_token",f="refresh_token";o.TokenRevocationClient=function(){function h(b){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.Global.XMLHttpRequest,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService;if(S(this,h),!b)throw v.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=b,this._XMLHttpRequestCtor=I,this._metadataService=new P(this._settings)}return h.prototype.revoke=function(I,P){var K=this,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!I)throw v.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(L!==d&&L!=f)throw v.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(T){if(T){v.Log.debug("TokenRevocationClient.revoke: Revoking "+L);var R=K._settings.client_id,M=K._settings.client_secret;return K._revoke(T,R,M,I,L)}if(P)throw v.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},h.prototype._revoke=function(I,P,K,L,T){var R=this;return new Promise(function(M,J){var G=new R._XMLHttpRequestCtor;G.open("POST",I),G.onload=function(){v.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",G.status),G.status===200?M():J(Error(G.statusText+" ("+G.status+")"))},G.onerror=function(){v.Log.debug("TokenRevocationClient.revoke: Network Error."),J("Network Error")};var $="client_id="+encodeURIComponent(P);K&&($+="&client_secret="+encodeURIComponent(K)),$+="&token_type_hint="+encodeURIComponent(T),$+="&token="+encodeURIComponent(L),G.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),G.send($)})},h}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupWindow=void 0;var v=function(){function w(S,d){for(var f=0;f<d.length;f++){var h=d[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,h.key,h)}}return function(S,d,f){return d&&w(S.prototype,d),f&&w(S,f),S}}(),l=c(0);o.CordovaPopupWindow=function(){function w(S){var d=this;(function(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")})(this,w),this._promise=new Promise(function(f,h){d._resolve=f,d._reject=h}),this.features=S.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=S.popupWindowTarget||"_blank",this.redirect_uri=S.startUrl,l.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return w.prototype._isInAppBrowserInstalled=function(d){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(f){return d.hasOwnProperty(f)})},w.prototype.navigate=function(d){if(d&&d.url){if(!window.cordova)return this._error("cordova is undefined");var f=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(f)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(d.url,this.target,this.features),this._popup?(l.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},w.prototype._loadStartCallback=function(d){d.url.indexOf(this.redirect_uri)===0&&this._success({url:d.url})},w.prototype._exitCallback=function(d){this._error(d)},w.prototype._success=function(d){this._cleanup(),l.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(d)},w.prototype._error=function(d){this._cleanup(),l.Log.error(d),this._reject(new Error(d))},w.prototype.close=function(){this._cleanup()},w.prototype._cleanup=function(){this._popup&&(l.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},v(w,[{key:"promise",get:function(){return this._promise}}]),w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0});var v=c(0),l=c(10),w=c(5),S=c(6),d=c(37),f=c(38),h=c(16),b=c(2),I=c(48),P=c(49),K=c(19),L=c(20),T=c(18),R=c(1),M=c(15),J=c(50);o.default={Version:J.Version,Log:v.Log,OidcClient:l.OidcClient,OidcClientSettings:w.OidcClientSettings,WebStorageStateStore:S.WebStorageStateStore,InMemoryWebStorage:d.InMemoryWebStorage,UserManager:f.UserManager,AccessTokenEvents:h.AccessTokenEvents,MetadataService:b.MetadataService,CordovaPopupNavigator:I.CordovaPopupNavigator,CordovaIFrameNavigator:P.CordovaIFrameNavigator,CheckSessionIFrame:K.CheckSessionIFrame,TokenRevocationClient:L.TokenRevocationClient,SessionMonitor:T.SessionMonitor,Global:R.Global,User:M.User},u.exports=o.default},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.ClockService=function(){function v(){(function(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")})(this,v)}return v.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},v}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.ResponseValidator=void 0;var v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},l=c(0),w=c(2),S=c(25),d=c(11),f=c(12),h=c(4);function b(P,K){if(!(P instanceof K))throw new TypeError("Cannot call a class as a function")}var I=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];o.ResponseValidator=function(){function P(K){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.MetadataService,T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:S.UserInfoService,R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:h.JoseUtil,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:d.TokenClient;if(b(this,P),!K)throw l.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=K,this._metadataService=new L(this._settings),this._userInfoService=new T(this._settings),this._joseUtil=R,this._tokenClient=new M(this._settings)}return P.prototype.validateSigninResponse=function(L,T){var R=this;return l.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(L,T).then(function(M){return l.Log.debug("ResponseValidator.validateSigninResponse: state processed"),R._validateTokens(L,M).then(function(J){return l.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),R._processClaims(L,J).then(function(G){return l.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),G})})})},P.prototype.validateSignoutResponse=function(L,T){return L.id!==T.state?(l.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(l.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),T.state=L.data,T.error?(l.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",T.error),Promise.reject(new f.ErrorResponse(T))):Promise.resolve(T))},P.prototype._processSigninParams=function(L,T){if(L.id!==T.state)return l.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!L.client_id)return l.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!L.authority)return l.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==L.authority)return l.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=L.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==L.client_id)return l.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=L.client_id;return l.Log.debug("ResponseValidator._processSigninParams: state validated"),T.state=L.data,T.error?(l.Log.warn("ResponseValidator._processSigninParams: Response was error",T.error),Promise.reject(new f.ErrorResponse(T))):L.nonce&&!T.id_token?(l.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!L.nonce&&T.id_token?(l.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):L.code_verifier&&!T.code?(l.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!L.code_verifier&&T.code?(l.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(T.scope||(T.scope=L.scope),Promise.resolve(T))},P.prototype._processClaims=function(L,T){var R=this;if(T.isOpenIdConnect){if(l.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),T.profile=this._filterProtocolClaims(T.profile),L.skipUserInfo!==!0&&this._settings.loadUserInfo&&T.access_token)return l.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(T.access_token).then(function(M){return l.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),M.sub!==T.profile.sub?(l.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(T.profile=R._mergeClaims(T.profile,M),l.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",T.profile),T)});l.Log.debug("ResponseValidator._processClaims: not loading user info")}else l.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(T)},P.prototype._mergeClaims=function(L,T){var R=Object.assign({},L);for(var M in T){var J=T[M];Array.isArray(J)||(J=[J]);for(var G=0;G<J.length;G++){var $=J[G];R[M]?Array.isArray(R[M])?R[M].indexOf($)<0&&R[M].push($):R[M]!==$&&(($===void 0?"undefined":v($))==="object"&&this._settings.mergeClaims?R[M]=this._mergeClaims(R[M],$):R[M]=[R[M],$]):R[M]=$}}return R},P.prototype._filterProtocolClaims=function(L){l.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",L);var T=Object.assign({},L);return this._settings._filterProtocolClaims?(I.forEach(function(R){delete T[R]}),l.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",T)):l.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),T},P.prototype._validateTokens=function(L,T){return T.code?(l.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(L,T)):T.id_token?T.access_token?(l.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(L,T)):(l.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(L,T)):(l.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(T))},P.prototype._processCode=function(L,T){var R=this,M={client_id:L.client_id,client_secret:L.client_secret,code:T.code,redirect_uri:L.redirect_uri,code_verifier:L.code_verifier};return L.extraTokenParams&&v(L.extraTokenParams)==="object"&&Object.assign(M,L.extraTokenParams),this._tokenClient.exchangeCode(M).then(function(J){for(var G in J)T[G]=J[G];return T.id_token?(l.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),R._validateIdTokenAttributes(L,T)):(l.Log.debug("ResponseValidator._processCode: token response successful, returning response"),T)})},P.prototype._validateIdTokenAttributes=function(L,T){var R=this;return this._metadataService.getIssuer().then(function(M){var J=L.client_id,G=R._settings.clockSkew;return l.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",G),R._settings.getEpochTime().then(function($){return R._joseUtil.validateJwtAttributes(T.id_token,M,J,G,$).then(function(j){return L.nonce&&L.nonce!==j.nonce?(l.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):j.sub?(T.profile=j,T):(l.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},P.prototype._validateIdTokenAndAccessToken=function(L,T){var R=this;return this._validateIdToken(L,T).then(function(M){return R._validateAccessToken(M)})},P.prototype._getSigningKeyForJwt=function(L){var T=this;return this._metadataService.getSigningKeys().then(function(R){var M=L.header.kid;if(!R)return l.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));l.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var J=void 0;if(M)J=R.filter(function(G){return G.kid===M})[0];else{if((R=T._filterByAlg(R,L.header.alg)).length>1)return l.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));J=R[0]}return Promise.resolve(J)})},P.prototype._getSigningKeyForJwtWithSingleRetry=function(L){var T=this;return this._getSigningKeyForJwt(L).then(function(R){return R?Promise.resolve(R):(T._metadataService.resetSigningKeys(),T._getSigningKeyForJwt(L))})},P.prototype._validateIdToken=function(L,T){var R=this;if(!L.nonce)return l.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var M=this._joseUtil.parseJwt(T.id_token);return M&&M.header&&M.payload?L.nonce!==M.payload.nonce?(l.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(J){return l.Log.debug("ResponseValidator._validateIdToken: Received issuer"),R._getSigningKeyForJwtWithSingleRetry(M).then(function(G){if(!G)return l.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var $=L.client_id,j=R._settings.clockSkew;return l.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",j),R._joseUtil.validateJwt(T.id_token,G,J,$,j).then(function(){return l.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),M.payload.sub?(T.profile=M.payload,T):(l.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(l.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",M),Promise.reject(new Error("Failed to parse id_token")))},P.prototype._filterByAlg=function(L,T){var R=null;if(T.startsWith("RS"))R="RSA";else if(T.startsWith("PS"))R="PS";else{if(!T.startsWith("ES"))return l.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",T),[];R="EC"}return l.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",R),L=L.filter(function(M){return M.kty===R}),l.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",R,L.length),L},P.prototype._validateAccessToken=function(L){if(!L.profile)return l.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!L.profile.at_hash)return l.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!L.id_token)return l.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var T=this._joseUtil.parseJwt(L.id_token);if(!T||!T.header)return l.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",T),Promise.reject(new Error("Failed to parse id_token"));var R=T.header.alg;if(!R||R.length!==5)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R),Promise.reject(new Error("Unsupported alg: "+R));var M=R.substr(2,3);if(!M)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R,M),Promise.reject(new Error("Unsupported alg: "+R));if((M=parseInt(M))!==256&&M!==384&&M!==512)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R,M),Promise.reject(new Error("Unsupported alg: "+R));var J="sha"+M,G=this._joseUtil.hashString(L.access_token,J);if(!G)return l.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",J),Promise.reject(new Error("Failed to validate at_hash"));var $=G.substr(0,G.length/2),j=this._joseUtil.hexToBase64Url($);return j!==L.profile.at_hash?(l.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",j,L.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(l.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(L))},P}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserInfoService=void 0;var v=c(7),l=c(2),w=c(0),S=c(4);function d(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}o.UserInfoService=function(){function f(h){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.JsonService,I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:S.JoseUtil;if(d(this,f),!h)throw w.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=h,this._jsonService=new b(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new I(this._settings),this._joseUtil=P}return f.prototype.getClaims=function(b){var I=this;return b?this._metadataService.getUserInfoEndpoint().then(function(P){return w.Log.debug("UserInfoService.getClaims: received userinfo url",P),I._jsonService.getJson(P,b).then(function(K){return w.Log.debug("UserInfoService.getClaims: claims received",K),K})}):(w.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},f.prototype._getClaimsFromJwt=function(b){var I=this;try{var P=this._joseUtil.parseJwt(b.responseText);if(!P||!P.header||!P.payload)return w.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",P),Promise.reject(new Error("Failed to parse id_token"));var K=P.header.kid,L=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":L=this._metadataService.getIssuer();break;case"ANY":L=Promise.resolve(P.payload.iss);break;default:L=Promise.resolve(this._settings.userInfoJwtIssuer)}return L.then(function(T){return w.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+T),I._metadataService.getSigningKeys().then(function(R){if(!R)return w.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));w.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var M=void 0;if(K)M=R.filter(function($){return $.kid===K})[0];else{if((R=I._filterByAlg(R,P.header.alg)).length>1)return w.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));M=R[0]}if(!M)return w.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var J=I._settings.client_id,G=I._settings.clockSkew;return w.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",G),I._joseUtil.validateJwt(b.responseText,M,T,J,G,void 0,!0).then(function(){return w.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),P.payload})})})}catch(T){return w.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",T.message),void reject(T)}},f.prototype._filterByAlg=function(b,I){var P=null;if(I.startsWith("RS"))P="RSA";else if(I.startsWith("PS"))P="PS";else{if(!I.startsWith("ES"))return w.Log.debug("UserInfoService._filterByAlg: alg not supported: ",I),[];P="EC"}return w.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",P),b=b.filter(function(K){return K.kty===P}),w.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",P,b.length),b},f}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.AllowedSigningAlgs=o.b64tohex=o.hextob64u=o.crypto=o.X509=o.KeyUtil=o.jws=void 0;var v=c(27);o.jws=v.jws,o.KeyUtil=v.KEYUTIL,o.X509=v.X509,o.crypto=v.crypto,o.hextob64u=v.hextob64u,o.b64tohex=v.b64tohex,o.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(u,o,c){(function(v){Object.defineProperty(o,"__esModule",{value:!0});var l,w,S,d,f,h,b,I,P,K,L,T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R={userAgent:!1},M={},J=J||(l=Math,S=(w={}).lib={},d=S.Base=function(){function t(){}return{extend:function(r){t.prototype=this;var i=new t;return r&&i.mixIn(r),i.hasOwnProperty("init")||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var i in r)r.hasOwnProperty(i)&&(this[i]=r[i]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=S.WordArray=d.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r??4*e.length},toString:function(e){return(e||b).stringify(this)},concat:function(e){var r=this.words,i=e.words,a=this.sigBytes,g=e.sigBytes;if(this.clamp(),a%4)for(var _=0;_<g;_++){var x=i[_>>>2]>>>24-_%4*8&255;r[a+_>>>2]|=x<<24-(a+_)%4*8}else for(_=0;_<g;_+=4)r[a+_>>>2]=i[_>>>2];return this.sigBytes+=g,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=l.ceil(r/4)},clone:function(){var e=d.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var r=[],i=0;i<e;i+=4)r.push(4294967296*l.random()|0);return new f.init(r,e)}}),h=w.enc={},b=h.Hex={stringify:function(e){for(var r=e.words,i=e.sigBytes,a=[],g=0;g<i;g++){var _=r[g>>>2]>>>24-g%4*8&255;a.push((_>>>4).toString(16)),a.push((15&_).toString(16))}return a.join("")},parse:function(e){for(var r=e.length,i=[],a=0;a<r;a+=2)i[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new f.init(i,r/2)}},I=h.Latin1={stringify:function(e){for(var r=e.words,i=e.sigBytes,a=[],g=0;g<i;g++){var _=r[g>>>2]>>>24-g%4*8&255;a.push(String.fromCharCode(_))}return a.join("")},parse:function(e){for(var r=e.length,i=[],a=0;a<r;a++)i[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new f.init(i,r)}},P=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(I.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return I.parse(unescape(encodeURIComponent(e)))}},K=S.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=P.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var r=this._data,i=r.words,a=r.sigBytes,g=this.blockSize,_=a/(4*g),x=(_=e?l.ceil(_):l.max((0|_)-this._minBufferSize,0))*g,F=l.min(4*x,a);if(x){for(var A=0;A<x;A+=g)this._doProcessBlock(i,A);var k=i.splice(0,x);r.sigBytes-=F}return new f.init(k,F)},clone:function(){var e=d.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),S.Hasher=K.extend({cfg:d.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){K.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(r,i){return new e.init(i).finalize(r)}},_createHmacHelper:function(e){return function(r,i){return new L.HMAC.init(e,i).finalize(r)}}}),L=w.algo={},w);(function(t){var e,r=(e=J).lib,i=r.Base,a=r.WordArray;(e=e.x64={}).Word=i.extend({init:function(_,x){this.high=_,this.low=x}}),e.WordArray=i.extend({init:function(_,x){_=this.words=_||[],this.sigBytes=x??8*_.length},toX32:function(){for(var _=this.words,x=_.length,F=[],A=0;A<x;A++){var k=_[A];F.push(k.high),F.push(k.low)}return a.create(F,this.sigBytes)},clone:function(){for(var _=i.clone.call(this),x=_.words=this.words.slice(0),F=x.length,A=0;A<F;A++)x[A]=x[A].clone();return _}})})(),function(){var t=J,e=t.lib.WordArray;t.enc.Base64={stringify:function(i){var a=i.words,g=i.sigBytes,_=this._map;i.clamp(),i=[];for(var x=0;x<g;x+=3)for(var F=(a[x>>>2]>>>24-x%4*8&255)<<16|(a[x+1>>>2]>>>24-(x+1)%4*8&255)<<8|a[x+2>>>2]>>>24-(x+2)%4*8&255,A=0;4>A&&x+.75*A<g;A++)i.push(_.charAt(F>>>6*(3-A)&63));if(a=_.charAt(64))for(;i.length%4;)i.push(a);return i.join("")},parse:function(i){var a=i.length,g=this._map;(_=g.charAt(64))&&(_=i.indexOf(_))!=-1&&(a=_);for(var _=[],x=0,F=0;F<a;F++)if(F%4){var A=g.indexOf(i.charAt(F-1))<<F%4*2,k=g.indexOf(i.charAt(F))>>>6-F%4*2;_[x>>>2]|=(A|k)<<24-x%4*8,x++}return e.create(_,x)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){for(var e=J,r=(a=e.lib).WordArray,i=a.Hasher,a=e.algo,g=[],_=[],x=function(Q){return 4294967296*(Q-(0|Q))|0},F=2,A=0;64>A;){var k;e:{k=F;for(var U=t.sqrt(k),H=2;H<=U;H++)if(!(k%H)){k=!1;break e}k=!0}k&&(8>A&&(g[A]=x(t.pow(F,.5))),_[A]=x(t.pow(F,1/3)),A++),F++}var q=[];a=a.SHA256=i.extend({_doReset:function(){this._hash=new r.init(g.slice(0))},_doProcessBlock:function(Q,Z){for(var m=this._hash.words,C=m[0],D=m[1],O=m[2],Y=m[3],ee=m[4],ue=m[5],ne=m[6],ge=m[7],ae=0;64>ae;ae++){if(16>ae)q[ae]=0|Q[Z+ae];else{var le=q[ae-15],Ee=q[ae-2];q[ae]=((le<<25|le>>>7)^(le<<14|le>>>18)^le>>>3)+q[ae-7]+((Ee<<15|Ee>>>17)^(Ee<<13|Ee>>>19)^Ee>>>10)+q[ae-16]}le=ge+((ee<<26|ee>>>6)^(ee<<21|ee>>>11)^(ee<<7|ee>>>25))+(ee&ue^~ee&ne)+_[ae]+q[ae],Ee=((C<<30|C>>>2)^(C<<19|C>>>13)^(C<<10|C>>>22))+(C&D^C&O^D&O),ge=ne,ne=ue,ue=ee,ee=Y+le|0,Y=O,O=D,D=C,C=le+Ee|0}m[0]=m[0]+C|0,m[1]=m[1]+D|0,m[2]=m[2]+O|0,m[3]=m[3]+Y|0,m[4]=m[4]+ee|0,m[5]=m[5]+ue|0,m[6]=m[6]+ne|0,m[7]=m[7]+ge|0},_doFinalize:function(){var Q=this._data,Z=Q.words,m=8*this._nDataBytes,C=8*Q.sigBytes;return Z[C>>>5]|=128<<24-C%32,Z[14+(C+64>>>9<<4)]=t.floor(m/4294967296),Z[15+(C+64>>>9<<4)]=m,Q.sigBytes=4*Z.length,this._process(),this._hash},clone:function(){var Q=i.clone.call(this);return Q._hash=this._hash.clone(),Q}}),e.SHA256=i._createHelper(a),e.HmacSHA256=i._createHmacHelper(a)}(Math),function(){function t(){return i.create.apply(i,arguments)}for(var e=J,r=e.lib.Hasher,i=(g=e.x64).Word,a=g.WordArray,g=e.algo,_=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],x=[],F=0;80>F;F++)x[F]=t();g=g.SHA512=r.extend({_doReset:function(){this._hash=new a.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(k,U){for(var H=(D=this._hash.words)[0],q=D[1],z=D[2],Q=D[3],Z=D[4],m=D[5],C=D[6],D=D[7],O=H.high,Y=H.low,ee=q.high,ue=q.low,ne=z.high,ge=z.low,ae=Q.high,le=Q.low,Ee=Z.high,Pe=Z.low,Ae=m.high,st=m.low,Qe=C.high,Ze=C.low,Ue=D.high,Me=D.low,Je=O,et=Y,qt=ee,Ot=ue,$t=ne,Ht=ge,Er=ae,zt=le,pt=Ee,dt=Pe,sr=Ae,Gt=st,ar=Qe,Yt=Ze,Fr=Ue,Xt=Me,yt=0;80>yt;yt++){var Ct=x[yt];if(16>yt)var At=Ct.high=0|k[U+2*yt],Te=Ct.low=0|k[U+2*yt+1];else{At=((Te=(At=x[yt-15]).high)>>>1|(xt=At.low)<<31)^(Te>>>8|xt<<24)^Te>>>7;var xt=(xt>>>1|Te<<31)^(xt>>>8|Te<<24)^(xt>>>7|Te<<25),Mt=((Te=(Mt=x[yt-2]).high)>>>19|(Be=Mt.low)<<13)^(Te<<3|Be>>>29)^Te>>>6,Be=(Be>>>19|Te<<13)^(Be<<3|Te>>>29)^(Be>>>6|Te<<26),Ar=(Te=x[yt-7]).high,It=(Ut=x[yt-16]).high,Ut=Ut.low;At=(At=(At=At+Ar+((Te=xt+Te.low)>>>0<xt>>>0?1:0))+Mt+((Te=Te+Be)>>>0<Be>>>0?1:0))+It+((Te=Te+Ut)>>>0<Ut>>>0?1:0),Ct.high=At,Ct.low=Te}Ar=pt&sr^~pt&ar,Ut=dt&Gt^~dt&Yt,Ct=Je&qt^Je&$t^qt&$t;var Ai=et&Ot^et&Ht^Ot&Ht,xi=(xt=(Je>>>28|et<<4)^(Je<<30|et>>>2)^(Je<<25|et>>>7),Mt=(et>>>28|Je<<4)^(et<<30|Je>>>2)^(et<<25|Je>>>7),(Be=_[yt]).high),cn=Be.low;It=Fr+((pt>>>14|dt<<18)^(pt>>>18|dt<<14)^(pt<<23|dt>>>9))+((Be=Xt+((dt>>>14|pt<<18)^(dt>>>18|pt<<14)^(dt<<23|pt>>>9)))>>>0<Xt>>>0?1:0),Fr=ar,Xt=Yt,ar=sr,Yt=Gt,sr=pt,Gt=dt,pt=Er+(It=(It=(It=It+Ar+((Be=Be+Ut)>>>0<Ut>>>0?1:0))+xi+((Be=Be+cn)>>>0<cn>>>0?1:0))+At+((Be=Be+Te)>>>0<Te>>>0?1:0))+((dt=zt+Be|0)>>>0<zt>>>0?1:0)|0,Er=$t,zt=Ht,$t=qt,Ht=Ot,qt=Je,Ot=et,Je=It+(Ct=xt+Ct+((Te=Mt+Ai)>>>0<Mt>>>0?1:0))+((et=Be+Te|0)>>>0<Be>>>0?1:0)|0}Y=H.low=Y+et,H.high=O+Je+(Y>>>0<et>>>0?1:0),ue=q.low=ue+Ot,q.high=ee+qt+(ue>>>0<Ot>>>0?1:0),ge=z.low=ge+Ht,z.high=ne+$t+(ge>>>0<Ht>>>0?1:0),le=Q.low=le+zt,Q.high=ae+Er+(le>>>0<zt>>>0?1:0),Pe=Z.low=Pe+dt,Z.high=Ee+pt+(Pe>>>0<dt>>>0?1:0),st=m.low=st+Gt,m.high=Ae+sr+(st>>>0<Gt>>>0?1:0),Ze=C.low=Ze+Yt,C.high=Qe+ar+(Ze>>>0<Yt>>>0?1:0),Me=D.low=Me+Xt,D.high=Ue+Fr+(Me>>>0<Xt>>>0?1:0)},_doFinalize:function(){var k=this._data,U=k.words,H=8*this._nDataBytes,q=8*k.sigBytes;return U[q>>>5]|=128<<24-q%32,U[30+(q+128>>>10<<5)]=Math.floor(H/4294967296),U[31+(q+128>>>10<<5)]=H,k.sigBytes=4*U.length,this._process(),this._hash.toX32()},clone:function(){var k=r.clone.call(this);return k._hash=this._hash.clone(),k},blockSize:32}),e.SHA512=r._createHelper(g),e.HmacSHA512=r._createHmacHelper(g)}(),function(){var t=J,e=(a=t.x64).Word,r=a.WordArray,i=(a=t.algo).SHA512,a=a.SHA384=i.extend({_doReset:function(){this._hash=new r.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var _=i._doFinalize.call(this);return _.sigBytes-=16,_}});t.SHA384=i._createHelper(a),t.HmacSHA384=i._createHmacHelper(a)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var G,$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function j(t){var e,r,i="";for(e=0;e+3<=t.length;e+=3)r=parseInt(t.substring(e,e+3),16),i+=$.charAt(r>>6)+$.charAt(63&r);for(e+1==t.length?(r=parseInt(t.substring(e,e+1),16),i+=$.charAt(r<<2)):e+2==t.length&&(r=parseInt(t.substring(e,e+2),16),i+=$.charAt(r>>2)+$.charAt((3&r)<<4)),"=";(3&i.length)>0;)i+="=";return i}function re(t){var e,r,i,a="",g=0;for(e=0;e<t.length&&t.charAt(e)!="=";++e)(i=$.indexOf(t.charAt(e)))<0||(g==0?(a+=Ie(i>>2),r=3&i,g=1):g==1?(a+=Ie(r<<2|i>>4),r=15&i,g=2):g==2?(a+=Ie(r),a+=Ie(i>>2),r=3&i,g=3):(a+=Ie(r<<2|i>>4),a+=Ie(15&i),g=0));return g==1&&(a+=Ie(r<<2)),a}function ie(t){var e,r=re(t),i=new Array;for(e=0;2*e<r.length;++e)i[e]=parseInt(r.substring(2*e,2*e+2),16);return i}function B(t,e,r){t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}function oe(){return new B(null)}R.appName=="Microsoft Internet Explorer"?(B.prototype.am=function(e,r,i,a,g,_){for(var x=32767&r,F=r>>15;--_>=0;){var A=32767&this[e],k=this[e++]>>15,U=F*A+k*x;g=((A=x*A+((32767&U)<<15)+i[a]+(1073741823&g))>>>30)+(U>>>15)+F*k+(g>>>30),i[a++]=1073741823&A}return g},G=30):R.appName!="Netscape"?(B.prototype.am=function(e,r,i,a,g,_){for(;--_>=0;){var x=r*this[e++]+i[a]+g;g=Math.floor(x/67108864),i[a++]=67108863&x}return g},G=26):(B.prototype.am=function(e,r,i,a,g,_){for(var x=16383&r,F=r>>14;--_>=0;){var A=16383&this[e],k=this[e++]>>14,U=F*A+k*x;g=((A=x*A+((16383&U)<<14)+i[a]+g)>>28)+(U>>14)+F*k,i[a++]=268435455&A}return g},G=28),B.prototype.DB=G,B.prototype.DM=(1<<G)-1,B.prototype.DV=1<<G,B.prototype.FV=Math.pow(2,52),B.prototype.F1=52-G,B.prototype.F2=2*G-52;var _e,me,$e=new Array;for(_e="0".charCodeAt(0),me=0;me<=9;++me)$e[_e++]=me;for(_e="a".charCodeAt(0),me=10;me<36;++me)$e[_e++]=me;for(_e="A".charCodeAt(0),me=10;me<36;++me)$e[_e++]=me;function Ie(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function ze(t,e){var r=$e[t.charCodeAt(e)];return r??-1}function Le(t){var e=oe();return e.fromInt(t),e}function Ge(t){var e,r=1;return(e=t>>>16)!=0&&(t=e,r+=16),(e=t>>8)!=0&&(t=e,r+=8),(e=t>>4)!=0&&(t=e,r+=4),(e=t>>2)!=0&&(t=e,r+=2),(e=t>>1)!=0&&(t=e,r+=1),r}function fe(t){this.m=t}function ye(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function Ve(t,e){return t&e}function Ye(t,e){return t|e}function tt(t,e){return t^e}function rt(t,e){return t&~e}function ct(t){if(t==0)return-1;var e=0;return!(65535&t)&&(t>>=16,e+=16),!(255&t)&&(t>>=8,e+=8),!(15&t)&&(t>>=4,e+=4),!(3&t)&&(t>>=2,e+=2),!(1&t)&&++e,e}function Et(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function Xe(){}function nt(t){return t}function Ke(t){this.r2=oe(),this.q3=oe(),B.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}fe.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},fe.prototype.revert=function(e){return e},fe.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},fe.prototype.mulTo=function(e,r,i){e.multiplyTo(r,i),this.reduce(i)},fe.prototype.sqrTo=function(e,r){e.squareTo(r),this.reduce(r)},ye.prototype.convert=function(e){var r=oe();return e.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),e.s<0&&r.compareTo(B.ZERO)>0&&this.m.subTo(r,r),r},ye.prototype.revert=function(e){var r=oe();return e.copyTo(r),this.reduce(r),r},ye.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var r=0;r<this.m.t;++r){var i=32767&e[r],a=i*this.mpl+((i*this.mph+(e[r]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=r+this.m.t]+=this.m.am(0,a,e,r,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},ye.prototype.mulTo=function(e,r,i){e.multiplyTo(r,i),this.reduce(i)},ye.prototype.sqrTo=function(e,r){e.squareTo(r),this.reduce(r)},B.prototype.copyTo=function(e){for(var r=this.t-1;r>=0;--r)e[r]=this[r];e.t=this.t,e.s=this.s},B.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},B.prototype.fromString=function(e,r){var i;if(r==16)i=4;else if(r==8)i=3;else if(r==256)i=8;else if(r==2)i=1;else if(r==32)i=5;else{if(r!=4)return void this.fromRadix(e,r);i=2}this.t=0,this.s=0;for(var a=e.length,g=!1,_=0;--a>=0;){var x=i==8?255&e[a]:ze(e,a);x<0?e.charAt(a)=="-"&&(g=!0):(g=!1,_==0?this[this.t++]=x:_+i>this.DB?(this[this.t-1]|=(x&(1<<this.DB-_)-1)<<_,this[this.t++]=x>>this.DB-_):this[this.t-1]|=x<<_,(_+=i)>=this.DB&&(_-=this.DB))}i==8&&128&e[0]&&(this.s=-1,_>0&&(this[this.t-1]|=(1<<this.DB-_)-1<<_)),this.clamp(),g&&B.ZERO.subTo(this,this)},B.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},B.prototype.dlShiftTo=function(e,r){var i;for(i=this.t-1;i>=0;--i)r[i+e]=this[i];for(i=e-1;i>=0;--i)r[i]=0;r.t=this.t+e,r.s=this.s},B.prototype.drShiftTo=function(e,r){for(var i=e;i<this.t;++i)r[i-e]=this[i];r.t=Math.max(this.t-e,0),r.s=this.s},B.prototype.lShiftTo=function(e,r){var i,a=e%this.DB,g=this.DB-a,_=(1<<g)-1,x=Math.floor(e/this.DB),F=this.s<<a&this.DM;for(i=this.t-1;i>=0;--i)r[i+x+1]=this[i]>>g|F,F=(this[i]&_)<<a;for(i=x-1;i>=0;--i)r[i]=0;r[x]=F,r.t=this.t+x+1,r.s=this.s,r.clamp()},B.prototype.rShiftTo=function(e,r){r.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)r.t=0;else{var a=e%this.DB,g=this.DB-a,_=(1<<a)-1;r[0]=this[i]>>a;for(var x=i+1;x<this.t;++x)r[x-i-1]|=(this[x]&_)<<g,r[x-i]=this[x]>>a;a>0&&(r[this.t-i-1]|=(this.s&_)<<g),r.t=this.t-i,r.clamp()}},B.prototype.subTo=function(e,r){for(var i=0,a=0,g=Math.min(e.t,this.t);i<g;)a+=this[i]-e[i],r[i++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a-=e.s;i<this.t;)a+=this[i],r[i++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;i<e.t;)a-=e[i],r[i++]=a&this.DM,a>>=this.DB;a-=e.s}r.s=a<0?-1:0,a<-1?r[i++]=this.DV+a:a>0&&(r[i++]=a),r.t=i,r.clamp()},B.prototype.multiplyTo=function(e,r){var i=this.abs(),a=e.abs(),g=i.t;for(r.t=g+a.t;--g>=0;)r[g]=0;for(g=0;g<a.t;++g)r[g+i.t]=i.am(0,a[g],r,g,0,i.t);r.s=0,r.clamp(),this.s!=e.s&&B.ZERO.subTo(r,r)},B.prototype.squareTo=function(e){for(var r=this.abs(),i=e.t=2*r.t;--i>=0;)e[i]=0;for(i=0;i<r.t-1;++i){var a=r.am(i,r[i],e,2*i,0,1);(e[i+r.t]+=r.am(i+1,2*r[i],e,2*i+1,a,r.t-i-1))>=r.DV&&(e[i+r.t]-=r.DV,e[i+r.t+1]=1)}e.t>0&&(e[e.t-1]+=r.am(i,r[i],e,2*i,0,1)),e.s=0,e.clamp()},B.prototype.divRemTo=function(e,r,i){var a=e.abs();if(!(a.t<=0)){var g=this.abs();if(g.t<a.t)return r!=null&&r.fromInt(0),void(i!=null&&this.copyTo(i));i==null&&(i=oe());var _=oe(),x=this.s,F=e.s,A=this.DB-Ge(a[a.t-1]);A>0?(a.lShiftTo(A,_),g.lShiftTo(A,i)):(a.copyTo(_),g.copyTo(i));var k=_.t,U=_[k-1];if(U!=0){var H=U*(1<<this.F1)+(k>1?_[k-2]>>this.F2:0),q=this.FV/H,z=(1<<this.F1)/H,Q=1<<this.F2,Z=i.t,m=Z-k,C=r??oe();for(_.dlShiftTo(m,C),i.compareTo(C)>=0&&(i[i.t++]=1,i.subTo(C,i)),B.ONE.dlShiftTo(k,C),C.subTo(_,_);_.t<k;)_[_.t++]=0;for(;--m>=0;){var D=i[--Z]==U?this.DM:Math.floor(i[Z]*q+(i[Z-1]+Q)*z);if((i[Z]+=_.am(0,D,i,m,0,k))<D)for(_.dlShiftTo(m,C),i.subTo(C,i);i[Z]<--D;)i.subTo(C,i)}r!=null&&(i.drShiftTo(k,r),x!=F&&B.ZERO.subTo(r,r)),i.t=k,i.clamp(),A>0&&i.rShiftTo(A,i),x<0&&B.ZERO.subTo(i,i)}}},B.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var r=3&e;return(r=(r=(r=(r=r*(2-(15&e)*r)&15)*(2-(255&e)*r)&255)*(2-((65535&e)*r&65535))&65535)*(2-e*r%this.DV)%this.DV)>0?this.DV-r:-r},B.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},B.prototype.exp=function(e,r){if(e>4294967295||e<1)return B.ONE;var i=oe(),a=oe(),g=r.convert(this),_=Ge(e)-1;for(g.copyTo(i);--_>=0;)if(r.sqrTo(i,a),(e&1<<_)>0)r.mulTo(a,g,i);else{var x=i;i=a,a=x}return r.revert(i)},B.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var r;if(e==16)r=4;else if(e==8)r=3;else if(e==2)r=1;else if(e==32)r=5;else{if(e!=4)return this.toRadix(e);r=2}var i,a=(1<<r)-1,g=!1,_="",x=this.t,F=this.DB-x*this.DB%r;if(x-- >0)for(F<this.DB&&(i=this[x]>>F)>0&&(g=!0,_=Ie(i));x>=0;)F<r?(i=(this[x]&(1<<F)-1)<<r-F,i|=this[--x]>>(F+=this.DB-r)):(i=this[x]>>(F-=r)&a,F<=0&&(F+=this.DB,--x)),i>0&&(g=!0),g&&(_+=Ie(i));return g?_:"0"},B.prototype.negate=function(){var e=oe();return B.ZERO.subTo(this,e),e},B.prototype.abs=function(){return this.s<0?this.negate():this},B.prototype.compareTo=function(e){var r=this.s-e.s;if(r!=0)return r;var i=this.t;if((r=i-e.t)!=0)return this.s<0?-r:r;for(;--i>=0;)if((r=this[i]-e[i])!=0)return r;return 0},B.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Ge(this[this.t-1]^this.s&this.DM)},B.prototype.mod=function(e){var r=oe();return this.abs().divRemTo(e,null,r),this.s<0&&r.compareTo(B.ZERO)>0&&e.subTo(r,r),r},B.prototype.modPowInt=function(e,r){var i;return i=e<256||r.isEven()?new fe(r):new ye(r),this.exp(e,i)},B.ZERO=Le(0),B.ONE=Le(1),Xe.prototype.convert=nt,Xe.prototype.revert=nt,Xe.prototype.mulTo=function(e,r,i){e.multiplyTo(r,i)},Xe.prototype.sqrTo=function(e,r){e.squareTo(r)},Ke.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var r=oe();return e.copyTo(r),this.reduce(r),r},Ke.prototype.revert=function(e){return e},Ke.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},Ke.prototype.mulTo=function(e,r,i){e.multiplyTo(r,i),this.reduce(i)},Ke.prototype.sqrTo=function(e,r){e.squareTo(r),this.reduce(r)};var xe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],V=(1<<26)/xe[xe.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function p(){this.i=0,this.j=0,this.S=new Array}B.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},B.prototype.toRadix=function(e){if(e==null&&(e=10),this.signum()==0||e<2||e>36)return"0";var r=this.chunkSize(e),i=Math.pow(e,r),a=Le(i),g=oe(),_=oe(),x="";for(this.divRemTo(a,g,_);g.signum()>0;)x=(i+_.intValue()).toString(e).substr(1)+x,g.divRemTo(a,g,_);return _.intValue().toString(e)+x},B.prototype.fromRadix=function(e,r){this.fromInt(0),r==null&&(r=10);for(var i=this.chunkSize(r),a=Math.pow(r,i),g=!1,_=0,x=0,F=0;F<e.length;++F){var A=ze(e,F);A<0?e.charAt(F)=="-"&&this.signum()==0&&(g=!0):(x=r*x+A,++_>=i&&(this.dMultiply(a),this.dAddOffset(x,0),_=0,x=0))}_>0&&(this.dMultiply(Math.pow(r,_)),this.dAddOffset(x,0)),g&&B.ZERO.subTo(this,this)},B.prototype.fromNumber=function(e,r,i){if(typeof r=="number")if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(B.ONE.shiftLeft(e-1),Ye,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(B.ONE.shiftLeft(e-1),this);else{var a=new Array,g=7&e;a.length=1+(e>>3),r.nextBytes(a),g>0?a[0]&=(1<<g)-1:a[0]=0,this.fromString(a,256)}},B.prototype.bitwiseTo=function(e,r,i){var a,g,_=Math.min(e.t,this.t);for(a=0;a<_;++a)i[a]=r(this[a],e[a]);if(e.t<this.t){for(g=e.s&this.DM,a=_;a<this.t;++a)i[a]=r(this[a],g);i.t=this.t}else{for(g=this.s&this.DM,a=_;a<e.t;++a)i[a]=r(g,e[a]);i.t=e.t}i.s=r(this.s,e.s),i.clamp()},B.prototype.changeBit=function(e,r){var i=B.ONE.shiftLeft(e);return this.bitwiseTo(i,r,i),i},B.prototype.addTo=function(e,r){for(var i=0,a=0,g=Math.min(e.t,this.t);i<g;)a+=this[i]+e[i],r[i++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a+=e.s;i<this.t;)a+=this[i],r[i++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;i<e.t;)a+=e[i],r[i++]=a&this.DM,a>>=this.DB;a+=e.s}r.s=a<0?-1:0,a>0?r[i++]=a:a<-1&&(r[i++]=this.DV+a),r.t=i,r.clamp()},B.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},B.prototype.dAddOffset=function(e,r){if(e!=0){for(;this.t<=r;)this[this.t++]=0;for(this[r]+=e;this[r]>=this.DV;)this[r]-=this.DV,++r>=this.t&&(this[this.t++]=0),++this[r]}},B.prototype.multiplyLowerTo=function(e,r,i){var a,g=Math.min(this.t+e.t,r);for(i.s=0,i.t=g;g>0;)i[--g]=0;for(a=i.t-this.t;g<a;++g)i[g+this.t]=this.am(0,e[g],i,g,0,this.t);for(a=Math.min(e.t,r);g<a;++g)this.am(0,e[g],i,g,0,r-g);i.clamp()},B.prototype.multiplyUpperTo=function(e,r,i){--r;var a=i.t=this.t+e.t-r;for(i.s=0;--a>=0;)i[a]=0;for(a=Math.max(r-this.t,0);a<e.t;++a)i[this.t+a-r]=this.am(r-a,e[a],i,0,0,this.t+a-r);i.clamp(),i.drShiftTo(1,i)},B.prototype.modInt=function(e){if(e<=0)return 0;var r=this.DV%e,i=this.s<0?e-1:0;if(this.t>0)if(r==0)i=this[0]%e;else for(var a=this.t-1;a>=0;--a)i=(r*i+this[a])%e;return i},B.prototype.millerRabin=function(e){var r=this.subtract(B.ONE),i=r.getLowestSetBit();if(i<=0)return!1;var a=r.shiftRight(i);(e=e+1>>1)>xe.length&&(e=xe.length);for(var g=oe(),_=0;_<e;++_){g.fromInt(xe[Math.floor(Math.random()*xe.length)]);var x=g.modPow(a,this);if(x.compareTo(B.ONE)!=0&&x.compareTo(r)!=0){for(var F=1;F++<i&&x.compareTo(r)!=0;)if((x=x.modPowInt(2,this)).compareTo(B.ONE)==0)return!1;if(x.compareTo(r)!=0)return!1}}return!0},B.prototype.clone=function(){var e=oe();return this.copyTo(e),e},B.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},B.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},B.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},B.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},B.prototype.toByteArray=function(){var e=this.t,r=new Array;r[0]=this.s;var i,a=this.DB-e*this.DB%8,g=0;if(e-- >0)for(a<this.DB&&(i=this[e]>>a)!=(this.s&this.DM)>>a&&(r[g++]=i|this.s<<this.DB-a);e>=0;)a<8?(i=(this[e]&(1<<a)-1)<<8-a,i|=this[--e]>>(a+=this.DB-8)):(i=this[e]>>(a-=8)&255,a<=0&&(a+=this.DB,--e)),128&i&&(i|=-256),g==0&&(128&this.s)!=(128&i)&&++g,(g>0||i!=this.s)&&(r[g++]=i);return r},B.prototype.equals=function(e){return this.compareTo(e)==0},B.prototype.min=function(e){return this.compareTo(e)<0?this:e},B.prototype.max=function(e){return this.compareTo(e)>0?this:e},B.prototype.and=function(e){var r=oe();return this.bitwiseTo(e,Ve,r),r},B.prototype.or=function(e){var r=oe();return this.bitwiseTo(e,Ye,r),r},B.prototype.xor=function(e){var r=oe();return this.bitwiseTo(e,tt,r),r},B.prototype.andNot=function(e){var r=oe();return this.bitwiseTo(e,rt,r),r},B.prototype.not=function(){for(var e=oe(),r=0;r<this.t;++r)e[r]=this.DM&~this[r];return e.t=this.t,e.s=~this.s,e},B.prototype.shiftLeft=function(e){var r=oe();return e<0?this.rShiftTo(-e,r):this.lShiftTo(e,r),r},B.prototype.shiftRight=function(e){var r=oe();return e<0?this.lShiftTo(-e,r):this.rShiftTo(e,r),r},B.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+ct(this[e]);return this.s<0?this.t*this.DB:-1},B.prototype.bitCount=function(){for(var e=0,r=this.s&this.DM,i=0;i<this.t;++i)e+=Et(this[i]^r);return e},B.prototype.testBit=function(e){var r=Math.floor(e/this.DB);return r>=this.t?this.s!=0:(this[r]&1<<e%this.DB)!=0},B.prototype.setBit=function(e){return this.changeBit(e,Ye)},B.prototype.clearBit=function(e){return this.changeBit(e,rt)},B.prototype.flipBit=function(e){return this.changeBit(e,tt)},B.prototype.add=function(e){var r=oe();return this.addTo(e,r),r},B.prototype.subtract=function(e){var r=oe();return this.subTo(e,r),r},B.prototype.multiply=function(e){var r=oe();return this.multiplyTo(e,r),r},B.prototype.divide=function(e){var r=oe();return this.divRemTo(e,r,null),r},B.prototype.remainder=function(e){var r=oe();return this.divRemTo(e,null,r),r},B.prototype.divideAndRemainder=function(e){var r=oe(),i=oe();return this.divRemTo(e,r,i),new Array(r,i)},B.prototype.modPow=function(e,r){var i,a,g=e.bitLength(),_=Le(1);if(g<=0)return _;i=g<18?1:g<48?3:g<144?4:g<768?5:6,a=g<8?new fe(r):r.isEven()?new Ke(r):new ye(r);var x=new Array,F=3,A=i-1,k=(1<<i)-1;if(x[1]=a.convert(this),i>1){var U=oe();for(a.sqrTo(x[1],U);F<=k;)x[F]=oe(),a.mulTo(U,x[F-2],x[F]),F+=2}var H,q,z=e.t-1,Q=!0,Z=oe();for(g=Ge(e[z])-1;z>=0;){for(g>=A?H=e[z]>>g-A&k:(H=(e[z]&(1<<g+1)-1)<<A-g,z>0&&(H|=e[z-1]>>this.DB+g-A)),F=i;!(1&H);)H>>=1,--F;if((g-=F)<0&&(g+=this.DB,--z),Q)x[H].copyTo(_),Q=!1;else{for(;F>1;)a.sqrTo(_,Z),a.sqrTo(Z,_),F-=2;F>0?a.sqrTo(_,Z):(q=_,_=Z,Z=q),a.mulTo(Z,x[H],_)}for(;z>=0&&!(e[z]&1<<g);)a.sqrTo(_,Z),q=_,_=Z,Z=q,--g<0&&(g=this.DB-1,--z)}return a.revert(_)},B.prototype.modInverse=function(e){var r=e.isEven();if(this.isEven()&&r||e.signum()==0)return B.ZERO;for(var i=e.clone(),a=this.clone(),g=Le(1),_=Le(0),x=Le(0),F=Le(1);i.signum()!=0;){for(;i.isEven();)i.rShiftTo(1,i),r?(g.isEven()&&_.isEven()||(g.addTo(this,g),_.subTo(e,_)),g.rShiftTo(1,g)):_.isEven()||_.subTo(e,_),_.rShiftTo(1,_);for(;a.isEven();)a.rShiftTo(1,a),r?(x.isEven()&&F.isEven()||(x.addTo(this,x),F.subTo(e,F)),x.rShiftTo(1,x)):F.isEven()||F.subTo(e,F),F.rShiftTo(1,F);i.compareTo(a)>=0?(i.subTo(a,i),r&&g.subTo(x,g),_.subTo(F,_)):(a.subTo(i,a),r&&x.subTo(g,x),F.subTo(_,F))}return a.compareTo(B.ONE)!=0?B.ZERO:F.compareTo(e)>=0?F.subtract(e):F.signum()<0?(F.addTo(e,F),F.signum()<0?F.add(e):F):F},B.prototype.pow=function(e){return this.exp(e,new Xe)},B.prototype.gcd=function(e){var r=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(r.compareTo(i)<0){var a=r;r=i,i=a}var g=r.getLowestSetBit(),_=i.getLowestSetBit();if(_<0)return r;for(g<_&&(_=g),_>0&&(r.rShiftTo(_,r),i.rShiftTo(_,i));r.signum()>0;)(g=r.getLowestSetBit())>0&&r.rShiftTo(g,r),(g=i.getLowestSetBit())>0&&i.rShiftTo(g,i),r.compareTo(i)>=0?(r.subTo(i,r),r.rShiftTo(1,r)):(i.subTo(r,i),i.rShiftTo(1,i));return _>0&&i.lShiftTo(_,i),i},B.prototype.isProbablePrime=function(e){var r,i=this.abs();if(i.t==1&&i[0]<=xe[xe.length-1]){for(r=0;r<xe.length;++r)if(i[0]==xe[r])return!0;return!1}if(i.isEven())return!1;for(r=1;r<xe.length;){for(var a=xe[r],g=r+1;g<xe.length&&a<V;)a*=xe[g++];for(a=i.modInt(a);r<g;)if(a%xe[r++]==0)return!1}return i.millerRabin(e)},B.prototype.square=function(){var e=oe();return this.squareTo(e),e},p.prototype.init=function(e){var r,i,a;for(r=0;r<256;++r)this.S[r]=r;for(i=0,r=0;r<256;++r)i=i+this.S[r]+e[r%e.length]&255,a=this.S[r],this.S[r]=this.S[i],this.S[i]=a;this.i=0,this.j=0},p.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var y,N,W;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function X(){(function(e){N[W++]^=255&e,N[W++]^=e>>8&255,N[W++]^=e>>16&255,N[W++]^=e>>24&255,W>=256&&(W-=256)})(new Date().getTime())}if(N==null){var te;if(N=new Array,W=0,M!==void 0&&(M.crypto!==void 0||M.msCrypto!==void 0)){var ce=M.crypto||M.msCrypto;if(ce.getRandomValues){var de=new Uint8Array(32);for(ce.getRandomValues(de),te=0;te<32;++te)N[W++]=de[te]}else if(R.appName=="Netscape"&&R.appVersion<"5"){var Se=M.crypto.random(32);for(te=0;te<Se.length;++te)N[W++]=255&Se.charCodeAt(te)}}for(;W<256;)te=Math.floor(65536*Math.random()),N[W++]=te>>>8,N[W++]=255&te;W=0,X()}function ve(){if(y==null){for(X(),(y=function(){return new p}()).init(N),W=0;W<N.length;++W)N[W]=0;W=0}return y.next()}function we(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function it(t,e){return new B(t,e)}function ft(t,e,r){for(var i="",a=0;i.length<e;)i+=r(String.fromCharCode.apply(String,t.concat([(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a]))),a+=1;return i}function he(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function ke(t,e){this.x=e,this.q=t}function pe(t,e,r,i){this.curve=t,this.x=e,this.y=r,this.z=i??B.ONE,this.zinv=null}function ht(t,e,r){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(r),this.infinity=new pe(this,null,null)}we.prototype.nextBytes=function(e){var r;for(r=0;r<e.length;++r)e[r]=ve()},he.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},he.prototype.setPublic=function(e,r){if(this.isPublic=!0,this.isPrivate=!1,typeof e!="string")this.n=e,this.e=r;else{if(!(e!=null&&r!=null&&e.length>0&&r.length>0))throw"Invalid RSA public key";this.n=it(e,16),this.e=parseInt(r,16)}},he.prototype.encrypt=function(e){var r=function(_,x){if(x<_.length+11)throw"Message too long for RSA";for(var F=new Array,A=_.length-1;A>=0&&x>0;){var k=_.charCodeAt(A--);k<128?F[--x]=k:k>127&&k<2048?(F[--x]=63&k|128,F[--x]=k>>6|192):(F[--x]=63&k|128,F[--x]=k>>6&63|128,F[--x]=k>>12|224)}F[--x]=0;for(var U=new we,H=new Array;x>2;){for(H[0]=0;H[0]==0;)U.nextBytes(H);F[--x]=H[0]}return F[--x]=2,F[--x]=0,new B(F)}(e,this.n.bitLength()+7>>3);if(r==null)return null;var i=this.doPublic(r);if(i==null)return null;var a=i.toString(16);return 1&a.length?"0"+a:a},he.prototype.encryptOAEP=function(e,r,i){var a=function(F,A,k,U){var H=E.crypto.MessageDigest,q=E.crypto.Util,z=null;if(k||(k="sha1"),typeof k=="string"&&(z=H.getCanonicalAlgName(k),U=H.getHashLength(z),k=function(ne){return lt(q.hashHex(mt(ne),z))}),F.length+2*U+2>A)throw"Message too long for RSA";var Q,Z="";for(Q=0;Q<A-F.length-2*U-2;Q+=1)Z+="\0";var m=k("")+Z+""+F,C=new Array(U);new we().nextBytes(C);var D=ft(C,m.length,k),O=[];for(Q=0;Q<m.length;Q+=1)O[Q]=m.charCodeAt(Q)^D.charCodeAt(Q);var Y=ft(O,C.length,k),ee=[0];for(Q=0;Q<C.length;Q+=1)ee[Q+1]=C[Q]^Y.charCodeAt(Q);return new B(ee.concat(O))}(e,this.n.bitLength()+7>>3,r,i);if(a==null)return null;var g=this.doPublic(a);if(g==null)return null;var _=g.toString(16);return 1&_.length?"0"+_:_},he.prototype.type="RSA",ke.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},ke.prototype.toBigInteger=function(){return this.x},ke.prototype.negate=function(){return new ke(this.q,this.x.negate().mod(this.q))},ke.prototype.add=function(e){return new ke(this.q,this.x.add(e.toBigInteger()).mod(this.q))},ke.prototype.subtract=function(e){return new ke(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},ke.prototype.multiply=function(e){return new ke(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},ke.prototype.square=function(){return new ke(this.q,this.x.square().mod(this.q))},ke.prototype.divide=function(e){return new ke(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},pe.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},pe.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},pe.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(B.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(B.ZERO))},pe.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(B.ZERO)&&!this.y.toBigInteger().equals(B.ZERO)},pe.prototype.negate=function(){return new pe(this.curve,this.x,this.y.negate(),this.z)},pe.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var r=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),i=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(B.ZERO.equals(i))return B.ZERO.equals(r)?this.twice():this.curve.getInfinity();var a=new B("3"),g=this.x.toBigInteger(),_=this.y.toBigInteger(),x=(e.x.toBigInteger(),e.y.toBigInteger(),i.square()),F=x.multiply(i),A=g.multiply(x),k=r.square().multiply(this.z),U=k.subtract(A.shiftLeft(1)).multiply(e.z).subtract(F).multiply(i).mod(this.curve.q),H=A.multiply(a).multiply(r).subtract(_.multiply(F)).subtract(k.multiply(r)).multiply(e.z).add(r.multiply(F)).mod(this.curve.q),q=F.multiply(this.z).multiply(e.z).mod(this.curve.q);return new pe(this.curve,this.curve.fromBigInteger(U),this.curve.fromBigInteger(H),q)},pe.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var e=new B("3"),r=this.x.toBigInteger(),i=this.y.toBigInteger(),a=i.multiply(this.z),g=a.multiply(i).mod(this.curve.q),_=this.curve.a.toBigInteger(),x=r.square().multiply(e);B.ZERO.equals(_)||(x=x.add(this.z.square().multiply(_)));var F=(x=x.mod(this.curve.q)).square().subtract(r.shiftLeft(3).multiply(g)).shiftLeft(1).multiply(a).mod(this.curve.q),A=x.multiply(e).multiply(r).subtract(g.shiftLeft(1)).shiftLeft(2).multiply(g).subtract(x.square().multiply(x)).mod(this.curve.q),k=a.square().multiply(a).shiftLeft(3).mod(this.curve.q);return new pe(this.curve,this.curve.fromBigInteger(F),this.curve.fromBigInteger(A),k)},pe.prototype.multiply=function(e){if(this.isInfinity())return this;if(e.signum()==0)return this.curve.getInfinity();var r,i=e,a=i.multiply(new B("3")),g=this.negate(),_=this,x=this.curve.q.subtract(e),F=x.multiply(new B("3")),A=new pe(this.curve,this.x,this.y),k=A.negate();for(r=a.bitLength()-2;r>0;--r){_=_.twice();var U=a.testBit(r);U!=i.testBit(r)&&(_=_.add(U?this:g))}for(r=F.bitLength()-2;r>0;--r){A=A.twice();var H=F.testBit(r);H!=x.testBit(r)&&(A=A.add(H?A:k))}return _},pe.prototype.multiplyTwo=function(e,r,i){var a;a=e.bitLength()>i.bitLength()?e.bitLength()-1:i.bitLength()-1;for(var g=this.curve.getInfinity(),_=this.add(r);a>=0;)g=g.twice(),e.testBit(a)?g=i.testBit(a)?g.add(_):g.add(this):i.testBit(a)&&(g=g.add(r)),--a;return g},ht.prototype.getQ=function(){return this.q},ht.prototype.getA=function(){return this.a},ht.prototype.getB=function(){return this.b},ht.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},ht.prototype.getInfinity=function(){return this.infinity},ht.prototype.fromBigInteger=function(e){return new ke(this.q,e)},ht.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var r=(e.length-2)/2,i=e.substr(2,r),a=e.substr(r+2,r);return new pe(this,this.fromBigInteger(new B(i,16)),this.fromBigInteger(new B(a,16)));default:return null}},ke.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},pe.prototype.getEncoded=function(t){var e=function(_,x){var F=_.toByteArrayUnsigned();if(x<F.length)F=F.slice(F.length-x);else for(;x>F.length;)F.unshift(0);return F},r=this.getX().toBigInteger(),i=this.getY().toBigInteger(),a=e(r,32);return t?i.isEven()?a.unshift(2):a.unshift(3):(a.unshift(4),a=a.concat(e(i,32))),a},pe.decodeFrom=function(t,e){e[0];var r=e.length-1,i=e.slice(1,1+r/2),a=e.slice(1+r/2,1+r);i.unshift(0),a.unshift(0);var g=new B(i),_=new B(a);return new pe(t,t.fromBigInteger(g),t.fromBigInteger(_))},pe.decodeFromHex=function(t,e){e.substr(0,2);var r=e.length-2,i=e.substr(2,r/2),a=e.substr(2+r/2,r/2),g=new B(i,16),_=new B(a,16);return new pe(t,t.fromBigInteger(g),t.fromBigInteger(_))},pe.prototype.add2D=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;if(this.x.equals(t.x))return this.y.equals(t.y)?this.twice():this.curve.getInfinity();var e=t.x.subtract(this.x),r=t.y.subtract(this.y).divide(e),i=r.square().subtract(this.x).subtract(t.x),a=r.multiply(this.x.subtract(i)).subtract(this.y);return new pe(this.curve,i,a)},pe.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=this.curve.fromBigInteger(B.valueOf(2)),e=this.curve.fromBigInteger(B.valueOf(3)),r=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(t)),i=r.square().subtract(this.x.multiply(t)),a=r.multiply(this.x.subtract(i)).subtract(this.y);return new pe(this.curve,i,a)},pe.prototype.multiply2D=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var e,r=t,i=r.multiply(new B("3")),a=this.negate(),g=this;for(e=i.bitLength()-2;e>0;--e){g=g.twice();var _=i.testBit(e);_!=r.testBit(e)&&(g=g.add2D(_?this:a))}return g},pe.prototype.isOnCurve=function(){var t=this.getX().toBigInteger(),e=this.getY().toBigInteger(),r=this.curve.getA().toBigInteger(),i=this.curve.getB().toBigInteger(),a=this.curve.getQ(),g=e.multiply(e).mod(a),_=t.multiply(t).multiply(t).add(r.multiply(t)).add(i).mod(a);return g.equals(_)},pe.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},pe.prototype.validate=function(){var t=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var e=this.getX().toBigInteger(),r=this.getY().toBigInteger();if(e.compareTo(B.ONE)<0||e.compareTo(t.subtract(B.ONE))>0)throw new Error("x coordinate out of bounds");if(r.compareTo(B.ONE)<0||r.compareTo(t.subtract(B.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(t).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var $r=function(){var t=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),e=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),r={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function i(_,x,F){return x?r[x]:String.fromCharCode(parseInt(F,16))}var a=new String(""),g=Object.hasOwnProperty;return function(_,x){var F,A,k=_.match(t),U=k[0],H=!1;U==="{"?F={}:U==="["?F=[]:(F=[],H=!0);for(var q=[F],z=1-H,Q=k.length;z<Q;++z){var Z;switch((U=k[z]).charCodeAt(0)){default:(Z=q[0])[A||Z.length]=+U,A=void 0;break;case 34:if((U=U.substring(1,U.length-1)).indexOf("\\")!==-1&&(U=U.replace(e,i)),Z=q[0],!A){if(!(Z instanceof Array)){A=U||a;break}A=Z.length}Z[A]=U,A=void 0;break;case 91:Z=q[0],q.unshift(Z[A||Z.length]=[]),A=void 0;break;case 93:q.shift();break;case 102:(Z=q[0])[A||Z.length]=!1,A=void 0;break;case 110:(Z=q[0])[A||Z.length]=null,A=void 0;break;case 116:(Z=q[0])[A||Z.length]=!0,A=void 0;break;case 123:Z=q[0],q.unshift(Z[A||Z.length]={}),A=void 0;break;case 125:q.shift()}}if(H){if(q.length!==1)throw new Error;F=F[0]}else if(q.length)throw new Error;return x&&(F=function m(C,D){var O=C[D];if(O&&(O===void 0?"undefined":T(O))==="object"){var Y=null;for(var ee in O)if(g.call(O,ee)&&O!==C){var ue=m(O,ee);ue!==void 0?O[ee]=ue:(Y||(Y=[]),Y.push(ee))}if(Y)for(var ne=Y.length;--ne>=0;)delete O[Y[ne]]}return x.call(C,D,O)}({"":F},"")),F}}();E!==void 0&&E||(o.KJUR=E={}),E.asn1!==void 0&&E.asn1||(E.asn1={}),E.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if(e.substr(0,1)!="-")e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var r=e.substr(1).length;r%2==1?r+=1:e.match(/^[0-7]/)||(r+=2);for(var i="",a=0;a<r;a++)i+="f";e=new B(i,16).xor(t).add(B.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return ot(t,e)},this.newObject=function(t){var e=E.asn1,r=e.ASN1Object,i=e.DERBoolean,a=e.DERInteger,g=e.DERBitString,_=e.DEROctetString,x=e.DERNull,F=e.DERObjectIdentifier,A=e.DEREnumerated,k=e.DERUTF8String,U=e.DERNumericString,H=e.DERPrintableString,q=e.DERTeletexString,z=e.DERIA5String,Q=e.DERUTCTime,Z=e.DERGeneralizedTime,m=e.DERVisibleString,C=e.DERBMPString,D=e.DERSequence,O=e.DERSet,Y=e.DERTaggedObject,ee=e.ASN1Util.newObject;if(t instanceof e.ASN1Object)return t;var ue=Object.keys(t);if(ue.length!=1)throw new Error("key of param shall be only one.");var ne=ue[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+ne+":")==-1)throw new Error("undefined key: "+ne);if(ne=="bool")return new i(t[ne]);if(ne=="int")return new a(t[ne]);if(ne=="bitstr")return new g(t[ne]);if(ne=="octstr")return new _(t[ne]);if(ne=="null")return new x(t[ne]);if(ne=="oid")return new F(t[ne]);if(ne=="enum")return new A(t[ne]);if(ne=="utf8str")return new k(t[ne]);if(ne=="numstr")return new U(t[ne]);if(ne=="prnstr")return new H(t[ne]);if(ne=="telstr")return new q(t[ne]);if(ne=="ia5str")return new z(t[ne]);if(ne=="utctime")return new Q(t[ne]);if(ne=="gentime")return new Z(t[ne]);if(ne=="visstr")return new m(t[ne]);if(ne=="bmpstr")return new C(t[ne]);if(ne=="asn1")return new r(t[ne]);if(ne=="seq"){for(var ge=t[ne],ae=[],le=0;le<ge.length;le++){var Ee=ee(ge[le]);ae.push(Ee)}return new D({array:ae})}if(ne=="set"){for(ge=t[ne],ae=[],le=0;le<ge.length;le++)Ee=ee(ge[le]),ae.push(Ee);return new O({array:ae})}if(ne=="tag"){var Pe=t[ne];if(Object.prototype.toString.call(Pe)==="[object Array]"&&Pe.length==3){var Ae=ee(Pe[2]);return new Y({tag:Pe[0],explicit:Pe[1],obj:Ae})}return new Y(Pe)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},E.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",r=parseInt(t.substr(0,2),16),i=(e=Math.floor(r/40)+"."+r%40,""),a=2;a<t.length;a+=2){var g=("00000000"+parseInt(t.substr(a,2),16).toString(2)).slice(-8);i+=g.substr(1,7),g.substr(0,1)=="0"&&(e=e+"."+new B(i,2).toString(10),i="")}return e},E.asn1.ASN1Util.oidIntToHex=function(t){var e=function(F){var A=F.toString(16);return A.length==1&&(A="0"+A),A},r=function(F){var A="",k=new B(F,10).toString(2),U=7-k.length%7;U==7&&(U=0);for(var H="",q=0;q<U;q++)H+="0";for(k=H+k,q=0;q<k.length-1;q+=7){var z=k.substr(q,7);q!=k.length-7&&(z="1"+z),A+=e(parseInt(z,2))}return A};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var i="",a=t.split("."),g=40*parseInt(a[0])+parseInt(a[1]);i+=e(g),a.splice(0,2);for(var _=0;_<a.length;_++)i+=r(a[_]);return i},E.asn1.ASN1Object=function(t){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var e=this.hV.length/2,r=e.toString(16);if(r.length%2==1&&(r="0"+r),e<128)return r;var i=r.length/2;if(i>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+i).toString(16)+r},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},t!=null&&t.tlv!=null&&(this.hTLV=t.tlv,this.isModified=!1)},E.asn1.DERAbstractString=function(t){E.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=_r(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"?this.setString(t):t.str!==void 0?this.setString(t.str):t.hex!==void 0&&this.setStringHex(t.hex))},Re(E.asn1.DERAbstractString,E.asn1.ASN1Object),E.asn1.DERAbstractTime=function(t){E.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var r=e.getTime()+6e4*e.getTimezoneOffset();return new Date(r)},this.formatDate=function(e,r,i){var a=this.zeroPadding,g=this.localDateToUTC(e),_=String(g.getFullYear());r=="utc"&&(_=_.substr(2,2));var x=_+a(String(g.getMonth()+1),2)+a(String(g.getDate()),2)+a(String(g.getHours()),2)+a(String(g.getMinutes()),2)+a(String(g.getSeconds()),2);if(i===!0){var F=g.getMilliseconds();if(F!=0){var A=a(String(F),3);x=x+"."+(A=A.replace(/[0]+$/,""))}}return x+"Z"},this.zeroPadding=function(e,r){return e.length>=r?e:new Array(r-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=Ft(e)},this.setByDateValue=function(e,r,i,a,g,_){var x=new Date(Date.UTC(e,r-1,i,a,g,_,0));this.setByDate(x)},this.getFreshValueHex=function(){return this.hV}},Re(E.asn1.DERAbstractTime,E.asn1.ASN1Object),E.asn1.DERAbstractStructured=function(t){E.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,t!==void 0&&t.array!==void 0&&(this.asn1Array=t.array)},Re(E.asn1.DERAbstractStructured,E.asn1.ASN1Object),E.asn1.DERBoolean=function(t){E.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=t==0?"010100":"0101ff"},Re(E.asn1.DERBoolean,E.asn1.ASN1Object),E.asn1.DERInteger=function(t){E.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=E.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var r=new B(String(e),10);this.setByBigInteger(r)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.bigint!==void 0?this.setByBigInteger(t.bigint):t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Re(E.asn1.DERInteger,E.asn1.ASN1Object),E.asn1.DERBitString=function(t){if(t!==void 0&&t.obj!==void 0){var e=E.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}E.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(r){this.hTLV=null,this.isModified=!0,this.hV=r},this.setUnusedBitsAndHexValue=function(r,i){if(r<0||7<r)throw"unused bits shall be from 0 to 7: u = "+r;var a="0"+r;this.hTLV=null,this.isModified=!0,this.hV=a+i},this.setByBinaryString=function(r){var i=8-(r=r.replace(/0+$/,"")).length%8;i==8&&(i=0);for(var a=0;a<=i;a++)r+="0";var g="";for(a=0;a<r.length-1;a+=8){var _=r.substr(a,8),x=parseInt(_,2).toString(16);x.length==1&&(x="0"+x),g+=x}this.hTLV=null,this.isModified=!0,this.hV="0"+i+g},this.setByBooleanArray=function(r){for(var i="",a=0;a<r.length;a++)r[a]==1?i+="1":i+="0";this.setByBinaryString(i)},this.newFalseArray=function(r){for(var i=new Array(r),a=0;a<r;a++)i[a]=!1;return i},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):t.hex!==void 0?this.setHexValueIncludingUnusedBits(t.hex):t.bin!==void 0?this.setByBinaryString(t.bin):t.array!==void 0&&this.setByBooleanArray(t.array))},Re(E.asn1.DERBitString,E.asn1.ASN1Object),E.asn1.DEROctetString=function(t){if(t!==void 0&&t.obj!==void 0){var e=E.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}E.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},Re(E.asn1.DEROctetString,E.asn1.DERAbstractString),E.asn1.DERNull=function(){E.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Re(E.asn1.DERNull,E.asn1.ASN1Object),E.asn1.DERObjectIdentifier=function(t){E.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var r=function(a){var g=function(H){var q=H.toString(16);return q.length==1&&(q="0"+q),q},_=function(H){var q="",z=parseInt(H,10).toString(2),Q=7-z.length%7;Q==7&&(Q=0);for(var Z="",m=0;m<Q;m++)Z+="0";for(z=Z+z,m=0;m<z.length-1;m+=7){var C=z.substr(m,7);m!=z.length-7&&(C="1"+C),q+=g(parseInt(C,2))}return q};try{if(!a.match(/^[0-9.]+$/))return null;var x="",F=a.split("."),A=40*parseInt(F[0],10)+parseInt(F[1],10);x+=g(A),F.splice(0,2);for(var k=0;k<F.length;k++)x+=_(F[k]);return x}catch{return null}}(e);if(r==null)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(e){var r=E.asn1.x509.OID.name2oid(e);if(r==="")throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(r)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){typeof e=="string"?this.setValueNameOrOid(e):e.oid!==void 0?this.setValueNameOrOid(e.oid):e.name!==void 0?this.setValueNameOrOid(e.name):e.hex!==void 0&&this.setValueHex(e.hex)},t!==void 0&&this.setByParam(t)},Re(E.asn1.DERObjectIdentifier,E.asn1.ASN1Object),E.asn1.DEREnumerated=function(t){E.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=E.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var r=new B(String(e),10);this.setByBigInteger(r)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Re(E.asn1.DEREnumerated,E.asn1.ASN1Object),E.asn1.DERUTF8String=function(t){E.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},Re(E.asn1.DERUTF8String,E.asn1.DERAbstractString),E.asn1.DERNumericString=function(t){E.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},Re(E.asn1.DERNumericString,E.asn1.DERAbstractString),E.asn1.DERPrintableString=function(t){E.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},Re(E.asn1.DERPrintableString,E.asn1.DERAbstractString),E.asn1.DERTeletexString=function(t){E.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},Re(E.asn1.DERTeletexString,E.asn1.DERAbstractString),E.asn1.DERIA5String=function(t){E.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},Re(E.asn1.DERIA5String,E.asn1.DERAbstractString),E.asn1.DERVisibleString=function(t){E.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="1a"},Re(E.asn1.DERVisibleString,E.asn1.DERAbstractString),E.asn1.DERBMPString=function(t){E.asn1.DERBMPString.superclass.constructor.call(this,t),this.hT="1e"},Re(E.asn1.DERBMPString,E.asn1.DERAbstractString),E.asn1.DERUTCTime=function(t){E.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=Ft(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=Ft(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{12}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date))},Re(E.asn1.DERUTCTime,E.asn1.DERAbstractTime),E.asn1.DERGeneralizedTime=function(t){E.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Ft(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Ft(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{14}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date),t.millis===!0&&(this.withMillis=!0))},Re(E.asn1.DERGeneralizedTime,E.asn1.DERAbstractTime),E.asn1.DERSequence=function(t){E.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var e="",r=0;r<this.asn1Array.length;r++)e+=this.asn1Array[r].getEncodedHex();return this.hV=e,this.hV}},Re(E.asn1.DERSequence,E.asn1.DERAbstractStructured),E.asn1.DERSet=function(t){E.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,r=0;r<this.asn1Array.length;r++){var i=this.asn1Array[r];e.push(i.getEncodedHex())}return this.sortFlag==1&&e.sort(),this.hV=e.join(""),this.hV},t!==void 0&&t.sortflag!==void 0&&t.sortflag==0&&(this.sortFlag=!1)},Re(E.asn1.DERSet,E.asn1.DERAbstractStructured),E.asn1.DERTaggedObject=function(t){E.asn1.DERTaggedObject.superclass.constructor.call(this);var e=E.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(r,i,a){this.hT=i,this.isExplicit=r,this.asn1Object=a,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=a.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,i),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(r){r.tag!=null&&(this.hT=r.tag),r.explicit!=null&&(this.isExplicit=r.explicit),r.tage!=null&&(this.hT=r.tage,this.isExplicit=!0),r.tagi!=null&&(this.hT=r.tagi,this.isExplicit=!1),r.obj!=null&&(r.obj instanceof e.ASN1Object?(this.asn1Object=r.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):T(r.obj)=="object"&&(this.asn1Object=e.ASN1Util.newObject(r.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},t!=null&&this.setByParam(t)},Re(E.asn1.DERTaggedObject,E.asn1.ASN1Object);var E,Jt,gt,se=new function(){};function zr(t){for(var e=new Array,r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function Gr(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}function tr(t){for(var e="",r=0;r<t.length;r++){var i=t[r].toString(16);i.length==1&&(i="0"+i),e+=i}return e}function Ft(t){return tr(zr(t))}function rr(t){return t=(t=(t=t.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function Wt(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=(t=t.replace(/-/g,"+")).replace(/_/g,"/")}function Ne(t){return t.length%2==1&&(t="0"+t),rr(j(t))}function Fe(t){return re(Wt(t))}function _r(t){return nr(or(t))}function Oe(t){return decodeURIComponent(ir(t))}function lt(t){for(var e="",r=0;r<t.length-1;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e}function mt(t){for(var e="",r=0;r<t.length;r++)e+=("0"+t.charCodeAt(r).toString(16)).slice(-2);return e}function Yr(t){return j(t)}function Xr(t){var e=Yr(t).replace(/(.{64})/g,`$1\r
`);return e=e.replace(/\r\n$/,"")}function Qr(t){return re(t.replace(/[^0-9A-Za-z\/+=]*/g,""))}function ot(t,e){return"-----BEGIN "+e+`-----\r
`+Xr(t)+`\r
-----END `+e+`-----\r
`}function _t(t,e){if(t.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+e;return Qr(t=e!==void 0?(t=t.replace(new RegExp("^[^]*-----BEGIN "+e+"-----"),"")).replace(new RegExp("-----END "+e+"-----[^]*$"),""):(t=t.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Sr(t){var e,r,i,a,g,_,x,F,A,k,U;if(U=t.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return F=U[1],e=parseInt(F),F.length===2&&(50<=e&&e<100?e=1900+e:0<=e&&e<50&&(e=2e3+e)),r=parseInt(U[2])-1,i=parseInt(U[3]),a=parseInt(U[4]),g=parseInt(U[5]),_=parseInt(U[6]),x=0,(A=U[7])!==""&&(k=(A.substr(1)+"00").substr(0,3),x=parseInt(k)),Date.UTC(e,r,i,a,g,_,x);throw"unsupported zulu format: "+t}function Zr(t){return~~(Sr(t)/1e3)}function nr(t){return t.replace(/%/g,"")}function ir(t){return t.replace(/(..)/g,"%$1")}function en(t){var e="malformed IPv6 address";if(!t.match(/^[0-9A-Fa-f:]+$/))throw e;var r=(t=t.toLowerCase()).split(":").length-1;if(r<2)throw e;var i=":".repeat(7-r+2),a=(t=t.replace("::",i)).split(":");if(a.length!=8)throw e;for(var g=0;g<8;g++)a[g]=("0000"+a[g]).slice(-4);return a.join("")}function tn(t){if(!t.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var e=(t=t.toLowerCase()).match(/.{1,4}/g),r=0;r<8;r++)e[r]=e[r].replace(/^0+/,""),e[r]==""&&(e[r]="0");var i=(t=":"+e.join(":")+":").match(/:(0:){2,}/g);if(i===null)return t.slice(1,-1);var a="";for(r=0;r<i.length;r++)i[r].length>a.length&&(a=i[r]);return(t=t.replace(a,"::")).slice(1,-1)}function wr(t){var e="malformed hex value";if(!t.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw e;if(t.length!=8)return t.length==32?tn(t):t;try{return parseInt(t.substr(0,2),16)+"."+parseInt(t.substr(2,2),16)+"."+parseInt(t.substr(4,2),16)+"."+parseInt(t.substr(6,2),16)}catch{throw e}}function rn(t){return t.match(/.{4}/g).map(function(r){var i=parseInt(r.substr(0,2),16),a=parseInt(r.substr(2),16);if(i==0&a<128)return String.fromCharCode(a);if(i<8){var g=128|63&a;return Oe((192|(7&i)<<3|(192&a)>>6).toString(16)+g.toString(16))}g=128|(15&i)<<2|(192&a)>>6;var _=128|63&a;return Oe((224|(240&i)>>4).toString(16)+g.toString(16)+_.toString(16))}).join("")}function or(t){for(var e=encodeURIComponent(t),r="",i=0;i<e.length;i++)e[i]=="%"?(r+=e.substr(i,3),i+=2):r=r+"%"+Ft(e[i]);return r}function nn(t){return!(t.length%2!=0||!t.match(/^[0-9a-f]+$/)&&!t.match(/^[0-9A-F]+$/))}function br(t){return t.length%2==1?"0"+t:t.substr(0,1)>"7"?"00"+t:t}se.getLblen=function(t,e){if(t.substr(e+2,1)!="8")return 1;var r=parseInt(t.substr(e+3,1));return r==0?-1:0<r&&r<10?r+1:-2},se.getL=function(t,e){var r=se.getLblen(t,e);return r<1?"":t.substr(e+2,2*r)},se.getVblen=function(t,e){var r;return(r=se.getL(t,e))==""?-1:(r.substr(0,1)==="8"?new B(r.substr(2),16):new B(r,16)).intValue()},se.getVidx=function(t,e){var r=se.getLblen(t,e);return r<0?r:e+2*(r+1)},se.getV=function(t,e){var r=se.getVidx(t,e),i=se.getVblen(t,e);return t.substr(r,2*i)},se.getTLV=function(t,e){return t.substr(e,2)+se.getL(t,e)+se.getV(t,e)},se.getTLVblen=function(t,e){return 2+2*se.getLblen(t,e)+2*se.getVblen(t,e)},se.getNextSiblingIdx=function(t,e){return se.getVidx(t,e)+2*se.getVblen(t,e)},se.getChildIdx=function(t,e){var r,i,a,g=se,_=[];r=g.getVidx(t,e),i=2*g.getVblen(t,e),t.substr(e,2)=="03"&&(r+=2,i-=2),a=0;for(var x=r;a<=i;){var F=g.getTLVblen(t,x);if((a+=F)<=i&&_.push(x),x+=F,a>=i)break}return _},se.getNthChildIdx=function(t,e,r){return se.getChildIdx(t,e)[r]},se.getIdxbyList=function(t,e,r,i){var a,g,_=se;return r.length==0?i!==void 0&&t.substr(e,2)!==i?-1:e:(a=r.shift())>=(g=_.getChildIdx(t,e)).length?-1:_.getIdxbyList(t,g[a],r,i)},se.getIdxbyListEx=function(t,e,r,i){var a,g,_=se;if(r.length==0)return i!==void 0&&t.substr(e,2)!==i?-1:e;a=r.shift(),g=_.getChildIdx(t,e);for(var x=0,F=0;F<g.length;F++){var A=t.substr(g[F],2);if(typeof a=="number"&&!_.isContextTag(A)&&x==a||typeof a=="string"&&_.isContextTag(A,a))return _.getIdxbyListEx(t,g[F],r,i);_.isContextTag(A)||x++}return-1},se.getTLVbyList=function(t,e,r,i){var a=se,g=a.getIdxbyList(t,e,r,i);return g==-1||g>=t.length?null:a.getTLV(t,g)},se.getTLVbyListEx=function(t,e,r,i){var a=se,g=a.getIdxbyListEx(t,e,r,i);return g==-1?null:a.getTLV(t,g)},se.getVbyList=function(t,e,r,i,a){var g,_,x=se;return(g=x.getIdxbyList(t,e,r,i))==-1||g>=t.length?null:(_=x.getV(t,g),a===!0&&(_=_.substr(2)),_)},se.getVbyListEx=function(t,e,r,i,a){var g,_,x=se;return(g=x.getIdxbyListEx(t,e,r,i))==-1?null:(_=x.getV(t,g),t.substr(g,2)=="03"&&a!==!1&&(_=_.substr(2)),_)},se.getInt=function(t,e,r){r==null&&(r=-1);try{var i=t.substr(e,2);if(i!="02"&&i!="03")return r;var a=se.getV(t,e);return i=="02"?parseInt(a,16):function(_){try{var x=_.substr(0,2);if(x=="00")return parseInt(_.substr(2),16);var F=parseInt(x,16),A=_.substr(2),k=parseInt(A,16).toString(2);return k=="0"&&(k="00000000"),k=k.slice(0,0-F),parseInt(k,2)}catch{return-1}}(a)}catch{return r}},se.getOID=function(t,e,r){r==null&&(r=null);try{return t.substr(e,2)!="06"?r:function(a){if(!nn(a))return null;try{var g=[],_=a.substr(0,2),x=parseInt(_,16);g[0]=new String(Math.floor(x/40)),g[1]=new String(x%40);for(var F=a.substr(2),A=[],k=0;k<F.length/2;k++)A.push(parseInt(F.substr(2*k,2),16));var U=[],H="";for(k=0;k<A.length;k++)128&A[k]?H+=on((127&A[k]).toString(2),7):(H+=on((127&A[k]).toString(2),7),U.push(new String(parseInt(H,2))),H="");var q=g.join(".");return U.length>0&&(q=q+"."+U.join(".")),q}catch{return null}}(se.getV(t,e))}catch{return r}},se.getOIDName=function(t,e,r){r==null&&(r=null);try{var i=se.getOID(t,e,r);if(i==r)return r;var a=E.asn1.x509.OID.oid2name(i);return a==""?i:a}catch{return r}},se.getString=function(t,e,r){r==null&&(r=null);try{return lt(se.getV(t,e))}catch{return r}},se.hextooidstr=function(t){var e=function(H,q){return H.length>=q?H:new Array(q-H.length+1).join("0")+H},r=[],i=t.substr(0,2),a=parseInt(i,16);r[0]=new String(Math.floor(a/40)),r[1]=new String(a%40);for(var g=t.substr(2),_=[],x=0;x<g.length/2;x++)_.push(parseInt(g.substr(2*x,2),16));var F=[],A="";for(x=0;x<_.length;x++)128&_[x]?A+=e((127&_[x]).toString(2),7):(A+=e((127&_[x]).toString(2),7),F.push(new String(parseInt(A,2))),A="");var k=r.join(".");return F.length>0&&(k=k+"."+F.join(".")),k},se.dump=function(t,e,r,i){var a=se,g=a.getV,_=a.dump,x=a.getChildIdx,F=t;t instanceof E.asn1.ASN1Object&&(F=t.getEncodedHex());var A=function(ne,ge){return ne.length<=2*ge?ne:ne.substr(0,ge)+"..(total "+ne.length/2+"bytes).."+ne.substr(ne.length-ge,ge)};e===void 0&&(e={ommit_long_octet:32}),r===void 0&&(r=0),i===void 0&&(i="");var k,U=e.ommit_long_octet;if((k=F.substr(r,2))=="01")return(H=g(F,r))=="00"?i+`BOOLEAN FALSE
`:i+`BOOLEAN TRUE
`;if(k=="02")return i+"INTEGER "+A(H=g(F,r),U)+`
`;if(k=="03"){var H=g(F,r);if(a.isASN1HEX(H.substr(2))){var q=i+`BITSTRING, encapsulates
`;return q+=_(H.substr(2),e,0,i+"  ")}return i+"BITSTRING "+A(H,U)+`
`}if(k=="04")return H=g(F,r),a.isASN1HEX(H)?(q=i+`OCTETSTRING, encapsulates
`,q+=_(H,e,0,i+"  ")):i+"OCTETSTRING "+A(H,U)+`
`;if(k=="05")return i+`NULL
`;if(k=="06"){var z=g(F,r),Q=E.asn1.ASN1Util.oidHexToInt(z),Z=E.asn1.x509.OID.oid2name(Q),m=Q.replace(/\./g," ");return Z!=""?i+"ObjectIdentifier "+Z+" ("+m+`)
`:i+"ObjectIdentifier ("+m+`)
`}if(k=="0a")return i+"ENUMERATED "+parseInt(g(F,r))+`
`;if(k=="0c")return i+"UTF8String '"+Oe(g(F,r))+`'
`;if(k=="13")return i+"PrintableString '"+Oe(g(F,r))+`'
`;if(k=="14")return i+"TeletexString '"+Oe(g(F,r))+`'
`;if(k=="16")return i+"IA5String '"+Oe(g(F,r))+`'
`;if(k=="17")return i+"UTCTime "+Oe(g(F,r))+`
`;if(k=="18")return i+"GeneralizedTime "+Oe(g(F,r))+`
`;if(k=="1a")return i+"VisualString '"+Oe(g(F,r))+`'
`;if(k=="1e")return i+"BMPString '"+rn(g(F,r))+`'
`;if(k=="30"){if(F.substr(r,4)=="3000")return i+`SEQUENCE {}
`;q=i+`SEQUENCE
`;var C=e;if(((Y=x(F,r)).length==2||Y.length==3)&&F.substr(Y[0],2)=="06"&&F.substr(Y[Y.length-1],2)=="04"){Z=a.oidname(g(F,Y[0]));var D=JSON.parse(JSON.stringify(e));D.x509ExtName=Z,C=D}for(var O=0;O<Y.length;O++)q+=_(F,C,Y[O],i+"  ");return q}if(k=="31"){q=i+`SET
`;var Y=x(F,r);for(O=0;O<Y.length;O++)q+=_(F,e,Y[O],i+"  ");return q}if(128&(k=parseInt(k,16))){var ee=31&k;if(32&k){for(q=i+"["+ee+`]
`,Y=x(F,r),O=0;O<Y.length;O++)q+=_(F,e,Y[O],i+"  ");return q}if(H=g(F,r),se.isASN1HEX(H)){var q=i+"["+ee+`]
`;return q+=_(H,e,0,i+"  ")}return(H.substr(0,8)=="68747470"||e.x509ExtName==="subjectAltName"&&ee==2)&&(H=Oe(H)),q=i+"["+ee+"] "+H+`
`}return i+"UNKNOWN("+k+") "+g(F,r)+`
`},se.isContextTag=function(t,e){var r,i;t=t.toLowerCase();try{r=parseInt(t,16)}catch{return-1}if(e===void 0)return(192&r)==128;try{return e.match(/^\[[0-9]+\]$/)!=null&&!((i=parseInt(e.substr(1,e.length-1),10))>31)&&(192&r)==128&&(31&r)==i}catch{return!1}},se.isASN1HEX=function(t){var e=se;if(t.length%2==1)return!1;var r=e.getVblen(t,0),i=t.substr(0,2),a=e.getL(t,0);return t.length-i.length-a.length==2*r},se.checkStrictDER=function(t,e,r,i,a){var g=se;if(r===void 0){if(typeof t!="string")throw new Error("not hex string");if(t=t.toLowerCase(),!E.lang.String.isHex(t))throw new Error("not hex string");r=t.length,a=(i=t.length/2)<128?1:Math.ceil(i.toString(16))+1}if(g.getL(t,e).length>2*a)throw new Error("L of TLV too long: idx="+e);var _=g.getVblen(t,e);if(_>i)throw new Error("value of L too long than hex: idx="+e);var x=g.getTLV(t,e),F=x.length-2-g.getL(t,e).length;if(F!==2*_)throw new Error("V string length and L's value not the same:"+F+"/"+2*_);if(e===0&&t.length!=x.length)throw new Error("total length and TLV length unmatch:"+t.length+"!="+x.length);var A=t.substr(e,2);if(A==="02"){var k=g.getVidx(t,e);if(t.substr(k,2)=="00"&&t.charCodeAt(k+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(A,16)){for(var U=g.getVblen(t,e),H=0,q=g.getChildIdx(t,e),z=0;z<q.length;z++)H+=g.getTLV(t,q[z]).length,g.checkStrictDER(t,q[z],r,i,a);if(2*U!=H)throw new Error("sum of children's TLV length and L unmatch: "+2*U+"!="+H)}},se.oidname=function(t){var e=E.asn1;E.lang.String.isHex(t)&&(t=e.ASN1Util.oidHexToInt(t));var r=e.x509.OID.oid2name(t);return r===""&&(r=t),r},E!==void 0&&E||(o.KJUR=E={}),E.lang!==void 0&&E.lang||(E.lang={}),E.lang.String=function(){},typeof v=="function"?(o.utf8tob64u=Jt=function(e){return rr(v.from(e,"utf8").toString("base64"))},o.b64utoutf8=gt=function(e){return v.from(Wt(e),"base64").toString("utf8")}):(o.utf8tob64u=Jt=function(e){return Ne(nr(or(e)))},o.b64utoutf8=gt=function(e){return decodeURIComponent(ir(Fe(e)))}),E.lang.String.isInteger=function(t){return!!t.match(/^[0-9]+$/)||!!t.match(/^-[0-9]+$/)},E.lang.String.isHex=function(t){return nn(t)},E.lang.String.isBase64=function(t){return!(!(t=t.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||t.length%4!=0)},E.lang.String.isBase64URL=function(t){return!t.match(/[+/=]/)&&(t=Wt(t),E.lang.String.isBase64(t))},E.lang.String.isIntegerArray=function(t){return!!(t=t.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},E.lang.String.isPrintable=function(t){return t.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},E.lang.String.isIA5=function(t){return t.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},E.lang.String.isMail=function(t){return t.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var on=function(e,r,i){return i==null&&(i="0"),e.length>=r?e:new Array(r-e.length+1).join(i)+e};function Re(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}E!==void 0&&E||(o.KJUR=E={}),E.crypto!==void 0&&E.crypto||(E.crypto={}),E.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:J.algo.MD5,sha1:J.algo.SHA1,sha224:J.algo.SHA224,sha256:J.algo.SHA256,sha384:J.algo.SHA384,sha512:J.algo.SHA512,ripemd160:J.algo.RIPEMD160},this.getDigestInfoHex=function(t,e){if(this.DIGESTINFOHEAD[e]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+t},this.getPaddedDigestInfoHex=function(t,e,r){var i=this.getDigestInfoHex(t,e),a=r/4;if(i.length+22>a)throw"key is too short for SigAlg: keylen="+r+","+e;for(var g="0001",_="00"+i,x="",F=a-g.length-_.length,A=0;A<F;A+=2)x+="ff";return g+x+_},this.hashString=function(t,e){return new E.crypto.MessageDigest({alg:e}).digestString(t)},this.hashHex=function(t,e){return new E.crypto.MessageDigest({alg:e}).digestHex(t)},this.sha1=function(t){return this.hashString(t,"sha1")},this.sha256=function(t){return this.hashString(t,"sha256")},this.sha256Hex=function(t){return this.hashHex(t,"sha256")},this.sha512=function(t){return this.hashString(t,"sha512")},this.sha512Hex=function(t){return this.hashHex(t,"sha512")},this.isKey=function(t){return t instanceof he||t instanceof E.crypto.DSA||t instanceof E.crypto.ECDSA}},E.crypto.Util.md5=function(t){return new E.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(t)},E.crypto.Util.ripemd160=function(t){return new E.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(t)},E.crypto.Util.SECURERANDOMGEN=new we,E.crypto.Util.getRandomHexOfNbytes=function(t){var e=new Array(t);return E.crypto.Util.SECURERANDOMGEN.nextBytes(e),tr(e)},E.crypto.Util.getRandomBigIntegerOfNbytes=function(t){return new B(E.crypto.Util.getRandomHexOfNbytes(t),16)},E.crypto.Util.getRandomHexOfNbits=function(t){var e=t%8,r=new Array((t-e)/8+1);return E.crypto.Util.SECURERANDOMGEN.nextBytes(r),r[0]=(255<<e&255^255)&r[0],tr(r)},E.crypto.Util.getRandomBigIntegerOfNbits=function(t){return new B(E.crypto.Util.getRandomHexOfNbits(t),16)},E.crypto.Util.getRandomBigIntegerZeroToMax=function(t){for(var e=t.bitLength();;){var r=E.crypto.Util.getRandomBigIntegerOfNbits(e);if(t.compareTo(r)!=-1)return r}},E.crypto.Util.getRandomBigIntegerMinToMax=function(t,e){var r=t.compareTo(e);if(r==1)throw"biMin is greater than biMax";if(r==0)return t;var i=e.subtract(t);return E.crypto.Util.getRandomBigIntegerZeroToMax(i).add(t)},E.crypto.MessageDigest=function(t){this.setAlgAndProvider=function(e,r){if((e=E.crypto.MessageDigest.getCanonicalAlgName(e))!==null&&r===void 0&&(r=E.crypto.Util.DEFAULTPROVIDER[e]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)!=-1&&r=="cryptojs"){try{this.md=E.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(i){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+i}this.updateString=function(i){this.md.update(i)},this.updateHex=function(i){var a=J.enc.Hex.parse(i);this.md.update(a)},this.digest=function(){return this.md.finalize().toString(J.enc.Hex)},this.digestString=function(i){return this.updateString(i),this.digest()},this.digestHex=function(i){return this.updateHex(i),this.digest()}}if(":sha256:".indexOf(e)!=-1&&r=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(i){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+i}this.updateString=function(i){this.md.update(i)},this.updateHex=function(i){var a=sjcl.codec.hex.toBits(i);this.md.update(a)},this.digest=function(){var i=this.md.finalize();return sjcl.codec.hex.fromBits(i)},this.digestString=function(i){return this.updateString(i),this.digest()},this.digestHex=function(i){return this.updateHex(i),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},t!==void 0&&t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=E.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},E.crypto.MessageDigest.getCanonicalAlgName=function(t){return typeof t=="string"&&(t=(t=t.toLowerCase()).replace(/-/,"")),t},E.crypto.MessageDigest.getHashLength=function(t){var e=E.crypto.MessageDigest,r=e.getCanonicalAlgName(t);if(e.HASHLENGTH[r]===void 0)throw"not supported algorithm: "+t;return e.HASHLENGTH[r]},E.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},E.crypto.Mac=function(t){this.setAlgAndProvider=function(e,r){if((e=e.toLowerCase())==null&&(e="hmacsha1"),(e=e.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+e;r===void 0&&(r=E.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+r;var i=e.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(i)!=-1&&r=="cryptojs"){try{var a=E.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[i];this.mac=J.algo.HMAC.create(a,this.pass)}catch(g){throw"setAlgAndProvider hash alg set fail hashAlg="+i+"/"+g}this.updateString=function(g){this.mac.update(g)},this.updateHex=function(g){var _=J.enc.Hex.parse(g);this.mac.update(_)},this.doFinal=function(){return this.mac.finalize().toString(J.enc.Hex)},this.doFinalString=function(g){return this.updateString(g),this.doFinal()},this.doFinalHex=function(g){return this.updateHex(g),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if(typeof e=="string"){var r=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(r=mt(e)),void(this.pass=J.enc.Hex.parse(r))}if((e===void 0?"undefined":T(e))!="object")throw"KJUR.crypto.Mac unsupported password type: "+e;if(r=null,e.hex!==void 0){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;r=e.hex}if(e.utf8!==void 0&&(r=_r(e.utf8)),e.rstr!==void 0&&(r=mt(e.rstr)),e.b64!==void 0&&(r=re(e.b64)),e.b64u!==void 0&&(r=Fe(e.b64u)),r==null)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=J.enc.Hex.parse(r)},t!==void 0&&(t.pass!==void 0&&this.setPassword(t.pass),t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=E.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},E.crypto.Signature=function(t){var e=null;if(this._setAlgNames=function(){var r=this.algName.match(/^(.+)with(.+)$/);r&&(this.mdAlgName=r[1].toLowerCase(),this.pubkeyAlgName=r[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(r,i){for(var a="",g=i/4-r.length,_=0;_<g;_++)a+="0";return a+r},this.setAlgAndProvider=function(r,i){if(this._setAlgNames(),i!="cryptojs/jsrsa")throw new Error("provider not supported: "+i);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new E.crypto.MessageDigest({alg:this.mdAlgName})}catch(a){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+a)}this.init=function(a,g){var _=null;try{_=g===void 0?De.getKey(a):De.getKey(a,g)}catch(x){throw"init failed:"+x}if(_.isPrivate===!0)this.prvKey=_,this.state="SIGN";else{if(_.isPublic!==!0)throw"init failed.:"+_;this.pubKey=_,this.state="VERIFY"}},this.updateString=function(a){this.md.updateString(a)},this.updateHex=function(a){this.md.updateHex(a)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&E.crypto.ECDSA!==void 0&&(this.prvKey=new E.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof he&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof he&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof E.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof E.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(a){return this.updateString(a),this.sign()},this.signHex=function(a){return this.updateHex(a),this.sign()},this.verify=function(a){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&E.crypto.ECDSA!==void 0&&(this.pubKey=new E.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof he&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,a,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof he&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(E.crypto.ECDSA!==void 0&&this.pubKey instanceof E.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(E.crypto.DSA!==void 0&&this.pubKey instanceof E.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(r,i){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(r){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(r){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(r){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(r){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(r){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=t,t!==void 0&&(t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0?this.provName=E.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),t.psssaltlen!==void 0&&(this.pssSaltLen=t.psssaltlen),t.prvkeypem!==void 0)){if(t.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{e=De.getKey(t.prvkeypem),this.init(e)}catch(r){throw"fatal error to load pem private key: "+r}}},E.crypto.Cipher=function(t){},E.crypto.Cipher.encrypt=function(t,e,r){if(e instanceof he&&e.isPublic){var i=E.crypto.Cipher.getAlgByKeyAndName(e,r);if(i==="RSA")return e.encrypt(t);if(i==="RSAOAEP")return e.encryptOAEP(t,"sha1");var a=i.match(/^RSAOAEP(\d+)$/);if(a!==null)return e.encryptOAEP(t,"sha"+a[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.encrypt: unsupported key or algorithm"},E.crypto.Cipher.decrypt=function(t,e,r){if(e instanceof he&&e.isPrivate){var i=E.crypto.Cipher.getAlgByKeyAndName(e,r);if(i==="RSA")return e.decrypt(t);if(i==="RSAOAEP")return e.decryptOAEP(t,"sha1");var a=i.match(/^RSAOAEP(\d+)$/);if(a!==null)return e.decryptOAEP(t,"sha"+a[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.decrypt: unsupported key or algorithm"},E.crypto.Cipher.getAlgByKeyAndName=function(t,e){if(t instanceof he){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(e)!=-1)return e;if(e==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+e}throw"getAlgByKeyAndName: not supported algorithm name: "+e},E.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},E!==void 0&&E||(o.KJUR=E={}),E.crypto!==void 0&&E.crypto||(E.crypto={}),E.crypto.ECDSA=function(t){var e=Error,r=B,i=pe,a=E.crypto.ECDSA,g=E.crypto.ECParameterDB,_=a.getName,x=se,F=x.getVbyListEx,A=x.isASN1HEX,k=new we;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(U){return new r(U.bitLength(),k).mod(U.subtract(r.ONE)).add(r.ONE)},this.setNamedCurve=function(U){this.ecparams=g.getByName(U),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=U},this.setPrivateKeyHex=function(U){this.isPrivate=!0,this.prvKeyHex=U},this.setPublicKeyHex=function(U){this.isPublic=!0,this.pubKeyHex=U},this.getPublicKeyXYHex=function(){var U=this.pubKeyHex;if(U.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var H=this.ecparams.keylen/4;if(U.length!==2+2*H)throw"malformed public key hex length";var q={};return q.x=U.substr(2,H),q.y=U.substr(2+H),q},this.getShortNISTPCurveName=function(){var U=this.curveName;return U==="secp256r1"||U==="NIST P-256"||U==="P-256"||U==="prime256v1"?"P-256":U==="secp384r1"||U==="NIST P-384"||U==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var U=this.ecparams.n,H=this.getBigRandom(U),q=this.ecparams.G.multiply(H),z=q.getX().toBigInteger(),Q=q.getY().toBigInteger(),Z=this.ecparams.keylen/4,m=("0000000000"+H.toString(16)).slice(-Z),C="04"+("0000000000"+z.toString(16)).slice(-Z)+("0000000000"+Q.toString(16)).slice(-Z);return this.setPrivateKeyHex(m),this.setPublicKeyHex(C),{ecprvhex:m,ecpubhex:C}},this.signWithMessageHash=function(U){return this.signHex(U,this.prvKeyHex)},this.signHex=function(U,H){var q=new r(H,16),z=this.ecparams.n,Q=new r(U.substring(0,this.ecparams.keylen/4),16);do var Z=this.getBigRandom(z),m=this.ecparams.G.multiply(Z).getX().toBigInteger().mod(z);while(m.compareTo(r.ZERO)<=0);var C=Z.modInverse(z).multiply(Q.add(q.multiply(m))).mod(z);return a.biRSSigToASN1Sig(m,C)},this.sign=function(U,H){var q=H,z=this.ecparams.n,Q=r.fromByteArrayUnsigned(U);do var Z=this.getBigRandom(z),m=this.ecparams.G.multiply(Z).getX().toBigInteger().mod(z);while(m.compareTo(B.ZERO)<=0);var C=Z.modInverse(z).multiply(Q.add(q.multiply(m))).mod(z);return this.serializeSig(m,C)},this.verifyWithMessageHash=function(U,H){return this.verifyHex(U,H,this.pubKeyHex)},this.verifyHex=function(U,H,q){try{var z,Q,Z=a.parseSigHex(H);z=Z.r,Q=Z.s;var m=i.decodeFromHex(this.ecparams.curve,q),C=new r(U.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(C,z,Q,m)}catch{return!1}},this.verify=function(U,H,q){var z,Q,Z;if(Bitcoin.Util.isArray(H)){var m=this.parseSig(H);z=m.r,Q=m.s}else{if((H===void 0?"undefined":T(H))!=="object"||!H.r||!H.s)throw"Invalid value for signature";z=H.r,Q=H.s}if(q instanceof pe)Z=q;else{if(!Bitcoin.Util.isArray(q))throw"Invalid format for pubkey value, must be byte array or ECPointFp";Z=i.decodeFrom(this.ecparams.curve,q)}var C=r.fromByteArrayUnsigned(U);return this.verifyRaw(C,z,Q,Z)},this.verifyRaw=function(U,H,q,z){var Q=this.ecparams.n,Z=this.ecparams.G;if(H.compareTo(r.ONE)<0||H.compareTo(Q)>=0||q.compareTo(r.ONE)<0||q.compareTo(Q)>=0)return!1;var m=q.modInverse(Q),C=U.multiply(m).mod(Q),D=H.multiply(m).mod(Q);return Z.multiply(C).add(z.multiply(D)).getX().toBigInteger().mod(Q).equals(H)},this.serializeSig=function(U,H){var q=U.toByteArraySigned(),z=H.toByteArraySigned(),Q=[];return Q.push(2),Q.push(q.length),(Q=Q.concat(q)).push(2),Q.push(z.length),(Q=Q.concat(z)).unshift(Q.length),Q.unshift(48),Q},this.parseSig=function(U){var H;if(U[0]!=48)throw new Error("Signature not a valid DERSequence");if(U[H=2]!=2)throw new Error("First element in signature must be a DERInteger");var q=U.slice(H+2,H+2+U[H+1]);if(U[H+=2+U[H+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var z=U.slice(H+2,H+2+U[H+1]);return H+=2+U[H+1],{r:r.fromByteArrayUnsigned(q),s:r.fromByteArrayUnsigned(z)}},this.parseSigCompact=function(U){if(U.length!==65)throw"Signature has the wrong length";var H=U[0]-27;if(H<0||H>7)throw"Invalid signature type";var q=this.ecparams.n;return{r:r.fromByteArrayUnsigned(U.slice(1,33)).mod(q),s:r.fromByteArrayUnsigned(U.slice(33,65)).mod(q),i:H}},this.readPKCS5PrvKeyHex=function(U){if(A(U)===!1)throw new Error("not ASN.1 hex string");var H,q,z;try{H=F(U,0,["[0]",0],"06"),q=F(U,0,[1],"04");try{z=F(U,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=_(H),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex(q),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(U){if(A(U)===!1)throw new e("not ASN.1 hex string");var H,q,z;try{F(U,0,[1,0],"06"),H=F(U,0,[1,1],"06"),q=F(U,0,[2,0,1],"04");try{z=F(U,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new e("malformed PKCS#8 plain ECC private key")}if(this.curveName=_(H),this.curveName===void 0)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex(q),this.isPublic=!1},this.readPKCS8PubKeyHex=function(U){if(A(U)===!1)throw new e("not ASN.1 hex string");var H,q;try{F(U,0,[0,0],"06"),H=F(U,0,[0,1],"06"),q=F(U,0,[1],"03")}catch{throw new e("malformed PKCS#8 ECC public key")}if(this.curveName=_(H),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(q)},this.readCertPubKeyHex=function(U,H){if(A(U)===!1)throw new e("not ASN.1 hex string");var q,z;try{q=F(U,0,[0,5,0,1],"06"),z=F(U,0,[0,5,1],"03")}catch{throw new e("malformed X.509 certificate ECC public key")}if(this.curveName=_(q),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},t!==void 0&&t.curve!==void 0&&(this.curveName=t.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),t!==void 0&&(t.prv!==void 0&&this.setPrivateKeyHex(t.prv),t.pub!==void 0&&this.setPublicKeyHex(t.pub))},E.crypto.ECDSA.parseSigHex=function(t){var e=E.crypto.ECDSA.parseSigHexInHexRS(t);return{r:new B(e.r,16),s:new B(e.s,16)}},E.crypto.ECDSA.parseSigHexInHexRS=function(t){var e=se,r=e.getChildIdx,i=e.getV;if(e.checkStrictDER(t,0),t.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var a=r(t,0);if(a.length!=2)throw new Error("signature shall have two elements");var g=a[0],_=a[1];if(t.substr(g,2)!="02")throw new Error("1st item not ASN.1 integer");if(t.substr(_,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:i(t,g),s:i(t,_)}},E.crypto.ECDSA.asn1SigToConcatSig=function(t){var e=E.crypto.ECDSA.parseSigHexInHexRS(t),r=e.r,i=e.s;if(r.substr(0,2)=="00"&&r.length%32==2&&(r=r.substr(2)),i.substr(0,2)=="00"&&i.length%32==2&&(i=i.substr(2)),r.length%32==30&&(r="00"+r),i.length%32==30&&(i="00"+i),r.length%32!=0)throw"unknown ECDSA sig r length error";if(i.length%32!=0)throw"unknown ECDSA sig s length error";return r+i},E.crypto.ECDSA.concatSigToASN1Sig=function(t){if(t.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var e=t.substr(0,t.length/2),r=t.substr(t.length/2);return E.crypto.ECDSA.hexRSSigToASN1Sig(e,r)},E.crypto.ECDSA.hexRSSigToASN1Sig=function(t,e){var r=new B(t,16),i=new B(e,16);return E.crypto.ECDSA.biRSSigToASN1Sig(r,i)},E.crypto.ECDSA.biRSSigToASN1Sig=function(t,e){var r=E.asn1,i=new r.DERInteger({bigint:t}),a=new r.DERInteger({bigint:e});return new r.DERSequence({array:[i,a]}).getEncodedHex()},E.crypto.ECDSA.getName=function(t){return t==="2b8104001f"?"secp192k1":t==="2a8648ce3d030107"?"secp256r1":t==="2b8104000a"?"secp256k1":t==="2b81040021"?"secp224r1":t==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(t)!==-1?"secp256r1":"|secp256k1|".indexOf(t)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(t)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(t)!==-1?"secp384r1":null},E!==void 0&&E||(o.KJUR=E={}),E.crypto!==void 0&&E.crypto||(E.crypto={}),E.crypto.ECParameterDB=new function(){var t={},e={};function r(i){return new B(i,16)}this.getByName=function(i){var a=i;if(e[a]!==void 0&&(a=e[i]),t[a]!==void 0)return t[a];throw"unregistered EC curve name: "+a},this.regist=function(i,a,g,_,x,F,A,k,U,H,q,z){t[i]={};var Q=r(g),Z=r(_),m=r(x),C=r(F),D=r(A),O=new ht(Q,Z,m),Y=O.decodePointHex("04"+k+U);t[i].name=i,t[i].keylen=a,t[i].curve=O,t[i].G=Y,t[i].n=C,t[i].h=D,t[i].oid=q,t[i].info=z;for(var ee=0;ee<H.length;ee++)e[H[ee]]=i}},E.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),E.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),E.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),E.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),E.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),E.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),E.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),E.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),E.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),E.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var De=function(){var t=function(A,k,U){return e(J.AES,A,k,U)},e=function(A,k,U,H){var q=J.enc.Hex.parse(k),z=J.enc.Hex.parse(U),Q=J.enc.Hex.parse(H),Z={};Z.key=z,Z.iv=Q,Z.ciphertext=q;var m=A.decrypt(Z,z,{iv:Q});return J.enc.Hex.stringify(m)},r=function(A,k,U){return i(J.AES,A,k,U)},i=function(A,k,U,H){var q=J.enc.Hex.parse(k),z=J.enc.Hex.parse(U),Q=J.enc.Hex.parse(H),Z=A.encrypt(q,z,{iv:Q}),m=J.enc.Hex.parse(Z.toString());return J.enc.Base64.stringify(m)},a={"AES-256-CBC":{proc:t,eproc:r,keylen:32,ivlen:16},"AES-192-CBC":{proc:t,eproc:r,keylen:24,ivlen:16},"AES-128-CBC":{proc:t,eproc:r,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(A,k,U){return e(J.TripleDES,A,k,U)},eproc:function(A,k,U){return i(J.TripleDES,A,k,U)},keylen:24,ivlen:8},"DES-CBC":{proc:function(A,k,U){return e(J.DES,A,k,U)},eproc:function(A,k,U){return i(J.DES,A,k,U)},keylen:8,ivlen:8}},g=function(A){var k={},U=A.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));U&&(k.cipher=U[1],k.ivsalt=U[2]);var H=A.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));H&&(k.type=H[1]);var q=-1,z=0;A.indexOf(`\r
\r
`)!=-1&&(q=A.indexOf(`\r
\r
`),z=2),A.indexOf(`

`)!=-1&&(q=A.indexOf(`

`),z=1);var Q=A.indexOf("-----END");if(q!=-1&&Q!=-1){var Z=A.substring(q+2*z,Q-z);Z=Z.replace(/\s+/g,""),k.data=Z}return k},_=function(A,k,U){for(var H=U.substring(0,16),q=J.enc.Hex.parse(H),z=J.enc.Utf8.parse(k),Q=a[A].keylen+a[A].ivlen,Z="",m=null;;){var C=J.algo.MD5.create();if(m!=null&&C.update(m),C.update(z),C.update(q),m=C.finalize(),(Z+=J.enc.Hex.stringify(m)).length>=2*Q)break}var D={};return D.keyhex=Z.substr(0,2*a[A].keylen),D.ivhex=Z.substr(2*a[A].keylen,2*a[A].ivlen),D},x=function(A,k,U,H){var q=J.enc.Base64.parse(A),z=J.enc.Hex.stringify(q);return(0,a[k].proc)(z,U,H)};return{version:"1.0.0",parsePKCS5PEM:function(A){return g(A)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(A,k,U){return _(A,k,U)},decryptKeyB64:function(A,k,U,H){return x(A,k,U,H)},getDecryptedKeyHex:function(A,k){var U=g(A),H=U.cipher,q=U.ivsalt,z=U.data,Q=_(H,k,q).keyhex;return x(z,H,Q,q)},getEncryptedPKCS5PEMFromPrvKeyHex:function(A,k,U,H,q){var z="";if(H!==void 0&&H!=null||(H="AES-256-CBC"),a[H]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+H);q!==void 0&&q!=null||(q=function(m){var C=J.lib.WordArray.random(m);return J.enc.Hex.stringify(C)}(a[H].ivlen).toUpperCase());var Q=function(m,C,D,O){return(0,a[C].eproc)(m,D,O)}(k,H,_(H,U,q).keyhex,q);return z="-----BEGIN "+A+` PRIVATE KEY-----\r
`,z+=`Proc-Type: 4,ENCRYPTED\r
`,z+="DEK-Info: "+H+","+q+`\r
`,z+=`\r
`,z+=Q.replace(/(.{64})/g,`$1\r
`),z+=`\r
-----END `+A+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(A){var k=se,U=k.getChildIdx,H=k.getV,q={},z=U(A,0);if(z.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+z.length);q.ciphertext=H(A,z[1]);var Q=U(A,z[0]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+Q.length);if(H(A,Q[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var Z=U(A,Q[1]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+Z.length);var m=U(A,Z[1]);if(m.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+m.length);if(H(A,m[0])!="2a864886f70d0307")throw"this only supports TripleDES";q.encryptionSchemeAlg="TripleDES",q.encryptionSchemeIV=H(A,m[1]);var C=U(A,Z[0]);if(C.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+C.length);if(H(A,C[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var D=U(A,C[1]);if(D.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+D.length);q.pbkdf2Salt=H(A,D[0]);var O=H(A,D[1]);try{q.pbkdf2Iter=parseInt(O,16)}catch{throw new Error("malformed format pbkdf2Iter: "+O)}return q},getPBKDF2KeyHexFromParam:function(A,k){var U=J.enc.Hex.parse(A.pbkdf2Salt),H=A.pbkdf2Iter,q=J.PBKDF2(k,U,{keySize:6,iterations:H});return J.enc.Hex.stringify(q)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(A,k){var U=_t(A,"ENCRYPTED PRIVATE KEY"),H=this.parseHexOfEncryptedPKCS8(U),q=De.getPBKDF2KeyHexFromParam(H,k),z={};z.ciphertext=J.enc.Hex.parse(H.ciphertext);var Q=J.enc.Hex.parse(q),Z=J.enc.Hex.parse(H.encryptionSchemeIV),m=J.TripleDES.decrypt(z,Q,{iv:Z});return J.enc.Hex.stringify(m)},getKeyFromEncryptedPKCS8PEM:function(A,k){var U=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(A,k);return this.getKeyFromPlainPrivatePKCS8Hex(U)},parsePlainPrivatePKCS8Hex:function(A){var k=se,U=k.getChildIdx,H=k.getV,q={algparam:null};if(A.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var z=U(A,0);if(z.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(A.substr(z[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var Q=U(A,z[1]);if(Q.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(A.substr(Q[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(q.algoid=H(A,Q[0]),A.substr(Q[1],2)=="06"&&(q.algparam=H(A,Q[1])),A.substr(z[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return q.keyidx=k.getVidx(A,z[2]),q},getKeyFromPlainPrivatePKCS8PEM:function(A){var k=_t(A,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(k)},getKeyFromPlainPrivatePKCS8Hex:function(A){var k,U=this.parsePlainPrivatePKCS8Hex(A);if(U.algoid=="2a864886f70d010101")k=new he;else if(U.algoid=="2a8648ce380401")k=new E.crypto.DSA;else{if(U.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");k=new E.crypto.ECDSA}return k.readPKCS8PrvKeyHex(A),k},_getKeyFromPublicPKCS8Hex:function(A){var k,U=se.getVbyList(A,0,[0,0],"06");if(U==="2a864886f70d010101")k=new he;else if(U==="2a8648ce380401")k=new E.crypto.DSA;else{if(U!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");k=new E.crypto.ECDSA}return k.readPKCS8PubKeyHex(A),k},parsePublicRawRSAKeyHex:function(A){var k=se,U=k.getChildIdx,H=k.getV,q={};if(A.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var z=U(A,0);if(z.length!=2)throw new Error("malformed RSA key(code:002)");if(A.substr(z[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(q.n=H(A,z[0]),A.substr(z[1],2)!="02")throw new Error("malformed RSA key(code:004)");return q.e=H(A,z[1]),q},parsePublicPKCS8Hex:function(A){var k=se,U=k.getChildIdx,H=k.getV,q={algparam:null},z=U(A,0);if(z.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+z.length);var Q=z[0];if(A.substr(Q,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var Z=U(A,Q);if(Z.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(A.substr(Z[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(q.algoid=H(A,Z[0]),A.substr(Z[1],2)=="06"?q.algparam=H(A,Z[1]):A.substr(Z[1],2)=="30"&&(q.algparam={},q.algparam.p=k.getVbyList(A,Z[1],[0],"02"),q.algparam.q=k.getVbyList(A,Z[1],[1],"02"),q.algparam.g=k.getVbyList(A,Z[1],[2],"02")),A.substr(z[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return q.key=H(A,z[1]).substr(2),q}}}();De.getKey=function(t,e,r){var i=(Z=se).getChildIdx,a=(Z.getV,Z.getVbyList),g=E.crypto,_=g.ECDSA,x=g.DSA,F=he,A=_t,k=De;if(F!==void 0&&t instanceof F||_!==void 0&&t instanceof _||x!==void 0&&t instanceof x)return t;if(t.curve!==void 0&&t.xy!==void 0&&t.d===void 0)return new _({pub:t.xy,curve:t.curve});if(t.curve!==void 0&&t.d!==void 0)return new _({prv:t.d,curve:t.curve});if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(le=new F).setPublic(t.n,t.e),le;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.co!==void 0&&t.qi===void 0)return(le=new F).setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dp,t.dq,t.co),le;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p===void 0)return(le=new F).setPrivate(t.n,t.e,t.d),le;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x===void 0)return(le=new x).setPublic(t.p,t.q,t.g,t.y),le;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x!==void 0)return(le=new x).setPrivate(t.p,t.q,t.g,t.y,t.x),le;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(le=new F).setPublic(Fe(t.n),Fe(t.e)),le;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.qi!==void 0)return(le=new F).setPrivateEx(Fe(t.n),Fe(t.e),Fe(t.d),Fe(t.p),Fe(t.q),Fe(t.dp),Fe(t.dq),Fe(t.qi)),le;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0)return(le=new F).setPrivate(Fe(t.n),Fe(t.e),Fe(t.d)),le;if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d===void 0){var U=(ae=new _({curve:t.crv})).ecparams.keylen/4,H="04"+("0000000000"+Fe(t.x)).slice(-U)+("0000000000"+Fe(t.y)).slice(-U);return ae.setPublicKeyHex(H),ae}if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d!==void 0){U=(ae=new _({curve:t.crv})).ecparams.keylen/4,H="04"+("0000000000"+Fe(t.x)).slice(-U)+("0000000000"+Fe(t.y)).slice(-U);var q=("0000000000"+Fe(t.d)).slice(-U);return ae.setPublicKeyHex(H),ae.setPrivateKeyHex(q),ae}if(r==="pkcs5prv"){var z,Q=t,Z=se;if((z=i(Q,0)).length===9)(le=new F).readPKCS5PrvKeyHex(Q);else if(z.length===6)(le=new x).readPKCS5PrvKeyHex(Q);else{if(!(z.length>2&&Q.substr(z[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(le=new _).readPKCS5PrvKeyHex(Q)}return le}if(r==="pkcs8prv")return le=k.getKeyFromPlainPrivatePKCS8Hex(t);if(r==="pkcs8pub")return k._getKeyFromPublicPKCS8Hex(t);if(r==="x509pub")return He.getPublicKeyFromCertHex(t);if(t.indexOf("-END CERTIFICATE-",0)!=-1||t.indexOf("-END X509 CERTIFICATE-",0)!=-1||t.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return He.getPublicKeyFromCertPEM(t);if(t.indexOf("-END PUBLIC KEY-")!=-1){var m=_t(t,"PUBLIC KEY");return k._getKeyFromPublicPKCS8Hex(m)}if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var C=A(t,"RSA PRIVATE KEY");return k.getKey(C,null,"pkcs5prv")}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var D=a(Ae=A(t,"DSA PRIVATE KEY"),0,[1],"02"),O=a(Ae,0,[2],"02"),Y=a(Ae,0,[3],"02"),ee=a(Ae,0,[4],"02"),ue=a(Ae,0,[5],"02");return(le=new x).setPrivate(new B(D,16),new B(O,16),new B(Y,16),new B(ee,16),new B(ue,16)),le}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1)return C=A(t,"EC PRIVATE KEY"),k.getKey(C,null,"pkcs5prv");if(t.indexOf("-END PRIVATE KEY-")!=-1)return k.getKeyFromPlainPrivatePKCS8PEM(t);if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var ne=k.getDecryptedKeyHex(t,e),ge=new he;return ge.readPKCS5PrvKeyHex(ne),ge}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var ae,le=a(Ae=k.getDecryptedKeyHex(t,e),0,[1],"04"),Ee=a(Ae,0,[2,0],"06"),Pe=a(Ae,0,[3,0],"03").substr(2);if(E.crypto.OID.oidhex2name[Ee]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ee);return(ae=new _({curve:E.crypto.OID.oidhex2name[Ee]})).setPublicKeyHex(Pe),ae.setPrivateKeyHex(le),ae.isPublic=!1,ae}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var Ae;return D=a(Ae=k.getDecryptedKeyHex(t,e),0,[1],"02"),O=a(Ae,0,[2],"02"),Y=a(Ae,0,[3],"02"),ee=a(Ae,0,[4],"02"),ue=a(Ae,0,[5],"02"),(le=new x).setPrivate(new B(D,16),new B(O,16),new B(Y,16),new B(ee,16),new B(ue,16)),le}if(t.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return k.getKeyFromEncryptedPKCS8PEM(t,e);throw new Error("not supported argument")},De.generateKeypair=function(t,e){if(t=="RSA"){var r=e;(_=new he).generate(r,"10001"),_.isPrivate=!0,_.isPublic=!0;var i=new he,a=_.n.toString(16),g=_.e.toString(16);return i.setPublic(a,g),i.isPrivate=!1,i.isPublic=!0,(x={}).prvKeyObj=_,x.pubKeyObj=i,x}if(t=="EC"){var _,x,F=e,A=new E.crypto.ECDSA({curve:F}).generateKeyPairHex();return(_=new E.crypto.ECDSA({curve:F})).setPublicKeyHex(A.ecpubhex),_.setPrivateKeyHex(A.ecprvhex),_.isPrivate=!0,_.isPublic=!1,(i=new E.crypto.ECDSA({curve:F})).setPublicKeyHex(A.ecpubhex),i.isPrivate=!1,i.isPublic=!0,(x={}).prvKeyObj=_,x.pubKeyObj=i,x}throw new Error("unknown algorithm: "+t)},De.getPEM=function(t,e,r,i,a,g){var _=E,x=_.asn1,F=x.DERObjectIdentifier,A=x.DERInteger,k=x.ASN1Util.newObject,U=x.x509.SubjectPublicKeyInfo,H=_.crypto,q=H.DSA,z=H.ECDSA,Q=he;function Z(ae){return k({seq:[{int:0},{int:{bigint:ae.n}},{int:ae.e},{int:{bigint:ae.d}},{int:{bigint:ae.p}},{int:{bigint:ae.q}},{int:{bigint:ae.dmp1}},{int:{bigint:ae.dmq1}},{int:{bigint:ae.coeff}}]})}function m(ae){return k({seq:[{int:1},{octstr:{hex:ae.prvKeyHex}},{tag:["a0",!0,{oid:{name:ae.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ae.pubKeyHex}}]}]})}function C(ae){return k({seq:[{int:0},{int:{bigint:ae.p}},{int:{bigint:ae.q}},{int:{bigint:ae.g}},{int:{bigint:ae.y}},{int:{bigint:ae.x}}]})}if((Q!==void 0&&t instanceof Q||q!==void 0&&t instanceof q||z!==void 0&&t instanceof z)&&t.isPublic==1&&(e===void 0||e=="PKCS8PUB"))return ot(ee=new U(t).getEncodedHex(),"PUBLIC KEY");if(e=="PKCS1PRV"&&Q!==void 0&&t instanceof Q&&(r===void 0||r==null)&&t.isPrivate==1)return ot(ee=Z(t).getEncodedHex(),"RSA PRIVATE KEY");if(e=="PKCS1PRV"&&z!==void 0&&t instanceof z&&(r===void 0||r==null)&&t.isPrivate==1){var D=new F({name:t.curveName}).getEncodedHex(),O=m(t).getEncodedHex(),Y="";return Y+=ot(D,"EC PARAMETERS"),Y+=ot(O,"EC PRIVATE KEY")}if(e=="PKCS1PRV"&&q!==void 0&&t instanceof q&&(r===void 0||r==null)&&t.isPrivate==1)return ot(ee=C(t).getEncodedHex(),"DSA PRIVATE KEY");if(e=="PKCS5PRV"&&Q!==void 0&&t instanceof Q&&r!==void 0&&r!=null&&t.isPrivate==1){var ee=Z(t).getEncodedHex();return i===void 0&&(i="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",ee,r,i,g)}if(e=="PKCS5PRV"&&z!==void 0&&t instanceof z&&r!==void 0&&r!=null&&t.isPrivate==1)return ee=m(t).getEncodedHex(),i===void 0&&(i="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",ee,r,i,g);if(e=="PKCS5PRV"&&q!==void 0&&t instanceof q&&r!==void 0&&r!=null&&t.isPrivate==1)return ee=C(t).getEncodedHex(),i===void 0&&(i="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",ee,r,i,g);var ue=function(le,Ee){var Pe=ne(le,Ee);return new k({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:Pe.pbkdf2Salt}},{int:Pe.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:Pe.encryptionSchemeIV}}]}]}]},{octstr:{hex:Pe.ciphertext}}]}).getEncodedHex()},ne=function(le,Ee){var Pe=J.lib.WordArray.random(8),Ae=J.lib.WordArray.random(8),st=J.PBKDF2(Ee,Pe,{keySize:6,iterations:100}),Qe=J.enc.Hex.parse(le),Ze=J.TripleDES.encrypt(Qe,st,{iv:Ae})+"",Ue={};return Ue.ciphertext=Ze,Ue.pbkdf2Salt=J.enc.Hex.stringify(Pe),Ue.pbkdf2Iter=100,Ue.encryptionSchemeAlg="DES-EDE3-CBC",Ue.encryptionSchemeIV=J.enc.Hex.stringify(Ae),Ue};if(e=="PKCS8PRV"&&Q!=null&&t instanceof Q&&t.isPrivate==1){var ge=Z(t).getEncodedHex();return ee=k({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:ge}}]}).getEncodedHex(),r===void 0||r==null?ot(ee,"PRIVATE KEY"):ot(O=ue(ee,r),"ENCRYPTED PRIVATE KEY")}if(e=="PKCS8PRV"&&z!==void 0&&t instanceof z&&t.isPrivate==1)return ge=new k({seq:[{int:1},{octstr:{hex:t.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]}]}).getEncodedHex(),ee=k({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:t.curveName}}]},{octstr:{hex:ge}}]}).getEncodedHex(),r===void 0||r==null?ot(ee,"PRIVATE KEY"):ot(O=ue(ee,r),"ENCRYPTED PRIVATE KEY");if(e=="PKCS8PRV"&&q!==void 0&&t instanceof q&&t.isPrivate==1)return ge=new A({bigint:t.x}).getEncodedHex(),ee=k({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]}]},{octstr:{hex:ge}}]}).getEncodedHex(),r===void 0||r==null?ot(ee,"PRIVATE KEY"):ot(O=ue(ee,r),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},De.getKeyFromCSRPEM=function(t){var e=_t(t,"CERTIFICATE REQUEST");return De.getKeyFromCSRHex(e)},De.getKeyFromCSRHex=function(t){var e=De.parseCSRHex(t);return De.getKey(e.p8pubkeyhex,null,"pkcs8pub")},De.parseCSRHex=function(t){var e=se,r=e.getChildIdx,i=e.getTLV,a={},g=t;if(g.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var _=r(g,0);if(_.length<1)throw new Error("malformed CSR(code:002)");if(g.substr(_[0],2)!="30")throw new Error("malformed CSR(code:003)");var x=r(g,_[0]);if(x.length<3)throw new Error("malformed CSR(code:004)");return a.p8pubkeyhex=i(g,x[2]),a},De.getKeyID=function(t){var e=De,r=se;typeof t=="string"&&t.indexOf("BEGIN ")!=-1&&(t=e.getKey(t));var i=_t(e.getPEM(t)),a=r.getIdxbyList(i,0,[1]),g=r.getV(i,a).substring(2);return E.crypto.Util.hashHex(g,"sha1")},De.getJWKFromKey=function(t){var e={};if(t instanceof he&&t.isPrivate)return e.kty="RSA",e.n=Ne(t.n.toString(16)),e.e=Ne(t.e.toString(16)),e.d=Ne(t.d.toString(16)),e.p=Ne(t.p.toString(16)),e.q=Ne(t.q.toString(16)),e.dp=Ne(t.dmp1.toString(16)),e.dq=Ne(t.dmq1.toString(16)),e.qi=Ne(t.coeff.toString(16)),e;if(t instanceof he&&t.isPublic)return e.kty="RSA",e.n=Ne(t.n.toString(16)),e.e=Ne(t.e.toString(16)),e;if(t instanceof E.crypto.ECDSA&&t.isPrivate){if((i=t.getShortNISTPCurveName())!=="P-256"&&i!=="P-384")throw new Error("unsupported curve name for JWT: "+i);var r=t.getPublicKeyXYHex();return e.kty="EC",e.crv=i,e.x=Ne(r.x),e.y=Ne(r.y),e.d=Ne(t.prvKeyHex),e}if(t instanceof E.crypto.ECDSA&&t.isPublic){var i;if((i=t.getShortNISTPCurveName())!=="P-256"&&i!=="P-384")throw new Error("unsupported curve name for JWT: "+i);return r=t.getPublicKeyXYHex(),e.kty="EC",e.crv=i,e.x=Ne(r.x),e.y=Ne(r.y),e}throw new Error("not supported key object")},he.getPosArrayOfChildrenFromHex=function(t){return se.getChildIdx(t,0)},he.getHexValueArrayOfChildrenFromHex=function(t){var e,r=se.getV,i=r(t,(e=he.getPosArrayOfChildrenFromHex(t))[0]),a=r(t,e[1]),g=r(t,e[2]),_=r(t,e[3]),x=r(t,e[4]),F=r(t,e[5]),A=r(t,e[6]),k=r(t,e[7]),U=r(t,e[8]);return(e=new Array).push(i,a,g,_,x,F,A,k,U),e},he.prototype.readPrivateKeyFromPEMString=function(t){var e=_t(t),r=he.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},he.prototype.readPKCS5PrvKeyHex=function(t){var e=he.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},he.prototype.readPKCS8PrvKeyHex=function(t){var e,r,i,a,g,_,x,F,A=se,k=A.getVbyListEx;if(A.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");try{e=k(t,0,[2,0,1],"02"),r=k(t,0,[2,0,2],"02"),i=k(t,0,[2,0,3],"02"),a=k(t,0,[2,0,4],"02"),g=k(t,0,[2,0,5],"02"),_=k(t,0,[2,0,6],"02"),x=k(t,0,[2,0,7],"02"),F=k(t,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(e,r,i,a,g,_,x,F)},he.prototype.readPKCS5PubKeyHex=function(t){var e=se,r=e.getV;if(e.isASN1HEX(t)===!1)throw new Error("keyHex is not ASN.1 hex string");var i=e.getChildIdx(t,0);if(i.length!==2||t.substr(i[0],2)!=="02"||t.substr(i[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var a=r(t,i[0]),g=r(t,i[1]);this.setPublic(a,g)},he.prototype.readPKCS8PubKeyHex=function(t){var e=se;if(e.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");if(e.getTLVbyListEx(t,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var r=e.getTLVbyListEx(t,0,[1,0]);this.readPKCS5PubKeyHex(r)},he.prototype.readCertPubKeyHex=function(t,e){var r,i;(r=new He).readCertHex(t),i=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(i)};function sn(t,e){for(var r="",i=e/4-t.length,a=0;a<i;a++)r+="0";return r+t}function an(t,e,r){for(var i="",a=0;i.length<e;)i+=lt(r(mt(t+String.fromCharCode.apply(String,[(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a])))),a+=1;return i}function un(t){for(var e in E.crypto.Util.DIGESTINFOHEAD){var r=E.crypto.Util.DIGESTINFOHEAD[e],i=r.length;if(t.substring(0,i)==r)return[e,t.substring(i)]}return[]}function He(t){var e,r=se,i=r.getChildIdx,a=r.getV,g=r.getTLV,_=r.getVbyList,x=r.getVbyListEx,F=r.getTLVbyList,A=r.getTLVbyListEx,k=r.getIdxbyList,U=r.getIdxbyListEx,H=r.getVidx,q=r.getInt,z=r.oidname,Q=r.hextooidstr,Z=_t;try{e=E.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var m=F(this.hex,0,[0,0]);if(m.substr(0,2)=="a0"){var C=F(m,0,[0]),D=q(C,0);if(D<0||2<D)throw new Error("malformed version field");return this.version=D+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return x(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var m=A(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(m)},this.getAlgorithmIdentifierName=function(m){for(var C in e)if(m===e[C])return C;return z(x(m,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return F(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return F(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var m=_(this.hex,0,[0,4+this.foffset,0]);return m=m.replace(/(..)/g,"%$1"),m=decodeURIComponent(m)},this.getNotAfter=function(){var m=_(this.hex,0,[0,4+this.foffset,1]);return m=m.replace(/(..)/g,"%$1"),m=decodeURIComponent(m)},this.getPublicKeyHex=function(){return r.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return k(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var m=this.getPublicKeyIdx();return k(this.hex,m,[1,0],"30")},this.getPublicKey=function(){return De.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var m=F(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(m)},this.getSignatureValueHex=function(){return _(this.hex,0,[2],"03",!0)},this.verifySignature=function(m){var C=this.getSignatureAlgorithmField(),D=this.getSignatureValueHex(),O=F(this.hex,0,[0],"30"),Y=new E.crypto.Signature({alg:C});return Y.init(m),Y.updateHex(O),Y.verify(D)},this.parseExt=function(m){var C,D,O;if(m===void 0){if(O=this.hex,this.version!==3)return-1;C=k(O,0,[0,7,0],"30"),D=i(O,C)}else{O=_t(m);var Y=k(O,0,[0,3,0,0],"06");if(a(O,Y)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);C=k(O,0,[0,3,0,1,0],"30"),D=i(O,C),this.hex=O}this.aExtInfo=new Array;for(var ee=0;ee<D.length;ee++){var ue={critical:!1},ne=0;i(O,D[ee]).length===3&&(ue.critical=!0,ne=1),ue.oid=r.hextooidstr(_(O,D[ee],[0],"06"));var ge=k(O,D[ee],[1+ne]);ue.vidx=H(O,ge),this.aExtInfo.push(ue)}},this.getExtInfo=function(m){var C=this.aExtInfo,D=m;if(m.match(/^[0-9.]+$/)||(D=E.asn1.x509.OID.name2oid(m)),D!==""){for(var O=0;O<C.length;O++)if(C[O].oid===D)return C[O]}},this.getExtBasicConstraints=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("basicConstraints");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"basicConstraints"};if(C&&(O.critical=!0),m==="3000")return O;if(m==="30030101ff")return O.cA=!0,O;if(m.substr(0,12)==="30060101ff02"){var Y=a(m,10),ee=parseInt(Y,16);return O.cA=!0,O.pathLen=ee,O}throw new Error("hExtV parse error: "+m)},this.getExtKeyUsage=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("keyUsage");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"keyUsage"};return C&&(O.critical=!0),O.names=this.getExtKeyUsageString(m).split(","),O},this.getExtKeyUsageBin=function(m){if(m===void 0){var C=this.getExtInfo("keyUsage");if(C===void 0)return"";m=g(this.hex,C.vidx)}if(m.length!=8&&m.length!=10)throw new Error("malformed key usage value: "+m);var D="000000000000000"+parseInt(m.substr(6),16).toString(2);return m.length==8&&(D=D.slice(-8)),m.length==10&&(D=D.slice(-16)),(D=D.replace(/0+$/,""))==""&&(D="0"),D},this.getExtKeyUsageString=function(m){for(var C=this.getExtKeyUsageBin(m),D=new Array,O=0;O<C.length;O++)C.substr(O,1)=="1"&&D.push(He.KEYUSAGE_NAME[O]);return D.join(",")},this.getExtSubjectKeyIdentifier=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("subjectKeyIdentifier");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"subjectKeyIdentifier"};C&&(O.critical=!0);var Y=a(m,0);return O.kid={hex:Y},O},this.getExtAuthorityKeyIdentifier=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("authorityKeyIdentifier");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"authorityKeyIdentifier"};C&&(O.critical=!0);for(var Y=i(m,0),ee=0;ee<Y.length;ee++){var ue=m.substr(Y[ee],2);if(ue==="80"&&(O.kid={hex:a(m,Y[ee])}),ue==="a1"){var ne=g(m,Y[ee]),ge=this.getGeneralNames(ne);O.issuer=ge[0].dn}ue==="82"&&(O.sn={hex:a(m,Y[ee])})}return O},this.getExtExtKeyUsage=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("extKeyUsage");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"extKeyUsage",array:[]};C&&(O.critical=!0);for(var Y=i(m,0),ee=0;ee<Y.length;ee++)O.array.push(z(a(m,Y[ee])));return O},this.getExtExtKeyUsageName=function(){var m=this.getExtInfo("extKeyUsage");if(m===void 0)return m;var C=new Array,D=g(this.hex,m.vidx);if(D==="")return C;for(var O=i(D,0),Y=0;Y<O.length;Y++)C.push(z(a(D,O[Y])));return C},this.getExtSubjectAltName=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("subjectAltName");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"subjectAltName",array:[]};return C&&(O.critical=!0),O.array=this.getGeneralNames(m),O},this.getExtIssuerAltName=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("issuerAltName");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"issuerAltName",array:[]};return C&&(O.critical=!0),O.array=this.getGeneralNames(m),O},this.getGeneralNames=function(m){for(var C=i(m,0),D=[],O=0;O<C.length;O++){var Y=this.getGeneralName(g(m,C[O]));Y!==void 0&&D.push(Y)}return D},this.getGeneralName=function(m){var C=m.substr(0,2),D=a(m,0),O=lt(D);return C=="81"?{rfc822:O}:C=="82"?{dns:O}:C=="86"?{uri:O}:C=="87"?{ip:wr(D)}:C=="a4"?{dn:this.getX500Name(D)}:void 0},this.getExtSubjectAltName2=function(){var m,C,D,O=this.getExtInfo("subjectAltName");if(O===void 0)return O;for(var Y=new Array,ee=g(this.hex,O.vidx),ue=i(ee,0),ne=0;ne<ue.length;ne++)D=ee.substr(ue[ne],2),m=a(ee,ue[ne]),D==="81"&&(C=Oe(m),Y.push(["MAIL",C])),D==="82"&&(C=Oe(m),Y.push(["DNS",C])),D==="84"&&(C=He.hex2dn(m,0),Y.push(["DN",C])),D==="86"&&(C=Oe(m),Y.push(["URI",C])),D==="87"&&(C=wr(m),Y.push(["IP",C]));return Y},this.getExtCRLDistributionPoints=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("cRLDistributionPoints");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"cRLDistributionPoints",array:[]};C&&(O.critical=!0);for(var Y=i(m,0),ee=0;ee<Y.length;ee++){var ue=g(m,Y[ee]);O.array.push(this.getDistributionPoint(ue))}return O},this.getDistributionPoint=function(m){for(var C={},D=i(m,0),O=0;O<D.length;O++){var Y=m.substr(D[O],2),ee=g(m,D[O]);Y=="a0"&&(C.dpname=this.getDistributionPointName(ee))}return C},this.getDistributionPointName=function(m){for(var C={},D=i(m,0),O=0;O<D.length;O++){var Y=m.substr(D[O],2),ee=g(m,D[O]);Y=="a0"&&(C.full=this.getGeneralNames(ee))}return C},this.getExtCRLDistributionPointsURI=function(){var m=this.getExtInfo("cRLDistributionPoints");if(m===void 0)return m;for(var C=new Array,D=i(this.hex,m.vidx),O=0;O<D.length;O++)try{var Y=Oe(_(this.hex,D[O],[0,0,0],"86"));C.push(Y)}catch{}return C},this.getExtAIAInfo=function(){var m=this.getExtInfo("authorityInfoAccess");if(m===void 0)return m;for(var C={ocsp:[],caissuer:[]},D=i(this.hex,m.vidx),O=0;O<D.length;O++){var Y=_(this.hex,D[O],[0],"06"),ee=_(this.hex,D[O],[1],"86");Y==="2b06010505073001"&&C.ocsp.push(Oe(ee)),Y==="2b06010505073002"&&C.caissuer.push(Oe(ee))}return C},this.getExtAuthorityInfoAccess=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("authorityInfoAccess");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"authorityInfoAccess",array:[]};C&&(O.critical=!0);for(var Y=i(m,0),ee=0;ee<Y.length;ee++){var ue=x(m,Y[ee],[0],"06"),ne=Oe(_(m,Y[ee],[1],"86"));if(ue=="2b06010505073001")O.array.push({ocsp:ne});else{if(ue!="2b06010505073002")throw new Error("unknown method: "+ue);O.array.push({caissuer:ne})}}return O},this.getExtCertificatePolicies=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("certificatePolicies");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"certificatePolicies",array:[]};C&&(O.critical=!0);for(var Y=i(m,0),ee=0;ee<Y.length;ee++){var ue=g(m,Y[ee]),ne=this.getPolicyInformation(ue);O.array.push(ne)}return O},this.getPolicyInformation=function(m){var C={},D=_(m,0,[0],"06");C.policyoid=z(D);var O=U(m,0,[1],"30");if(O!=-1){C.array=[];for(var Y=i(m,O),ee=0;ee<Y.length;ee++){var ue=g(m,Y[ee]),ne=this.getPolicyQualifierInfo(ue);C.array.push(ne)}}return C},this.getPolicyQualifierInfo=function(m){var C={},D=_(m,0,[0],"06");if(D==="2b06010505070201"){var O=x(m,0,[1],"16");C.cps=lt(O)}else if(D==="2b06010505070202"){var Y=F(m,0,[1],"30");C.unotice=this.getUserNotice(Y)}return C},this.getUserNotice=function(m){for(var C={},D=i(m,0),O=0;O<D.length;O++){var Y=g(m,D[O]);Y.substr(0,2)!="30"&&(C.exptext=this.getDisplayText(Y))}return C},this.getDisplayText=function(m){var C={};return C.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[m.substr(0,2)],C.str=lt(a(m,0)),C},this.getExtCRLNumber=function(m,C){var D={extname:"cRLNumber"};if(C&&(D.critical=!0),m.substr(0,2)=="02")return D.num={hex:a(m,0)},D;throw new Error("hExtV parse error: "+m)},this.getExtCRLReason=function(m,C){var D={extname:"cRLReason"};if(C&&(D.critical=!0),m.substr(0,2)=="0a")return D.code=parseInt(a(m,0),16),D;throw new Error("hExtV parse error: "+m)},this.getExtOcspNonce=function(m,C){var D={extname:"ocspNonce"};C&&(D.critical=!0);var O=a(m,0);return D.hex=O,D},this.getExtOcspNoCheck=function(m,C){var D={extname:"ocspNoCheck"};return C&&(D.critical=!0),D},this.getExtAdobeTimeStamp=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("adobeTimeStamp");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"adobeTimeStamp"};C&&(O.critical=!0);var Y=i(m,0);if(Y.length>1){var ee=g(m,Y[1]),ue=this.getGeneralName(ee);ue.uri!=null&&(O.uri=ue.uri)}if(Y.length>2){var ne=g(m,Y[2]);ne=="0101ff"&&(O.reqauth=!0),ne=="010100"&&(O.reqauth=!1)}return O},this.getX500NameRule=function(m){for(var C=null,D=[],O=0;O<m.length;O++)for(var Y=m[O],ee=0;ee<Y.length;ee++)D.push(Y[ee]);for(O=0;O<D.length;O++){var ue=D[O],ne=ue.ds,ge=ue.value,ae=ue.type;if(ne!="prn"&&ne!="utf8"&&ne!="ia5")return"mixed";if(ne=="ia5"){if(ae!="CN")return"mixed";if(E.lang.String.isMail(ge))continue;return"mixed"}if(ae=="C"){if(ne=="prn")continue;return"mixed"}if(C==null)C=ne;else if(C!==ne)return"mixed"}return C??"prn"},this.getX500Name=function(m){var C=this.getX500NameArray(m);return{array:C,str:this.dnarraytostr(C)}},this.getX500NameArray=function(m){for(var C=[],D=i(m,0),O=0;O<D.length;O++)C.push(this.getRDN(g(m,D[O])));return C},this.getRDN=function(m){for(var C=[],D=i(m,0),O=0;O<D.length;O++)C.push(this.getAttrTypeAndValue(g(m,D[O])));return C},this.getAttrTypeAndValue=function(m){var C={type:null,value:null,ds:null},D=i(m,0),O=_(m,D[0],[],"06"),Y=_(m,D[1],[]),ee=E.asn1.ASN1Util.oidHexToInt(O);return C.type=E.asn1.x509.OID.oid2atype(ee),C.ds=this.HEX2STAG[m.substr(D[1],2)],C.ds!="bmp"?C.value=Oe(Y):C.value=rn(Y),C},this.readCertPEM=function(m){this.readCertHex(Z(m))},this.readCertHex=function(m){this.hex=m,this.getVersion();try{k(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var m={};return m.version=this.getVersion(),m.serial={hex:this.getSerialNumberHex()},m.sigalg=this.getSignatureAlgorithmField(),m.issuer=this.getIssuer(),m.notbefore=this.getNotBefore(),m.notafter=this.getNotAfter(),m.subject=this.getSubject(),m.sbjpubkey=ot(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(m.ext=this.getExtParamArray()),m.sighex=this.getSignatureValueHex(),m},this.getExtParamArray=function(m){m==null&&U(this.hex,0,[0,"[3]"])!=-1&&(m=A(this.hex,0,[0,"[3]",0],"30"));for(var C=[],D=i(m,0),O=0;O<D.length;O++){var Y=g(m,D[O]),ee=this.getExtParam(Y);ee!=null&&C.push(ee)}return C},this.getExtParam=function(m){var C=i(m,0).length;if(C!=2&&C!=3)throw new Error("wrong number elements in Extension: "+C+" "+m);var D=Q(_(m,0,[0],"06")),O=!1;C==3&&F(m,0,[1])=="0101ff"&&(O=!0);var Y=F(m,0,[C-1,0]),ee=void 0;if(D=="2.5.29.14"?ee=this.getExtSubjectKeyIdentifier(Y,O):D=="2.5.29.15"?ee=this.getExtKeyUsage(Y,O):D=="2.5.29.17"?ee=this.getExtSubjectAltName(Y,O):D=="2.5.29.18"?ee=this.getExtIssuerAltName(Y,O):D=="2.5.29.19"?ee=this.getExtBasicConstraints(Y,O):D=="2.5.29.31"?ee=this.getExtCRLDistributionPoints(Y,O):D=="2.5.29.32"?ee=this.getExtCertificatePolicies(Y,O):D=="2.5.29.35"?ee=this.getExtAuthorityKeyIdentifier(Y,O):D=="2.5.29.37"?ee=this.getExtExtKeyUsage(Y,O):D=="1.3.6.1.5.5.7.1.1"?ee=this.getExtAuthorityInfoAccess(Y,O):D=="2.5.29.20"?ee=this.getExtCRLNumber(Y,O):D=="2.5.29.21"?ee=this.getExtCRLReason(Y,O):D=="1.3.6.1.5.5.7.48.1.2"?ee=this.getExtOcspNonce(Y,O):D=="1.3.6.1.5.5.7.48.1.5"?ee=this.getExtOcspNoCheck(Y,O):D=="1.2.840.113583.1.1.9.1"&&(ee=this.getExtAdobeTimeStamp(Y,O)),ee!=null)return ee;var ue={extname:D,extn:Y};return O&&(ue.critical=!0),ue},this.findExt=function(m,C){for(var D=0;D<m.length;D++)if(m[D].extname==C)return m[D];return null},this.updateExtCDPFullURI=function(m,C){var D=this.findExt(m,"cRLDistributionPoints");if(D!=null&&D.array!=null){for(var O=D.array,Y=0;Y<O.length;Y++)if(O[Y].dpname!=null&&O[Y].dpname.full!=null)for(var ee=O[Y].dpname.full,ue=0;ue<ee.length;ue++){var ne=ee[Y];ne.uri!=null&&(ne.uri=C)}}},this.updateExtAIAOCSP=function(m,C){var D=this.findExt(m,"authorityInfoAccess");if(D!=null&&D.array!=null)for(var O=D.array,Y=0;Y<O.length;Y++)O[Y].ocsp!=null&&(O[Y].ocsp=C)},this.updateExtAIACAIssuer=function(m,C){var D=this.findExt(m,"authorityInfoAccess");if(D!=null&&D.array!=null)for(var O=D.array,Y=0;Y<O.length;Y++)O[Y].caissuer!=null&&(O[Y].caissuer=C)},this.dnarraytostr=function(m){return"/"+m.map(function(C){return function(O){return O.map(function(Y){return function(ue){return ue.type+"="+ue.value}(Y).replace(/\+/,"\\+")}).join("+")}(C).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var m,C,D,O=function(st){return JSON.stringify(st.array).replace(/[\[\]\{\}\"]/g,"")},Y=function(st){for(var Qe="",Ze=st.array,Ue=0;Ue<Ze.length;Ue++){var Me=Ze[Ue];if(Qe+="    policy oid: "+Me.policyoid+`
`,Me.array!==void 0)for(var Je=0;Je<Me.array.length;Je++){var et=Me.array[Je];et.cps!==void 0&&(Qe+="    cps: "+et.cps+`
`)}}return Qe},ee=function(st){for(var Qe="",Ze=st.array,Ue=0;Ue<Ze.length;Ue++){var Me=Ze[Ue];try{Me.dpname.full[0].uri!==void 0&&(Qe+="    "+Me.dpname.full[0].uri+`
`)}catch{}try{Me.dname.full[0].dn.hex!==void 0&&(Qe+="    "+He.hex2dn(Me.dpname.full[0].dn.hex)+`
`)}catch{}}return Qe},ue=function(st){for(var Qe="",Ze=st.array,Ue=0;Ue<Ze.length;Ue++){var Me=Ze[Ue];Me.caissuer!==void 0&&(Qe+="    caissuer: "+Me.caissuer+`
`),Me.ocsp!==void 0&&(Qe+="    ocsp: "+Me.ocsp+`
`)}return Qe};if(m=`Basic Fields
`,m+="  serial number: "+this.getSerialNumberHex()+`
`,m+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,m+="  issuer: "+this.getIssuerString()+`
`,m+="  notBefore: "+this.getNotBefore()+`
`,m+="  notAfter: "+this.getNotAfter()+`
`,m+="  subject: "+this.getSubjectString()+`
`,m+=`  subject public key info: 
`,m+="    key algorithm: "+(C=this.getPublicKey()).type+`
`,C.type==="RSA"&&(m+="    n="+br(C.n.toString(16)).substr(0,16)+`...
`,m+="    e="+br(C.e.toString(16))+`
`),(D=this.aExtInfo)!=null){m+=`X509v3 Extensions:
`;for(var ne=0;ne<D.length;ne++){var ge=D[ne],ae=E.asn1.x509.OID.oid2name(ge.oid);ae===""&&(ae=ge.oid);var le="";if(ge.critical===!0&&(le="CRITICAL"),m+="  "+ae+" "+le+`:
`,ae==="basicConstraints"){var Ee=this.getExtBasicConstraints();Ee.cA===void 0?m+=`    {}
`:(m+="    cA=true",Ee.pathLen!==void 0&&(m+=", pathLen="+Ee.pathLen),m+=`
`)}else if(ae==="keyUsage")m+="    "+this.getExtKeyUsageString()+`
`;else if(ae==="subjectKeyIdentifier")m+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ae==="authorityKeyIdentifier"){var Pe=this.getExtAuthorityKeyIdentifier();Pe.kid!==void 0&&(m+="    kid="+Pe.kid.hex+`
`)}else ae==="extKeyUsage"?m+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ae==="subjectAltName"?m+="    "+O(this.getExtSubjectAltName())+`
`:ae==="cRLDistributionPoints"?m+=ee(this.getExtCRLDistributionPoints()):ae==="authorityInfoAccess"?m+=ue(this.getExtAuthorityInfoAccess()):ae==="certificatePolicies"&&(m+=Y(this.getExtCertificatePolicies()))}}return m+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,m+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof t=="string"&&(t.indexOf("-----BEGIN")!=-1?this.readCertPEM(t):E.lang.String.isHex(t)&&this.readCertHex(t))}he.prototype.sign=function(t,e){var r=function(a){return E.crypto.Util.hashString(a,e)}(t);return this.signWithMessageHash(r,e)},he.prototype.signWithMessageHash=function(t,e){var r=it(E.crypto.Util.getPaddedDigestInfoHex(t,e,this.n.bitLength()),16);return sn(this.doPrivate(r).toString(16),this.n.bitLength())},he.prototype.signPSS=function(t,e,r){var i=function(g){return E.crypto.Util.hashHex(g,e)}(mt(t));return r===void 0&&(r=-1),this.signWithMessageHashPSS(i,e,r)},he.prototype.signWithMessageHashPSS=function(t,e,r){var i,a=lt(t),g=a.length,_=this.n.bitLength()-1,x=Math.ceil(_/8),F=function(m){return E.crypto.Util.hashHex(m,e)};if(r===-1||r===void 0)r=g;else if(r===-2)r=x-g-2;else if(r<-2)throw new Error("invalid salt length");if(x<g+r+2)throw new Error("data too long");var A="";r>0&&(A=new Array(r),new we().nextBytes(A),A=String.fromCharCode.apply(String,A));var k=lt(F(mt("\0\0\0\0\0\0\0\0"+a+A))),U=[];for(i=0;i<x-r-g-2;i+=1)U[i]=0;var H=String.fromCharCode.apply(String,U)+""+A,q=an(k,H.length,F),z=[];for(i=0;i<H.length;i+=1)z[i]=H.charCodeAt(i)^q.charCodeAt(i);var Q=65280>>8*x-_&255;for(z[0]&=~Q,i=0;i<g;i++)z.push(k.charCodeAt(i));return z.push(188),sn(this.doPrivate(new B(z)).toString(16),this.n.bitLength())},he.prototype.verify=function(t,e){if((e=e.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var r=it(e,16),i=this.n.bitLength();if(r.bitLength()>i)return!1;var a=this.doPublic(r).toString(16);if(a.length+3!=i/4)return!1;var g=un(a.replace(/^1f+00/,""));if(g.length==0)return!1;var _=g[0];return g[1]==function(F){return E.crypto.Util.hashString(F,_)}(t)},he.prototype.verifyWithMessageHash=function(t,e){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var r=it(e,16);if(r.bitLength()>this.n.bitLength())return 0;var i=un(this.doPublic(r).toString(16).replace(/^1f+00/,""));return i.length==0?!1:(i[0],i[1]==t)},he.prototype.verifyPSS=function(t,e,r,i){var a=function(_){return E.crypto.Util.hashHex(_,r)}(mt(t));return i===void 0&&(i=-1),this.verifyWithMessageHashPSS(a,e,r,i)},he.prototype.verifyWithMessageHashPSS=function(t,e,r,i){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var a,g=new B(e,16),_=function(D){return E.crypto.Util.hashHex(D,r)},x=lt(t),F=x.length,A=this.n.bitLength()-1,k=Math.ceil(A/8);if(i===-1||i===void 0)i=F;else if(i===-2)i=k-F-2;else if(i<-2)throw new Error("invalid salt length");if(k<F+i+2)throw new Error("data too long");var U=this.doPublic(g).toByteArray();for(a=0;a<U.length;a+=1)U[a]&=255;for(;U.length<k;)U.unshift(0);if(U[k-1]!==188)throw new Error("encoded message does not end in 0xbc");var H=(U=String.fromCharCode.apply(String,U)).substr(0,k-F-1),q=U.substr(H.length,F),z=65280>>8*k-A&255;if(H.charCodeAt(0)&z)throw new Error("bits beyond keysize not zero");var Q=an(q,H.length,_),Z=[];for(a=0;a<H.length;a+=1)Z[a]=H.charCodeAt(a)^Q.charCodeAt(a);Z[0]&=~z;var m=k-F-i-2;for(a=0;a<m;a+=1)if(Z[a]!==0)throw new Error("leftmost octets not zero");if(Z[m]!==1)throw new Error("0x01 marker not found");return q===lt(_(mt("\0\0\0\0\0\0\0\0"+x+String.fromCharCode.apply(String,Z.slice(-i)))))},he.SALT_LEN_HLEN=-1,he.SALT_LEN_MAX=-2,he.SALT_LEN_RECOVER=-2,He.hex2dn=function(t,e){e===void 0&&(e=0);var r=new He;return se.getTLV(t,e),r.getX500Name(t).str},He.hex2rdn=function(t,e){if(e===void 0&&(e=0),t.substr(e,2)!=="31")throw new Error("malformed RDN");for(var r=new Array,i=se.getChildIdx(t,e),a=0;a<i.length;a++)r.push(He.hex2attrTypeValue(t,i[a]));return(r=r.map(function(g){return g.replace("+","\\+")})).join("+")},He.hex2attrTypeValue=function(t,e){var r=se,i=r.getV;if(e===void 0&&(e=0),t.substr(e,2)!=="30")throw new Error("malformed attribute type and value");var a=r.getChildIdx(t,e);a.length!==2||t.substr(a[0],2);var g=i(t,a[0]),_=E.asn1.ASN1Util.oidHexToInt(g);return E.asn1.x509.OID.oid2atype(_)+"="+lt(i(t,a[1]))},He.getPublicKeyFromCertHex=function(t){var e=new He;return e.readCertHex(t),e.getPublicKey()},He.getPublicKeyFromCertPEM=function(t){var e=new He;return e.readCertPEM(t),e.getPublicKey()},He.getPublicKeyInfoPropOfCertPEM=function(t){var e,r,i=se.getVbyList,a={};return a.algparam=null,(e=new He).readCertPEM(t),r=e.getPublicKeyHex(),a.keyhex=i(r,0,[1],"03").substr(2),a.algoid=i(r,0,[0,0],"06"),a.algoid==="2a8648ce3d0201"&&(a.algparam=i(r,0,[0,1],"06")),a},He.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],E!==void 0&&E||(o.KJUR=E={}),E.jws!==void 0&&E.jws||(E.jws={}),E.jws.JWS=function(){var t=E.jws.JWS.isSafeJSONString;this.parseJWS=function(e,r){if(this.parsedJWS===void 0||!r&&this.parsedJWS.sigvalH===void 0){var i=e.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(i==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var a=i[1],g=i[2],_=i[3],x=a+"."+g;if(this.parsedJWS={},this.parsedJWS.headB64U=a,this.parsedJWS.payloadB64U=g,this.parsedJWS.sigvalB64U=_,this.parsedJWS.si=x,!r){var F=Fe(_),A=it(F,16);this.parsedJWS.sigvalH=F,this.parsedJWS.sigvalBI=A}var k=gt(a),U=gt(g);if(this.parsedJWS.headS=k,this.parsedJWS.payloadS=U,!t(k,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+k}}},E.jws.JWS.sign=function(t,e,r,i,a){var g,_,x,F=E,A=F.jws.JWS,k=A.readSafeJSONString,U=A.isSafeJSONString,H=F.crypto,q=(H.ECDSA,H.Mac),z=H.Signature,Q=JSON;if(typeof e!="string"&&(e===void 0?"undefined":T(e))!="object")throw"spHeader must be JSON string or object: "+e;if((e===void 0?"undefined":T(e))=="object"&&(_=e,g=Q.stringify(_)),typeof e=="string"){if(!U(g=e))throw"JWS Head is not safe JSON string: "+g;_=k(g)}if(x=r,(r===void 0?"undefined":T(r))=="object"&&(x=Q.stringify(r)),t!=""&&t!=null||_.alg===void 0||(t=_.alg),t!=""&&t!=null&&_.alg===void 0&&(_.alg=t,g=Q.stringify(_)),t!==_.alg)throw"alg and sHeader.alg doesn't match: "+t+"!="+_.alg;var Z=null;if(A.jwsalg2sigalg[t]===void 0)throw"unsupported alg name: "+t;Z=A.jwsalg2sigalg[t];var m=Jt(g)+"."+Jt(x),C="";if(Z.substr(0,4)=="Hmac"){if(i===void 0)throw"mac key shall be specified for HS* alg";var D=new q({alg:Z,prov:"cryptojs",pass:i});D.updateString(m),C=D.doFinal()}else if(Z.indexOf("withECDSA")!=-1){(Y=new z({alg:Z})).init(i,a),Y.updateString(m);var O=Y.sign();C=E.crypto.ECDSA.asn1SigToConcatSig(O)}else{var Y;Z!="none"&&((Y=new z({alg:Z})).init(i,a),Y.updateString(m),C=Y.sign())}return m+"."+Ne(C)},E.jws.JWS.verify=function(t,e,r){var i,a=E,g=a.jws.JWS,_=g.readSafeJSONString,x=a.crypto,F=x.ECDSA,A=x.Mac,k=x.Signature;T(he)!==void 0&&(i=he);var U=t.split(".");if(U.length!==3)return!1;var H=U[0]+"."+U[1],q=Fe(U[2]),z=_(gt(U[0])),Q=null,Z=null;if(z.alg===void 0)throw"algorithm not specified in header";if(Z=(Q=z.alg).substr(0,2),r!=null&&Object.prototype.toString.call(r)==="[object Array]"&&r.length>0&&(":"+r.join(":")+":").indexOf(":"+Q+":")==-1)throw"algorithm '"+Q+"' not accepted in the list";if(Q!="none"&&e===null)throw"key shall be specified to verify.";if(typeof e=="string"&&e.indexOf("-----BEGIN ")!=-1&&(e=De.getKey(e)),!(Z!="RS"&&Z!="PS"||e instanceof i))throw"key shall be a RSAKey obj for RS* and PS* algs";if(Z=="ES"&&!(e instanceof F))throw"key shall be a ECDSA obj for ES* algs";var m=null;if(g.jwsalg2sigalg[z.alg]===void 0)throw"unsupported alg name: "+Q;if((m=g.jwsalg2sigalg[Q])=="none")throw"not supported";if(m.substr(0,4)=="Hmac"){if(e===void 0)throw"hexadecimal key shall be specified for HMAC";var C=new A({alg:m,pass:e});return C.updateString(H),q==C.doFinal()}if(m.indexOf("withECDSA")!=-1){var D,O=null;try{O=F.concatSigToASN1Sig(q)}catch{return!1}return(D=new k({alg:m})).init(e),D.updateString(H),D.verify(O)}return(D=new k({alg:m})).init(e),D.updateString(H),D.verify(q)},E.jws.JWS.parse=function(t){var e,r,i,a=t.split("."),g={};if(a.length!=2&&a.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return e=a[0],r=a[1],a.length==3&&(i=a[2]),g.headerObj=E.jws.JWS.readSafeJSONString(gt(e)),g.payloadObj=E.jws.JWS.readSafeJSONString(gt(r)),g.headerPP=JSON.stringify(g.headerObj,null,"  "),g.payloadObj==null?g.payloadPP=gt(r):g.payloadPP=JSON.stringify(g.payloadObj,null,"  "),i!==void 0&&(g.sigHex=Fe(i)),g},E.jws.JWS.verifyJWT=function(t,e,r){var i=E.jws,a=i.JWS,g=a.readSafeJSONString,_=a.inArray,x=a.includedArray,F=t.split("."),A=F[0],k=F[1],U=(Fe(F[2]),g(gt(A))),H=g(gt(k));if(U.alg===void 0)return!1;if(r.alg===void 0)throw"acceptField.alg shall be specified";if(!_(U.alg,r.alg)||H.iss!==void 0&&T(r.iss)==="object"&&!_(H.iss,r.iss)||H.sub!==void 0&&T(r.sub)==="object"&&!_(H.sub,r.sub))return!1;if(H.aud!==void 0&&T(r.aud)==="object"){if(typeof H.aud=="string"){if(!_(H.aud,r.aud))return!1}else if(T(H.aud)=="object"&&!x(H.aud,r.aud))return!1}var q=i.IntDate.getNow();return r.verifyAt!==void 0&&typeof r.verifyAt=="number"&&(q=r.verifyAt),r.gracePeriod!==void 0&&typeof r.gracePeriod=="number"||(r.gracePeriod=0),!(H.exp!==void 0&&typeof H.exp=="number"&&H.exp+r.gracePeriod<q)&&!(H.nbf!==void 0&&typeof H.nbf=="number"&&q<H.nbf-r.gracePeriod)&&!(H.iat!==void 0&&typeof H.iat=="number"&&q<H.iat-r.gracePeriod)&&(H.jti===void 0||r.jti===void 0||H.jti===r.jti)&&!!a.verify(t,e,r.alg)},E.jws.JWS.includedArray=function(t,e){var r=E.jws.JWS.inArray;if(t===null||(t===void 0?"undefined":T(t))!=="object"||typeof t.length!="number")return!1;for(var i=0;i<t.length;i++)if(!r(t[i],e))return!1;return!0},E.jws.JWS.inArray=function(t,e){if(e===null||(e===void 0?"undefined":T(e))!=="object"||typeof e.length!="number")return!1;for(var r=0;r<e.length;r++)if(e[r]==t)return!0;return!1},E.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},E.jws.JWS.isSafeJSONString=function(t,e,r){var i=null;try{return((i=$r(t))===void 0?"undefined":T(i))!="object"||i.constructor===Array?0:(e&&(e[r]=i),1)}catch{return 0}},E.jws.JWS.readSafeJSONString=function(t){var e=null;try{return((e=$r(t))===void 0?"undefined":T(e))!="object"||e.constructor===Array?null:e}catch{return null}},E.jws.JWS.getEncodedSignatureValueFromJWS=function(t){var e=t.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(e==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return e[1]},E.jws.JWS.getJWKthumbprint=function(t){if(t.kty!=="RSA"&&t.kty!=="EC"&&t.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var e="{";if(t.kty==="RSA"){if(typeof t.n!="string"||typeof t.e!="string")throw"wrong n and e value for RSA key";e+='"e":"'+t.e+'",',e+='"kty":"'+t.kty+'",',e+='"n":"'+t.n+'"}'}else if(t.kty==="EC"){if(typeof t.crv!="string"||typeof t.x!="string"||typeof t.y!="string")throw"wrong crv, x and y value for EC key";e+='"crv":"'+t.crv+'",',e+='"kty":"'+t.kty+'",',e+='"x":"'+t.x+'",',e+='"y":"'+t.y+'"}'}else if(t.kty==="oct"){if(typeof t.k!="string")throw"wrong k value for oct(symmetric) key";e+='"kty":"'+t.kty+'",',e+='"k":"'+t.k+'"}'}var r=mt(e);return Ne(E.crypto.Util.hashHex(r,"sha256"))},E.jws.IntDate={},E.jws.IntDate.get=function(t){var e=E.jws.IntDate,r=e.getNow,i=e.getZulu;if(t=="now")return r();if(t=="now + 1hour")return r()+3600;if(t=="now + 1day")return r()+86400;if(t=="now + 1month")return r()+2592e3;if(t=="now + 1year")return r()+31536e3;if(t.match(/Z$/))return i(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},E.jws.IntDate.getZulu=function(t){return Zr(t)},E.jws.IntDate.getNow=function(){return~~(new Date/1e3)},E.jws.IntDate.intDate2UTCString=function(t){return new Date(1e3*t).toUTCString()},E.jws.IntDate.intDate2Zulu=function(t){var e=new Date(1e3*t);return("0000"+e.getUTCFullYear()).slice(-4)+("00"+(e.getUTCMonth()+1)).slice(-2)+("00"+e.getUTCDate()).slice(-2)+("00"+e.getUTCHours()).slice(-2)+("00"+e.getUTCMinutes()).slice(-2)+("00"+e.getUTCSeconds()).slice(-2)+"Z"},o.SecureRandom=we,o.rng_seed_time=X,o.BigInteger=B,o.RSAKey=he;var pi=E.crypto.EDSA;o.EDSA=pi;var yi=E.crypto.DSA;o.DSA=yi;var vi=E.crypto.Signature;o.Signature=vi;var mi=E.crypto.MessageDigest;o.MessageDigest=mi;var _i=E.crypto.Mac;o.Mac=_i;var Si=E.crypto.Cipher;o.Cipher=Si,o.KEYUTIL=De,o.ASN1HEX=se,o.X509=He,o.CryptoJS=J,o.b64tohex=re,o.b64toBA=ie,o.stoBA=zr,o.BAtos=Gr,o.BAtohex=tr,o.stohex=Ft,o.stob64=function(e){return j(Ft(e))},o.stob64u=function(e){return rr(j(Ft(e)))},o.b64utos=function(e){return Gr(ie(Wt(e)))},o.b64tob64u=rr,o.b64utob64=Wt,o.hex2b64=j,o.hextob64u=Ne,o.b64utohex=Fe,o.utf8tob64u=Jt,o.b64utoutf8=gt,o.utf8tob64=function(e){return j(nr(or(e)))},o.b64toutf8=function(e){return decodeURIComponent(ir(re(e)))},o.utf8tohex=_r,o.hextoutf8=Oe,o.hextorstr=lt,o.rstrtohex=mt,o.hextob64=Yr,o.hextob64nl=Xr,o.b64nltohex=Qr,o.hextopem=ot,o.pemtohex=_t,o.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(e.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var r=new ArrayBuffer(e.length/2),i=new DataView(r),a=0;a<e.length/2;a++)i.setUint8(a,parseInt(e.substr(2*a,2),16));return r},o.ArrayBuffertohex=function(e){for(var r="",i=new DataView(e),a=0;a<e.byteLength;a++)r+=("00"+i.getUint8(a).toString(16)).slice(-2);return r},o.zulutomsec=Sr,o.zulutosec=Zr,o.zulutodate=function(e){return new Date(Sr(e))},o.datetozulu=function(e,r,i){var a,g=e.getUTCFullYear();if(r){if(g<1950||2049<g)throw"not proper year for UTCTime: "+g;a=(""+g).slice(-2)}else a=("000"+g).slice(-4);if(a+=("0"+(e.getUTCMonth()+1)).slice(-2),a+=("0"+e.getUTCDate()).slice(-2),a+=("0"+e.getUTCHours()).slice(-2),a+=("0"+e.getUTCMinutes()).slice(-2),a+=("0"+e.getUTCSeconds()).slice(-2),i){var _=e.getUTCMilliseconds();_!==0&&(a+="."+(_=(_=("00"+_).slice(-3)).replace(/0+$/g,"")))}return a+="Z"},o.uricmptohex=nr,o.hextouricmp=ir,o.ipv6tohex=en,o.hextoipv6=tn,o.hextoip=wr,o.iptohex=function(e){var r="malformed IP address";if(!(e=e.toLowerCase(e)).match(/^[0-9.]+$/)){if(e.match(/^[0-9a-f:]+$/)&&e.indexOf(":")!==-1)return en(e);throw r}var i=e.split(".");if(i.length!==4)throw r;var a="";try{for(var g=0;g<4;g++)a+=("0"+parseInt(i[g]).toString(16)).slice(-2);return a}catch{throw r}},o.encodeURIComponentAll=or,o.newline_toUnix=function(e){return e=e.replace(/\r\n/gm,`
`)},o.newline_toDos=function(e){return e=(e=e.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},o.hextoposhex=br,o.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return e.split(/,/).map(function(r,i,a){var g=parseInt(r);if(g<0||255<g)throw"integer not in range 0-255";return("00"+g.toString(16)).slice(-2)}).join("")}catch(r){throw"malformed integer array string: "+r}},o.strdiffidx=function(e,r){var i=e.length;e.length>r.length&&(i=r.length);for(var a=0;a<i;a++)if(e.charCodeAt(a)!=r.charCodeAt(a))return a;return e.length!=r.length?i:-1},o.KJUR=E;var wi=E.crypto;o.crypto=wi;var bi=E.asn1;o.asn1=bi;var Ei=E.jws;o.jws=Ei;var Fi=E.lang;o.lang=Fi}).call(this,c(28).Buffer)},function(u,o,c){(function(v){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var l=c(30),w=c(31),S=c(32);function d(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(V,p){if(d()<p)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(V=new Uint8Array(p)).__proto__=h.prototype:(V===null&&(V=new h(p)),V.length=p),V}function h(V,p,y){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(V,p,y);if(typeof V=="number"){if(typeof p=="string")throw new Error("If encoding is specified then the first argument must be a string");return P(this,V)}return b(this,V,p,y)}function b(V,p,y,N){if(typeof p=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&p instanceof ArrayBuffer?function(X,te,ce,de){if(te.byteLength,ce<0||te.byteLength<ce)throw new RangeError("'offset' is out of bounds");if(te.byteLength<ce+(de||0))throw new RangeError("'length' is out of bounds");return te=ce===void 0&&de===void 0?new Uint8Array(te):de===void 0?new Uint8Array(te,ce):new Uint8Array(te,ce,de),h.TYPED_ARRAY_SUPPORT?(X=te).__proto__=h.prototype:X=K(X,te),X}(V,p,y,N):typeof p=="string"?function(X,te,ce){if(typeof ce=="string"&&ce!==""||(ce="utf8"),!h.isEncoding(ce))throw new TypeError('"encoding" must be a valid string encoding');var de=0|T(te,ce),Se=(X=f(X,de)).write(te,ce);return Se!==de&&(X=X.slice(0,Se)),X}(V,p,y):function(X,te){if(h.isBuffer(te)){var ce=0|L(te.length);return(X=f(X,ce)).length===0||te.copy(X,0,0,ce),X}if(te){if(typeof ArrayBuffer<"u"&&te.buffer instanceof ArrayBuffer||"length"in te)return typeof te.length!="number"||function(Se){return Se!=Se}(te.length)?f(X,0):K(X,te);if(te.type==="Buffer"&&S(te.data))return K(X,te.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(V,p)}function I(V){if(typeof V!="number")throw new TypeError('"size" argument must be a number');if(V<0)throw new RangeError('"size" argument must not be negative')}function P(V,p){if(I(p),V=f(V,p<0?0:0|L(p)),!h.TYPED_ARRAY_SUPPORT)for(var y=0;y<p;++y)V[y]=0;return V}function K(V,p){var y=p.length<0?0:0|L(p.length);V=f(V,y);for(var N=0;N<y;N+=1)V[N]=255&p[N];return V}function L(V){if(V>=d())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d().toString(16)+" bytes");return 0|V}function T(V,p){if(h.isBuffer(V))return V.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(V)||V instanceof ArrayBuffer))return V.byteLength;typeof V!="string"&&(V=""+V);var y=V.length;if(y===0)return 0;for(var N=!1;;)switch(p){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":case void 0:return nt(V).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*y;case"hex":return y>>>1;case"base64":return Ke(V).length;default:if(N)return nt(V).length;p=(""+p).toLowerCase(),N=!0}}function R(V,p,y){var N=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0)<=(p>>>=0))return"";for(V||(V="utf8");;)switch(V){case"hex":return Le(this,p,y);case"utf8":case"utf-8":return me(this,p,y);case"ascii":return Ie(this,p,y);case"latin1":case"binary":return ze(this,p,y);case"base64":return _e(this,p,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ge(this,p,y);default:if(N)throw new TypeError("Unknown encoding: "+V);V=(V+"").toLowerCase(),N=!0}}function M(V,p,y){var N=V[p];V[p]=V[y],V[y]=N}function J(V,p,y,N,W){if(V.length===0)return-1;if(typeof y=="string"?(N=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,isNaN(y)&&(y=W?0:V.length-1),y<0&&(y=V.length+y),y>=V.length){if(W)return-1;y=V.length-1}else if(y<0){if(!W)return-1;y=0}if(typeof p=="string"&&(p=h.from(p,N)),h.isBuffer(p))return p.length===0?-1:G(V,p,y,N,W);if(typeof p=="number")return p&=255,h.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?W?Uint8Array.prototype.indexOf.call(V,p,y):Uint8Array.prototype.lastIndexOf.call(V,p,y):G(V,[p],y,N,W);throw new TypeError("val must be string, number or Buffer")}function G(V,p,y,N,W){var X,te=1,ce=V.length,de=p.length;if(N!==void 0&&((N=String(N).toLowerCase())==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(V.length<2||p.length<2)return-1;te=2,ce/=2,de/=2,y/=2}function Se(ft,he){return te===1?ft[he]:ft.readUInt16BE(he*te)}if(W){var ve=-1;for(X=y;X<ce;X++)if(Se(V,X)===Se(p,ve===-1?0:X-ve)){if(ve===-1&&(ve=X),X-ve+1===de)return ve*te}else ve!==-1&&(X-=X-ve),ve=-1}else for(y+de>ce&&(y=ce-de),X=y;X>=0;X--){for(var we=!0,it=0;it<de;it++)if(Se(V,X+it)!==Se(p,it)){we=!1;break}if(we)return X}return-1}function $(V,p,y,N){y=Number(y)||0;var W=V.length-y;N?(N=Number(N))>W&&(N=W):N=W;var X=p.length;if(X%2!=0)throw new TypeError("Invalid hex string");N>X/2&&(N=X/2);for(var te=0;te<N;++te){var ce=parseInt(p.substr(2*te,2),16);if(isNaN(ce))return te;V[y+te]=ce}return te}function j(V,p,y,N){return xe(nt(p,V.length-y),V,y,N)}function re(V,p,y,N){return xe(function(X){for(var te=[],ce=0;ce<X.length;++ce)te.push(255&X.charCodeAt(ce));return te}(p),V,y,N)}function ie(V,p,y,N){return re(V,p,y,N)}function B(V,p,y,N){return xe(Ke(p),V,y,N)}function oe(V,p,y,N){return xe(function(X,te){for(var ce,de,Se,ve=[],we=0;we<X.length&&!((te-=2)<0);++we)de=(ce=X.charCodeAt(we))>>8,Se=ce%256,ve.push(Se),ve.push(de);return ve}(p,V.length-y),V,y,N)}function _e(V,p,y){return p===0&&y===V.length?l.fromByteArray(V):l.fromByteArray(V.slice(p,y))}function me(V,p,y){y=Math.min(V.length,y);for(var N=[],W=p;W<y;){var X,te,ce,de,Se=V[W],ve=null,we=Se>239?4:Se>223?3:Se>191?2:1;if(W+we<=y)switch(we){case 1:Se<128&&(ve=Se);break;case 2:(192&(X=V[W+1]))==128&&(de=(31&Se)<<6|63&X)>127&&(ve=de);break;case 3:X=V[W+1],te=V[W+2],(192&X)==128&&(192&te)==128&&(de=(15&Se)<<12|(63&X)<<6|63&te)>2047&&(de<55296||de>57343)&&(ve=de);break;case 4:X=V[W+1],te=V[W+2],ce=V[W+3],(192&X)==128&&(192&te)==128&&(192&ce)==128&&(de=(15&Se)<<18|(63&X)<<12|(63&te)<<6|63&ce)>65535&&de<1114112&&(ve=de)}ve===null?(ve=65533,we=1):ve>65535&&(ve-=65536,N.push(ve>>>10&1023|55296),ve=56320|1023&ve),N.push(ve),W+=we}return function(ft){var he=ft.length;if(he<=$e)return String.fromCharCode.apply(String,ft);for(var ke="",pe=0;pe<he;)ke+=String.fromCharCode.apply(String,ft.slice(pe,pe+=$e));return ke}(N)}o.Buffer=h,o.SlowBuffer=function(p){return+p!=p&&(p=0),h.alloc(+p)},o.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=v.TYPED_ARRAY_SUPPORT!==void 0?v.TYPED_ARRAY_SUPPORT:function(){try{var p=new Uint8Array(1);return p.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},p.foo()===42&&typeof p.subarray=="function"&&p.subarray(1,1).byteLength===0}catch{return!1}}(),o.kMaxLength=d(),h.poolSize=8192,h._augment=function(V){return V.__proto__=h.prototype,V},h.from=function(V,p,y){return b(null,V,p,y)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(V,p,y){return function(W,X,te,ce){return I(X),X<=0?f(W,X):te!==void 0?typeof ce=="string"?f(W,X).fill(te,ce):f(W,X).fill(te):f(W,X)}(null,V,p,y)},h.allocUnsafe=function(V){return P(null,V)},h.allocUnsafeSlow=function(V){return P(null,V)},h.isBuffer=function(p){return!(p==null||!p._isBuffer)},h.compare=function(p,y){if(!h.isBuffer(p)||!h.isBuffer(y))throw new TypeError("Arguments must be Buffers");if(p===y)return 0;for(var N=p.length,W=y.length,X=0,te=Math.min(N,W);X<te;++X)if(p[X]!==y[X]){N=p[X],W=y[X];break}return N<W?-1:W<N?1:0},h.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(p,y){if(!S(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return h.alloc(0);var N;if(y===void 0)for(y=0,N=0;N<p.length;++N)y+=p[N].length;var W=h.allocUnsafe(y),X=0;for(N=0;N<p.length;++N){var te=p[N];if(!h.isBuffer(te))throw new TypeError('"list" argument must be an Array of Buffers');te.copy(W,X),X+=te.length}return W},h.byteLength=T,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var p=this.length;if(p%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var y=0;y<p;y+=2)M(this,y,y+1);return this},h.prototype.swap32=function(){var p=this.length;if(p%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var y=0;y<p;y+=4)M(this,y,y+3),M(this,y+1,y+2);return this},h.prototype.swap64=function(){var p=this.length;if(p%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var y=0;y<p;y+=8)M(this,y,y+7),M(this,y+1,y+6),M(this,y+2,y+5),M(this,y+3,y+4);return this},h.prototype.toString=function(){var p=0|this.length;return p===0?"":arguments.length===0?me(this,0,p):R.apply(this,arguments)},h.prototype.equals=function(p){if(!h.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p||h.compare(this,p)===0},h.prototype.inspect=function(){var p="",y=o.INSPECT_MAX_BYTES;return this.length>0&&(p=this.toString("hex",0,y).match(/.{2}/g).join(" "),this.length>y&&(p+=" ... ")),"<Buffer "+p+">"},h.prototype.compare=function(p,y,N,W,X){if(!h.isBuffer(p))throw new TypeError("Argument must be a Buffer");if(y===void 0&&(y=0),N===void 0&&(N=p?p.length:0),W===void 0&&(W=0),X===void 0&&(X=this.length),y<0||N>p.length||W<0||X>this.length)throw new RangeError("out of range index");if(W>=X&&y>=N)return 0;if(W>=X)return-1;if(y>=N)return 1;if(this===p)return 0;for(var te=(X>>>=0)-(W>>>=0),ce=(N>>>=0)-(y>>>=0),de=Math.min(te,ce),Se=this.slice(W,X),ve=p.slice(y,N),we=0;we<de;++we)if(Se[we]!==ve[we]){te=Se[we],ce=ve[we];break}return te<ce?-1:ce<te?1:0},h.prototype.includes=function(p,y,N){return this.indexOf(p,y,N)!==-1},h.prototype.indexOf=function(p,y,N){return J(this,p,y,N,!0)},h.prototype.lastIndexOf=function(p,y,N){return J(this,p,y,N,!1)},h.prototype.write=function(p,y,N,W){if(y===void 0)W="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")W=y,N=this.length,y=0;else{if(!isFinite(y))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");y|=0,isFinite(N)?(N|=0,W===void 0&&(W="utf8")):(W=N,N=void 0)}var X=this.length-y;if((N===void 0||N>X)&&(N=X),p.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var te=!1;;)switch(W){case"hex":return $(this,p,y,N);case"utf8":case"utf-8":return j(this,p,y,N);case"ascii":return re(this,p,y,N);case"latin1":case"binary":return ie(this,p,y,N);case"base64":return B(this,p,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,p,y,N);default:if(te)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),te=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $e=4096;function Ie(V,p,y){var N="";y=Math.min(V.length,y);for(var W=p;W<y;++W)N+=String.fromCharCode(127&V[W]);return N}function ze(V,p,y){var N="";y=Math.min(V.length,y);for(var W=p;W<y;++W)N+=String.fromCharCode(V[W]);return N}function Le(V,p,y){var N=V.length;(!p||p<0)&&(p=0),(!y||y<0||y>N)&&(y=N);for(var W="",X=p;X<y;++X)W+=Xe(V[X]);return W}function Ge(V,p,y){for(var N=V.slice(p,y),W="",X=0;X<N.length;X+=2)W+=String.fromCharCode(N[X]+256*N[X+1]);return W}function fe(V,p,y){if(V%1!=0||V<0)throw new RangeError("offset is not uint");if(V+p>y)throw new RangeError("Trying to access beyond buffer length")}function ye(V,p,y,N,W,X){if(!h.isBuffer(V))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>W||p<X)throw new RangeError('"value" argument is out of bounds');if(y+N>V.length)throw new RangeError("Index out of range")}function Ve(V,p,y,N){p<0&&(p=65535+p+1);for(var W=0,X=Math.min(V.length-y,2);W<X;++W)V[y+W]=(p&255<<8*(N?W:1-W))>>>8*(N?W:1-W)}function Ye(V,p,y,N){p<0&&(p=4294967295+p+1);for(var W=0,X=Math.min(V.length-y,4);W<X;++W)V[y+W]=p>>>8*(N?W:3-W)&255}function tt(V,p,y,N,W,X){if(y+N>V.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function rt(V,p,y,N,W){return W||tt(V,0,y,4),w.write(V,p,y,N,23,4),y+4}function ct(V,p,y,N,W){return W||tt(V,0,y,8),w.write(V,p,y,N,52,8),y+8}h.prototype.slice=function(p,y){var N,W=this.length;if((p=~~p)<0?(p+=W)<0&&(p=0):p>W&&(p=W),(y=y===void 0?W:~~y)<0?(y+=W)<0&&(y=0):y>W&&(y=W),y<p&&(y=p),h.TYPED_ARRAY_SUPPORT)(N=this.subarray(p,y)).__proto__=h.prototype;else{var X=y-p;N=new h(X,void 0);for(var te=0;te<X;++te)N[te]=this[te+p]}return N},h.prototype.readUIntLE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=this[p],X=1,te=0;++te<y&&(X*=256);)W+=this[p+te]*X;return W},h.prototype.readUIntBE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=this[p+--y],X=1;y>0&&(X*=256);)W+=this[p+--y]*X;return W},h.prototype.readUInt8=function(p,y){return y||fe(p,1,this.length),this[p]},h.prototype.readUInt16LE=function(p,y){return y||fe(p,2,this.length),this[p]|this[p+1]<<8},h.prototype.readUInt16BE=function(p,y){return y||fe(p,2,this.length),this[p]<<8|this[p+1]},h.prototype.readUInt32LE=function(p,y){return y||fe(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+16777216*this[p+3]},h.prototype.readUInt32BE=function(p,y){return y||fe(p,4,this.length),16777216*this[p]+(this[p+1]<<16|this[p+2]<<8|this[p+3])},h.prototype.readIntLE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=this[p],X=1,te=0;++te<y&&(X*=256);)W+=this[p+te]*X;return W>=(X*=128)&&(W-=Math.pow(2,8*y)),W},h.prototype.readIntBE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=y,X=1,te=this[p+--W];W>0&&(X*=256);)te+=this[p+--W]*X;return te>=(X*=128)&&(te-=Math.pow(2,8*y)),te},h.prototype.readInt8=function(p,y){return y||fe(p,1,this.length),128&this[p]?-1*(255-this[p]+1):this[p]},h.prototype.readInt16LE=function(p,y){y||fe(p,2,this.length);var N=this[p]|this[p+1]<<8;return 32768&N?4294901760|N:N},h.prototype.readInt16BE=function(p,y){y||fe(p,2,this.length);var N=this[p+1]|this[p]<<8;return 32768&N?4294901760|N:N},h.prototype.readInt32LE=function(p,y){return y||fe(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},h.prototype.readInt32BE=function(p,y){return y||fe(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},h.prototype.readFloatLE=function(p,y){return y||fe(p,4,this.length),w.read(this,p,!0,23,4)},h.prototype.readFloatBE=function(p,y){return y||fe(p,4,this.length),w.read(this,p,!1,23,4)},h.prototype.readDoubleLE=function(p,y){return y||fe(p,8,this.length),w.read(this,p,!0,52,8)},h.prototype.readDoubleBE=function(p,y){return y||fe(p,8,this.length),w.read(this,p,!1,52,8)},h.prototype.writeUIntLE=function(p,y,N,W){p=+p,y|=0,N|=0,W||ye(this,p,y,N,Math.pow(2,8*N)-1,0);var X=1,te=0;for(this[y]=255&p;++te<N&&(X*=256);)this[y+te]=p/X&255;return y+N},h.prototype.writeUIntBE=function(p,y,N,W){p=+p,y|=0,N|=0,W||ye(this,p,y,N,Math.pow(2,8*N)-1,0);var X=N-1,te=1;for(this[y+X]=255&p;--X>=0&&(te*=256);)this[y+X]=p/te&255;return y+N},h.prototype.writeUInt8=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,1,255,0),h.TYPED_ARRAY_SUPPORT||(p=Math.floor(p)),this[y]=255&p,y+1},h.prototype.writeUInt16LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[y]=255&p,this[y+1]=p>>>8):Ve(this,p,y,!0),y+2},h.prototype.writeUInt16BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[y]=p>>>8,this[y+1]=255&p):Ve(this,p,y,!1),y+2},h.prototype.writeUInt32LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[y+3]=p>>>24,this[y+2]=p>>>16,this[y+1]=p>>>8,this[y]=255&p):Ye(this,p,y,!0),y+4},h.prototype.writeUInt32BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[y]=p>>>24,this[y+1]=p>>>16,this[y+2]=p>>>8,this[y+3]=255&p):Ye(this,p,y,!1),y+4},h.prototype.writeIntLE=function(p,y,N,W){if(p=+p,y|=0,!W){var X=Math.pow(2,8*N-1);ye(this,p,y,N,X-1,-X)}var te=0,ce=1,de=0;for(this[y]=255&p;++te<N&&(ce*=256);)p<0&&de===0&&this[y+te-1]!==0&&(de=1),this[y+te]=(p/ce>>0)-de&255;return y+N},h.prototype.writeIntBE=function(p,y,N,W){if(p=+p,y|=0,!W){var X=Math.pow(2,8*N-1);ye(this,p,y,N,X-1,-X)}var te=N-1,ce=1,de=0;for(this[y+te]=255&p;--te>=0&&(ce*=256);)p<0&&de===0&&this[y+te+1]!==0&&(de=1),this[y+te]=(p/ce>>0)-de&255;return y+N},h.prototype.writeInt8=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,1,127,-128),h.TYPED_ARRAY_SUPPORT||(p=Math.floor(p)),p<0&&(p=255+p+1),this[y]=255&p,y+1},h.prototype.writeInt16LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[y]=255&p,this[y+1]=p>>>8):Ve(this,p,y,!0),y+2},h.prototype.writeInt16BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[y]=p>>>8,this[y+1]=255&p):Ve(this,p,y,!1),y+2},h.prototype.writeInt32LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[y]=255&p,this[y+1]=p>>>8,this[y+2]=p>>>16,this[y+3]=p>>>24):Ye(this,p,y,!0),y+4},h.prototype.writeInt32BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),h.TYPED_ARRAY_SUPPORT?(this[y]=p>>>24,this[y+1]=p>>>16,this[y+2]=p>>>8,this[y+3]=255&p):Ye(this,p,y,!1),y+4},h.prototype.writeFloatLE=function(p,y,N){return rt(this,p,y,!0,N)},h.prototype.writeFloatBE=function(p,y,N){return rt(this,p,y,!1,N)},h.prototype.writeDoubleLE=function(p,y,N){return ct(this,p,y,!0,N)},h.prototype.writeDoubleBE=function(p,y,N){return ct(this,p,y,!1,N)},h.prototype.copy=function(p,y,N,W){if(N||(N=0),W||W===0||(W=this.length),y>=p.length&&(y=p.length),y||(y=0),W>0&&W<N&&(W=N),W===N||p.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("sourceStart out of bounds");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),p.length-y<W-N&&(W=p.length-y+N);var X,te=W-N;if(this===p&&N<y&&y<W)for(X=te-1;X>=0;--X)p[X+y]=this[X+N];else if(te<1e3||!h.TYPED_ARRAY_SUPPORT)for(X=0;X<te;++X)p[X+y]=this[X+N];else Uint8Array.prototype.set.call(p,this.subarray(N,N+te),y);return te},h.prototype.fill=function(p,y,N,W){if(typeof p=="string"){if(typeof y=="string"?(W=y,y=0,N=this.length):typeof N=="string"&&(W=N,N=this.length),p.length===1){var X=p.charCodeAt(0);X<256&&(p=X)}if(W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!h.isEncoding(W))throw new TypeError("Unknown encoding: "+W)}else typeof p=="number"&&(p&=255);if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;var te;if(y>>>=0,N=N===void 0?this.length:N>>>0,p||(p=0),typeof p=="number")for(te=y;te<N;++te)this[te]=p;else{var ce=h.isBuffer(p)?p:nt(new h(p,W).toString()),de=ce.length;for(te=0;te<N-y;++te)this[te+y]=ce[te%de]}return this};var Et=/[^+\/0-9A-Za-z-_]/g;function Xe(V){return V<16?"0"+V.toString(16):V.toString(16)}function nt(V,p){var y;p=p||1/0;for(var N=V.length,W=null,X=[],te=0;te<N;++te){if((y=V.charCodeAt(te))>55295&&y<57344){if(!W){if(y>56319){(p-=3)>-1&&X.push(239,191,189);continue}if(te+1===N){(p-=3)>-1&&X.push(239,191,189);continue}W=y;continue}if(y<56320){(p-=3)>-1&&X.push(239,191,189),W=y;continue}y=65536+(W-55296<<10|y-56320)}else W&&(p-=3)>-1&&X.push(239,191,189);if(W=null,y<128){if((p-=1)<0)break;X.push(y)}else if(y<2048){if((p-=2)<0)break;X.push(y>>6|192,63&y|128)}else if(y<65536){if((p-=3)<0)break;X.push(y>>12|224,y>>6&63|128,63&y|128)}else{if(!(y<1114112))throw new Error("Invalid code point");if((p-=4)<0)break;X.push(y>>18|240,y>>12&63|128,y>>6&63|128,63&y|128)}}return X}function Ke(V){return l.toByteArray(function(y){if((y=function(W){return W.trim?W.trim():W.replace(/^\s+|\s+$/g,"")}(y).replace(Et,"")).length<2)return"";for(;y.length%4!=0;)y+="=";return y}(V))}function xe(V,p,y,N){for(var W=0;W<N&&!(W+y>=p.length||W>=V.length);++W)p[W+y]=V[W];return W}}).call(this,c(29))},function(u,o){var c;c=function(){return this}();try{c=c||new Function("return this")()}catch{typeof window=="object"&&(c=window)}u.exports=c},function(u,o,c){o.byteLength=function(P){var K=h(P),L=K[0],T=K[1];return 3*(L+T)/4-T},o.toByteArray=function(P){var K,L,T=h(P),R=T[0],M=T[1],J=new w(function(re,ie,B){return 3*(ie+B)/4-B}(0,R,M)),G=0,$=M>0?R-4:R;for(L=0;L<$;L+=4)K=l[P.charCodeAt(L)]<<18|l[P.charCodeAt(L+1)]<<12|l[P.charCodeAt(L+2)]<<6|l[P.charCodeAt(L+3)],J[G++]=K>>16&255,J[G++]=K>>8&255,J[G++]=255&K;return M===2&&(K=l[P.charCodeAt(L)]<<2|l[P.charCodeAt(L+1)]>>4,J[G++]=255&K),M===1&&(K=l[P.charCodeAt(L)]<<10|l[P.charCodeAt(L+1)]<<4|l[P.charCodeAt(L+2)]>>2,J[G++]=K>>8&255,J[G++]=255&K),J},o.fromByteArray=function(P){for(var K,L=P.length,T=L%3,R=[],M=16383,J=0,G=L-T;J<G;J+=M)R.push(b(P,J,J+M>G?G:J+M));return T===1?(K=P[L-1],R.push(v[K>>2]+v[K<<4&63]+"==")):T===2&&(K=(P[L-2]<<8)+P[L-1],R.push(v[K>>10]+v[K>>4&63]+v[K<<2&63]+"=")),R.join("")};for(var v=[],l=[],w=typeof Uint8Array<"u"?Uint8Array:Array,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,f=S.length;d<f;++d)v[d]=S[d],l[S.charCodeAt(d)]=d;function h(I){var P=I.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var K=I.indexOf("=");return K===-1&&(K=P),[K,K===P?0:4-K%4]}function b(I,P,K){for(var L,T,R=[],M=P;M<K;M+=3)L=(I[M]<<16&16711680)+(I[M+1]<<8&65280)+(255&I[M+2]),R.push(v[(T=L)>>18&63]+v[T>>12&63]+v[T>>6&63]+v[63&T]);return R.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(u,o){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */o.read=function(c,v,l,w,S){var d,f,h=8*S-w-1,b=(1<<h)-1,I=b>>1,P=-7,K=l?S-1:0,L=l?-1:1,T=c[v+K];for(K+=L,d=T&(1<<-P)-1,T>>=-P,P+=h;P>0;d=256*d+c[v+K],K+=L,P-=8);for(f=d&(1<<-P)-1,d>>=-P,P+=w;P>0;f=256*f+c[v+K],K+=L,P-=8);if(d===0)d=1-I;else{if(d===b)return f?NaN:1/0*(T?-1:1);f+=Math.pow(2,w),d-=I}return(T?-1:1)*f*Math.pow(2,d-w)},o.write=function(c,v,l,w,S,d){var f,h,b,I=8*d-S-1,P=(1<<I)-1,K=P>>1,L=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=w?0:d-1,R=w?1:-1,M=v<0||v===0&&1/v<0?1:0;for(v=Math.abs(v),isNaN(v)||v===1/0?(h=isNaN(v)?1:0,f=P):(f=Math.floor(Math.log(v)/Math.LN2),v*(b=Math.pow(2,-f))<1&&(f--,b*=2),(v+=f+K>=1?L/b:L*Math.pow(2,1-K))*b>=2&&(f++,b/=2),f+K>=P?(h=0,f=P):f+K>=1?(h=(v*b-1)*Math.pow(2,S),f+=K):(h=v*Math.pow(2,K-1)*Math.pow(2,S),f=0));S>=8;c[l+T]=255&h,T+=R,h/=256,S-=8);for(f=f<<S|h,I+=S;I>0;c[l+T]=255&f,T+=R,f/=256,I-=8);c[l+T-R]|=128*M}},function(u,o){var c={}.toString;u.exports=Array.isArray||function(v){return c.call(v)=="[object Array]"}},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(w){var S=w.jws,d=w.KeyUtil,f=w.X509,h=w.crypto,b=w.hextob64u,I=w.b64tohex,P=w.AllowedSigningAlgs;return function(){function K(){(function(T,R){if(!(T instanceof R))throw new TypeError("Cannot call a class as a function")})(this,K)}return K.parseJwt=function(T){v.Log.debug("JoseUtil.parseJwt");try{var R=S.JWS.parse(T);return{header:R.headerObj,payload:R.payloadObj}}catch(M){v.Log.error(M)}},K.validateJwt=function(T,R,M,J,G,$,j){v.Log.debug("JoseUtil.validateJwt");try{if(R.kty==="RSA")if(R.e&&R.n)R=d.getKey(R);else{if(!R.x5c||!R.x5c.length)return v.Log.error("JoseUtil.validateJwt: RSA key missing key material",R),Promise.reject(new Error("RSA key missing key material"));var re=I(R.x5c[0]);R=f.getPublicKeyFromCertHex(re)}else{if(R.kty!=="EC")return v.Log.error("JoseUtil.validateJwt: Unsupported key type",R&&R.kty),Promise.reject(new Error(R.kty));if(!(R.crv&&R.x&&R.y))return v.Log.error("JoseUtil.validateJwt: EC key missing key material",R),Promise.reject(new Error("EC key missing key material"));R=d.getKey(R)}return K._validateJwt(T,R,M,J,G,$,j)}catch(ie){return v.Log.error(ie&&ie.message||ie),Promise.reject("JWT validation failed")}},K.validateJwtAttributes=function(T,R,M,J,G,$){J||(J=0),G||(G=parseInt(Date.now()/1e3));var j=K.parseJwt(T).payload;if(!j.iss)return v.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(j.iss!==R)return v.Log.error("JoseUtil._validateJwt: Invalid issuer in token",j.iss),Promise.reject(new Error("Invalid issuer in token: "+j.iss));if(!j.aud)return v.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(j.aud===M||Array.isArray(j.aud)&&j.aud.indexOf(M)>=0))return v.Log.error("JoseUtil._validateJwt: Invalid audience in token",j.aud),Promise.reject(new Error("Invalid audience in token: "+j.aud));if(j.azp&&j.azp!==M)return v.Log.error("JoseUtil._validateJwt: Invalid azp in token",j.azp),Promise.reject(new Error("Invalid azp in token: "+j.azp));if(!$){var re=G+J,ie=G-J;if(!j.iat)return v.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(re<j.iat)return v.Log.error("JoseUtil._validateJwt: iat is in the future",j.iat),Promise.reject(new Error("iat is in the future: "+j.iat));if(j.nbf&&re<j.nbf)return v.Log.error("JoseUtil._validateJwt: nbf is in the future",j.nbf),Promise.reject(new Error("nbf is in the future: "+j.nbf));if(!j.exp)return v.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(j.exp<ie)return v.Log.error("JoseUtil._validateJwt: exp is in the past",j.exp),Promise.reject(new Error("exp is in the past:"+j.exp))}return Promise.resolve(j)},K._validateJwt=function(T,R,M,J,G,$,j){return K.validateJwtAttributes(T,M,J,G,$,j).then(function(re){try{return S.JWS.verify(T,R,P)?re:(v.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(ie){return v.Log.error(ie&&ie.message||ie),Promise.reject(new Error("signature validation failed"))}})},K.hashString=function(T,R){try{return h.Util.hashString(T,R)}catch(M){v.Log.error(M)}},K.hexToBase64Url=function(T){try{return b(T)}catch(R){v.Log.error(R)}},K}()};var v=c(0);u.exports=o.default},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninResponse=void 0;var v=function(){function S(d,f){for(var h=0;h<f.length;h++){var b=f[h];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,b.key,b)}}return function(d,f,h){return f&&S(d.prototype,f),h&&S(d,h),d}}(),l=c(3);function w(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")}o.SigninResponse=function(){function S(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";w(this,S);var h=l.UrlUtility.parseUrlFragment(d,f);this.error=h.error,this.error_description=h.error_description,this.error_uri=h.error_uri,this.code=h.code,this.state=h.state,this.id_token=h.id_token,this.session_state=h.session_state,this.access_token=h.access_token,this.token_type=h.token_type,this.scope=h.scope,this.profile=void 0,this.expires_in=h.expires_in}return v(S,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var h=parseInt(f);if(typeof h=="number"&&h>0){var b=parseInt(Date.now()/1e3);this.expires_at=b+h}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),S}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutRequest=void 0;var v=c(0),l=c(3),w=c(9);o.SignoutRequest=function S(d){var f=d.url,h=d.id_token_hint,b=d.post_logout_redirect_uri,I=d.data,P=d.extraQueryParams,K=d.request_type;if(function(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}(this,S),!f)throw v.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var L in h&&(f=l.UrlUtility.addQueryParam(f,"id_token_hint",h)),b&&(f=l.UrlUtility.addQueryParam(f,"post_logout_redirect_uri",b),I&&(this.state=new w.State({data:I,request_type:K}),f=l.UrlUtility.addQueryParam(f,"state",this.state.id))),P)f=l.UrlUtility.addQueryParam(f,L,P[L]);this.url=f}},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutResponse=void 0;var v=c(3);o.SignoutResponse=function l(w){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,l);var S=v.UrlUtility.parseUrlFragment(w,"?");this.error=S.error,this.error_description=S.error_description,this.error_uri=S.error_uri,this.state=S.state}},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.InMemoryWebStorage=void 0;var v=function(){function w(S,d){for(var f=0;f<d.length;f++){var h=d[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,h.key,h)}}return function(S,d,f){return d&&w(S.prototype,d),f&&w(S,f),S}}(),l=c(0);o.InMemoryWebStorage=function(){function w(){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w),this._data={}}return w.prototype.getItem=function(d){return l.Log.debug("InMemoryWebStorage.getItem",d),this._data[d]},w.prototype.setItem=function(d,f){l.Log.debug("InMemoryWebStorage.setItem",d),this._data[d]=f},w.prototype.removeItem=function(d){l.Log.debug("InMemoryWebStorage.removeItem",d),delete this._data[d]},w.prototype.key=function(d){return Object.getOwnPropertyNames(this._data)[d]},v(w,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManager=void 0;var v=function(){function M(J,G){for(var $=0;$<G.length;$++){var j=G[$];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(J,j.key,j)}}return function(J,G,$){return G&&M(J.prototype,G),$&&M(J,$),J}}(),l=c(0),w=c(10),S=c(39),d=c(15),f=c(45),h=c(47),b=c(18),I=c(8),P=c(20),K=c(11),L=c(4);function T(M,J){if(!(M instanceof J))throw new TypeError("Cannot call a class as a function")}function R(M,J){if(!M)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!J||typeof J!="object"&&typeof J!="function"?M:J}o.UserManager=function(M){function J(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h.SilentRenewService,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:b.SessionMonitor,re=arguments.length>3&&arguments[3]!==void 0?arguments[3]:P.TokenRevocationClient,ie=arguments.length>4&&arguments[4]!==void 0?arguments[4]:K.TokenClient,B=arguments.length>5&&arguments[5]!==void 0?arguments[5]:L.JoseUtil;T(this,J),G instanceof S.UserManagerSettings||(G=new S.UserManagerSettings(G));var oe=R(this,M.call(this,G));return oe._events=new f.UserManagerEvents(G),oe._silentRenewService=new $(oe),oe.settings.automaticSilentRenew&&(l.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),oe.startSilentRenew()),oe.settings.monitorSession&&(l.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),oe._sessionMonitor=new j(oe)),oe._tokenRevocationClient=new re(oe._settings),oe._tokenClient=new ie(oe._settings),oe._joseUtil=B,oe}return function($,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);$.prototype=Object.create(j&&j.prototype,{constructor:{value:$,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf($,j):$.__proto__=j)}(J,M),J.prototype.getUser=function(){var $=this;return this._loadUser().then(function(j){return j?(l.Log.info("UserManager.getUser: user loaded"),$._events.load(j,!1),j):(l.Log.info("UserManager.getUser: user not found in storage"),null)})},J.prototype.removeUser=function(){var $=this;return this.storeUser(null).then(function(){l.Log.info("UserManager.removeUser: user removed from storage"),$._events.unload()})},J.prototype.signinRedirect=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="si:r";var j={useReplaceToNavigate:$.useReplaceToNavigate};return this._signinStart($,this._redirectNavigator,j).then(function(){l.Log.info("UserManager.signinRedirect: successful")})},J.prototype.signinRedirectCallback=function($){return this._signinEnd($||this._redirectNavigator.url).then(function(j){return j.profile&&j.profile.sub?l.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",j.profile.sub):l.Log.info("UserManager.signinRedirectCallback: no sub"),j})},J.prototype.signinPopup=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="si:p";var j=$.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return j?($.redirect_uri=j,$.display="popup",this._signin($,this._popupNavigator,{startUrl:j,popupWindowFeatures:$.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:$.popupWindowTarget||this.settings.popupWindowTarget}).then(function(re){return re&&(re.profile&&re.profile.sub?l.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",re.profile.sub):l.Log.info("UserManager.signinPopup: no sub")),re})):(l.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},J.prototype.signinPopupCallback=function($){return this._signinCallback($,this._popupNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?l.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",j.profile.sub):l.Log.info("UserManager.signinPopupCallback: no sub")),j}).catch(function(j){l.Log.error(j.message)})},J.prototype.signinSilent=function(){var $=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return j=Object.assign({},j),this._loadUser().then(function(re){return re&&re.refresh_token?(j.refresh_token=re.refresh_token,$._useRefreshToken(j)):(j.request_type="si:s",j.id_token_hint=j.id_token_hint||$.settings.includeIdTokenInSilentRenew&&re&&re.id_token,re&&$._settings.validateSubOnSilentRenew&&(l.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",re.profile.sub),j.current_sub=re.profile.sub),$._signinSilentIframe(j))})},J.prototype._useRefreshToken=function(){var $=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(j).then(function(re){return re?re.access_token?$._loadUser().then(function(ie){if(ie){var B=Promise.resolve();return re.id_token&&(B=$._validateIdTokenFromTokenRefreshToken(ie.profile,re.id_token)),B.then(function(){return l.Log.debug("UserManager._useRefreshToken: refresh token response success"),ie.id_token=re.id_token||ie.id_token,ie.access_token=re.access_token,ie.refresh_token=re.refresh_token||ie.refresh_token,ie.expires_in=re.expires_in,$.storeUser(ie).then(function(){return $._events.load(ie),ie})})}return null}):(l.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(l.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},J.prototype._validateIdTokenFromTokenRefreshToken=function($,j){var re=this;return this._metadataService.getIssuer().then(function(ie){return re.settings.getEpochTime().then(function(B){return re._joseUtil.validateJwtAttributes(j,ie,re._settings.client_id,re._settings.clockSkew,B).then(function(oe){return oe?oe.sub!==$.sub?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):oe.auth_time&&oe.auth_time!==$.auth_time?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):oe.azp&&oe.azp!==$.azp?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!oe.azp&&$.azp?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},J.prototype._signinSilentIframe=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=$.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return j?($.redirect_uri=j,$.prompt=$.prompt||"none",this._signin($,this._iframeNavigator,{startUrl:j,silentRequestTimeout:$.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(re){return re&&(re.profile&&re.profile.sub?l.Log.info("UserManager.signinSilent: successful, signed in sub: ",re.profile.sub):l.Log.info("UserManager.signinSilent: no sub")),re})):(l.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},J.prototype.signinSilentCallback=function($){return this._signinCallback($,this._iframeNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?l.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",j.profile.sub):l.Log.info("UserManager.signinSilentCallback: no sub")),j})},J.prototype.signinCallback=function($){var j=this;return this.readSigninResponseState($).then(function(re){var ie=re.state;return re.response,ie.request_type==="si:r"?j.signinRedirectCallback($):ie.request_type==="si:p"?j.signinPopupCallback($):ie.request_type==="si:s"?j.signinSilentCallback($):Promise.reject(new Error("invalid response_type in state"))})},J.prototype.signoutCallback=function($,j){var re=this;return this.readSignoutResponseState($).then(function(ie){var B=ie.state,oe=ie.response;return B?B.request_type==="so:r"?re.signoutRedirectCallback($):B.request_type==="so:p"?re.signoutPopupCallback($,j):Promise.reject(new Error("invalid response_type in state")):oe})},J.prototype.querySessionStatus=function(){var $=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="si:s";var re=j.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return re?(j.redirect_uri=re,j.prompt="none",j.response_type=j.response_type||this.settings.query_status_response_type,j.scope=j.scope||"openid",j.skipUserInfo=!0,this._signinStart(j,this._iframeNavigator,{startUrl:re,silentRequestTimeout:j.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ie){return $.processSigninResponse(ie.url).then(function(B){if(l.Log.debug("UserManager.querySessionStatus: got signin response"),B.session_state&&B.profile.sub)return l.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",B.profile.sub),{session_state:B.session_state,sub:B.profile.sub,sid:B.profile.sid};l.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(B){if(B.session_state&&$.settings.monitorAnonymousSession&&(B.message=="login_required"||B.message=="consent_required"||B.message=="interaction_required"||B.message=="account_selection_required"))return l.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:B.session_state};throw B})})):(l.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},J.prototype._signin=function($,j){var re=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart($,j,ie).then(function(B){return re._signinEnd(B.url,$)})},J.prototype._signinStart=function($,j){var re=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return j.prepare(ie).then(function(B){return l.Log.debug("UserManager._signinStart: got navigator window handle"),re.createSigninRequest($).then(function(oe){return l.Log.debug("UserManager._signinStart: got signin request"),ie.url=oe.url,ie.id=oe.state.id,B.navigate(ie)}).catch(function(oe){throw B.close&&(l.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),B.close()),oe})})},J.prototype._signinEnd=function($){var j=this,re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse($).then(function(ie){l.Log.debug("UserManager._signinEnd: got signin response");var B=new d.User(ie);if(re.current_sub){if(re.current_sub!==B.profile.sub)return l.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",B.profile.sub),Promise.reject(new Error("login_required"));l.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return j.storeUser(B).then(function(){return l.Log.debug("UserManager._signinEnd: user stored"),j._events.load(B),B})})},J.prototype._signinCallback=function($,j){l.Log.debug("UserManager._signinCallback");var re=this._settings.response_mode==="query"||!this._settings.response_mode&&I.SigninRequest.isCode(this._settings.response_type)?"?":"#";return j.callback($,void 0,re)},J.prototype.signoutRedirect=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="so:r";var j=$.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;j&&($.post_logout_redirect_uri=j);var re={useReplaceToNavigate:$.useReplaceToNavigate};return this._signoutStart($,this._redirectNavigator,re).then(function(){l.Log.info("UserManager.signoutRedirect: successful")})},J.prototype.signoutRedirectCallback=function($){return this._signoutEnd($||this._redirectNavigator.url).then(function(j){return l.Log.info("UserManager.signoutRedirectCallback: successful"),j})},J.prototype.signoutPopup=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="so:p";var j=$.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return $.post_logout_redirect_uri=j,$.display="popup",$.post_logout_redirect_uri&&($.state=$.state||{}),this._signout($,this._popupNavigator,{startUrl:j,popupWindowFeatures:$.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:$.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){l.Log.info("UserManager.signoutPopup: successful")})},J.prototype.signoutPopupCallback=function($,j){return j===void 0&&typeof $=="boolean"&&(j=$,$=null),this._popupNavigator.callback($,j,"?").then(function(){l.Log.info("UserManager.signoutPopupCallback: successful")})},J.prototype._signout=function($,j){var re=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart($,j,ie).then(function(B){return re._signoutEnd(B.url)})},J.prototype._signoutStart=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=this,re=arguments[1],ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return re.prepare(ie).then(function(B){return l.Log.debug("UserManager._signoutStart: got navigator window handle"),j._loadUser().then(function(oe){return l.Log.debug("UserManager._signoutStart: loaded current user from storage"),(j._settings.revokeAccessTokenOnSignout?j._revokeInternal(oe):Promise.resolve()).then(function(){var _e=$.id_token_hint||oe&&oe.id_token;return _e&&(l.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),$.id_token_hint=_e),j.removeUser().then(function(){return l.Log.debug("UserManager._signoutStart: user removed, creating signout request"),j.createSignoutRequest($).then(function(me){return l.Log.debug("UserManager._signoutStart: got signout request"),ie.url=me.url,me.state&&(ie.id=me.state.id),B.navigate(ie)})})})}).catch(function(oe){throw B.close&&(l.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),B.close()),oe})})},J.prototype._signoutEnd=function($){return this.processSignoutResponse($).then(function(j){return l.Log.debug("UserManager._signoutEnd: got signout response"),j})},J.prototype.revokeAccessToken=function(){var $=this;return this._loadUser().then(function(j){return $._revokeInternal(j,!0).then(function(re){if(re)return l.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),j.access_token=null,j.refresh_token=null,j.expires_at=null,j.token_type=null,$.storeUser(j).then(function(){l.Log.debug("UserManager.revokeAccessToken: user stored"),$._events.load(j)})})}).then(function(){l.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},J.prototype._revokeInternal=function($,j){var re=this;if($){var ie=$.access_token,B=$.refresh_token;return this._revokeAccessTokenInternal(ie,j).then(function(oe){return re._revokeRefreshTokenInternal(B,j).then(function(_e){return oe||_e||l.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),oe||_e})})}return Promise.resolve(!1)},J.prototype._revokeAccessTokenInternal=function($,j){return!$||$.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke($,j).then(function(){return!0})},J.prototype._revokeRefreshTokenInternal=function($,j){return $?this._tokenRevocationClient.revoke($,j,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},J.prototype.startSilentRenew=function(){this._silentRenewService.start()},J.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},J.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function($){return $?(l.Log.debug("UserManager._loadUser: user storageString loaded"),d.User.fromStorageString($)):(l.Log.debug("UserManager._loadUser: no user storageString"),null)})},J.prototype.storeUser=function($){if($){l.Log.debug("UserManager.storeUser: storing user");var j=$.toStorageString();return this._userStore.set(this._userStoreKey,j)}return l.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},v(J,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),J}(w.OidcClient)},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerSettings=void 0;var v=function(){function K(L,T){for(var R=0;R<T.length;R++){var M=T[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(L,M.key,M)}}return function(L,T,R){return T&&K(L.prototype,T),R&&K(L,R),L}}(),l=(c(0),c(5)),w=c(40),S=c(41),d=c(43),f=c(6),h=c(1),b=c(8);function I(K,L){if(!(K instanceof L))throw new TypeError("Cannot call a class as a function")}function P(K,L){if(!K)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!L||typeof L!="object"&&typeof L!="function"?K:L}o.UserManagerSettings=function(K){function L(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=T.popup_redirect_uri,M=T.popup_post_logout_redirect_uri,J=T.popupWindowFeatures,G=T.popupWindowTarget,$=T.silent_redirect_uri,j=T.silentRequestTimeout,re=T.automaticSilentRenew,ie=re!==void 0&&re,B=T.validateSubOnSilentRenew,oe=B!==void 0&&B,_e=T.includeIdTokenInSilentRenew,me=_e===void 0||_e,$e=T.monitorSession,Ie=$e===void 0||$e,ze=T.monitorAnonymousSession,Le=ze!==void 0&&ze,Ge=T.checkSessionInterval,fe=Ge===void 0?2e3:Ge,ye=T.stopCheckSessionOnError,Ve=ye===void 0||ye,Ye=T.query_status_response_type,tt=T.revokeAccessTokenOnSignout,rt=tt!==void 0&&tt,ct=T.accessTokenExpiringNotificationTime,Et=ct===void 0?60:ct,Xe=T.redirectNavigator,nt=Xe===void 0?new w.RedirectNavigator:Xe,Ke=T.popupNavigator,xe=Ke===void 0?new S.PopupNavigator:Ke,V=T.iframeNavigator,p=V===void 0?new d.IFrameNavigator:V,y=T.userStore,N=y===void 0?new f.WebStorageStateStore({store:h.Global.sessionStorage}):y;I(this,L);var W=P(this,K.call(this,arguments[0]));return W._popup_redirect_uri=R,W._popup_post_logout_redirect_uri=M,W._popupWindowFeatures=J,W._popupWindowTarget=G,W._silent_redirect_uri=$,W._silentRequestTimeout=j,W._automaticSilentRenew=ie,W._validateSubOnSilentRenew=oe,W._includeIdTokenInSilentRenew=me,W._accessTokenExpiringNotificationTime=Et,W._monitorSession=Ie,W._monitorAnonymousSession=Le,W._checkSessionInterval=fe,W._stopCheckSessionOnError=Ve,Ye?W._query_status_response_type=Ye:arguments[0]&&arguments[0].response_type?W._query_status_response_type=b.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":W._query_status_response_type="id_token",W._revokeAccessTokenOnSignout=rt,W._redirectNavigator=nt,W._popupNavigator=xe,W._iframeNavigator=p,W._userStore=N,W}return function(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}(L,K),v(L,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),L}(l.OidcClientSettings)},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.RedirectNavigator=void 0;var v=function(){function w(S,d){for(var f=0;f<d.length;f++){var h=d[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,h.key,h)}}return function(S,d,f){return d&&w(S.prototype,d),f&&w(S,f),S}}(),l=c(0);o.RedirectNavigator=function(){function w(){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.prototype.prepare=function(){return Promise.resolve(this)},w.prototype.navigate=function(d){return d&&d.url?(d.useReplaceToNavigate?window.location.replace(d.url):window.location=d.url,Promise.resolve()):(l.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},v(w,[{key:"url",get:function(){return window.location.href}}]),w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupNavigator=void 0;var v=c(0),l=c(42);o.PopupNavigator=function(){function w(){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.prototype.prepare=function(d){var f=new l.PopupWindow(d);return Promise.resolve(f)},w.prototype.callback=function(d,f,h){v.Log.debug("PopupNavigator.callback");try{return l.PopupWindow.notifyOpener(d,f,h),Promise.resolve()}catch(b){return Promise.reject(b)}},w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupWindow=void 0;var v=function(){function S(d,f){for(var h=0;h<f.length;h++){var b=f[h];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,b.key,b)}}return function(d,f,h){return f&&S(d.prototype,f),h&&S(d,h),d}}(),l=c(0),w=c(3);o.PopupWindow=function(){function S(d){var f=this;(function(P,K){if(!(P instanceof K))throw new TypeError("Cannot call a class as a function")})(this,S),this._promise=new Promise(function(I,P){f._resolve=I,f._reject=P});var h=d.popupWindowTarget||"_blank",b=d.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",h,b),this._popup&&(l.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return S.prototype.navigate=function(f){return this._popup?f&&f.url?(l.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=f.id,this._id&&(window["popupCallback_"+f.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=f.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},S.prototype._success=function(f){l.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(f)},S.prototype._error=function(f){l.Log.error("PopupWindow.error: ",f),this._cleanup(),this._reject(new Error(f))},S.prototype.close=function(){this._cleanup(!1)},S.prototype._cleanup=function(f){l.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!f&&this._popup.close(),this._popup=null},S.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},S.prototype._callback=function(f,h){this._cleanup(h),f?(l.Log.debug("PopupWindow.callback success"),this._success({url:f})):(l.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},S.notifyOpener=function(f,h,b){if(window.opener){if(f=f||window.location.href){var I=w.UrlUtility.parseUrlFragment(f,b);if(I.state){var P="popupCallback_"+I.state,K=window.opener[P];K?(l.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),K(f,h)):l.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else l.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else l.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},v(S,[{key:"promise",get:function(){return this._promise}}]),S}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameNavigator=void 0;var v=c(0),l=c(44);o.IFrameNavigator=function(){function w(){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.prototype.prepare=function(d){var f=new l.IFrameWindow(d);return Promise.resolve(f)},w.prototype.callback=function(d){v.Log.debug("IFrameNavigator.callback");try{return l.IFrameWindow.notifyParent(d),Promise.resolve()}catch(f){return Promise.reject(f)}},w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameWindow=void 0;var v=function(){function w(S,d){for(var f=0;f<d.length;f++){var h=d[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,h.key,h)}}return function(S,d,f){return d&&w(S.prototype,d),f&&w(S,f),S}}(),l=c(0);o.IFrameWindow=function(){function w(S){var d=this;(function(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")})(this,w),this._promise=new Promise(function(f,h){d._resolve=f,d._reject=h}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return w.prototype.navigate=function(d){if(d&&d.url){var f=d.silentRequestTimeout||1e4;l.Log.debug("IFrameWindow.navigate: Using timeout of:",f),this._timer=window.setTimeout(this._timeout.bind(this),f),this._frame.src=d.url}else this._error("No url provided");return this.promise},w.prototype._success=function(d){this._cleanup(),l.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(d)},w.prototype._error=function(d){this._cleanup(),l.Log.error(d),this._reject(new Error(d))},w.prototype.close=function(){this._cleanup()},w.prototype._cleanup=function(){this._frame&&(l.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},w.prototype._timeout=function(){l.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},w.prototype._message=function(d){if(l.Log.debug("IFrameWindow.message"),this._timer&&d.origin===this._origin&&d.source===this._frame.contentWindow&&typeof d.data=="string"&&(d.data.startsWith("http://")||d.data.startsWith("https://"))){var f=d.data;f?this._success({url:f}):this._error("Invalid response from frame")}},w.notifyParent=function(d){l.Log.debug("IFrameWindow.notifyParent"),(d=d||window.location.href)&&(l.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(d,location.protocol+"//"+location.host))},v(w,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),w}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerEvents=void 0;var v=c(0),l=c(16),w=c(17);o.UserManagerEvents=function(S){function d(f){(function(I,P){if(!(I instanceof P))throw new TypeError("Cannot call a class as a function")})(this,d);var h=function(I,P){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!P||typeof P!="object"&&typeof P!="function"?I:P}(this,S.call(this,f));return h._userLoaded=new w.Event("User loaded"),h._userUnloaded=new w.Event("User unloaded"),h._silentRenewError=new w.Event("Silent renew error"),h._userSignedIn=new w.Event("User signed in"),h._userSignedOut=new w.Event("User signed out"),h._userSessionChanged=new w.Event("User session changed"),h}return function(h,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);h.prototype=Object.create(b&&b.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(h,b):h.__proto__=b)}(d,S),d.prototype.load=function(h){var b=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];v.Log.debug("UserManagerEvents.load"),S.prototype.load.call(this,h),b&&this._userLoaded.raise(h)},d.prototype.unload=function(){v.Log.debug("UserManagerEvents.unload"),S.prototype.unload.call(this),this._userUnloaded.raise()},d.prototype.addUserLoaded=function(h){this._userLoaded.addHandler(h)},d.prototype.removeUserLoaded=function(h){this._userLoaded.removeHandler(h)},d.prototype.addUserUnloaded=function(h){this._userUnloaded.addHandler(h)},d.prototype.removeUserUnloaded=function(h){this._userUnloaded.removeHandler(h)},d.prototype.addSilentRenewError=function(h){this._silentRenewError.addHandler(h)},d.prototype.removeSilentRenewError=function(h){this._silentRenewError.removeHandler(h)},d.prototype._raiseSilentRenewError=function(h){v.Log.debug("UserManagerEvents._raiseSilentRenewError",h.message),this._silentRenewError.raise(h)},d.prototype.addUserSignedIn=function(h){this._userSignedIn.addHandler(h)},d.prototype.removeUserSignedIn=function(h){this._userSignedIn.removeHandler(h)},d.prototype._raiseUserSignedIn=function(){v.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},d.prototype.addUserSignedOut=function(h){this._userSignedOut.addHandler(h)},d.prototype.removeUserSignedOut=function(h){this._userSignedOut.removeHandler(h)},d.prototype._raiseUserSignedOut=function(){v.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},d.prototype.addUserSessionChanged=function(h){this._userSessionChanged.addHandler(h)},d.prototype.removeUserSessionChanged=function(h){this._userSessionChanged.removeHandler(h)},d.prototype._raiseUserSessionChanged=function(){v.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},d}(l.AccessTokenEvents)},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.Timer=void 0;var v=function(){function h(b,I){for(var P=0;P<I.length;P++){var K=I[P];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(b,K.key,K)}}return function(b,I,P){return I&&h(b.prototype,I),P&&h(b,P),b}}(),l=c(0),w=c(1),S=c(17);function d(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")}function f(h,b){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||typeof b!="object"&&typeof b!="function"?h:b}o.Timer=function(h){function b(I){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.Global.timer,K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;d(this,b);var L=f(this,h.call(this,I));return L._timer=P,L._nowFunc=K||function(){return Date.now()/1e3},L}return function(P,K){if(typeof K!="function"&&K!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof K);P.prototype=Object.create(K&&K.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),K&&(Object.setPrototypeOf?Object.setPrototypeOf(P,K):P.__proto__=K)}(b,h),b.prototype.init=function(P){P<=0&&(P=1),P=parseInt(P);var K=this.now+P;if(this.expiration===K&&this._timerHandle)l.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),l.Log.debug("Timer.init timer "+this._name+" for duration:",P),this._expiration=K;var L=5;P<L&&(L=P),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*L)}},b.prototype.cancel=function(){this._timerHandle&&(l.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},b.prototype._callback=function(){var P=this._expiration-this.now;l.Log.debug("Timer.callback; "+this._name+" timer expires in:",P),this._expiration<=this.now&&(this.cancel(),h.prototype.raise.call(this))},v(b,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),b}(S.Event)},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SilentRenewService=void 0;var v=c(0);o.SilentRenewService=function(){function l(w){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,l),this._userManager=w}return l.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(S){}).catch(function(S){v.Log.error("SilentRenewService.start: Error from getUser:",S.message)}))},l.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},l.prototype._tokenExpiring=function(){var S=this;this._userManager.signinSilent().then(function(d){v.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(d){v.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",d.message),S._userManager.events._raiseSilentRenewError(d)})},l}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupNavigator=void 0;var v=c(21);o.CordovaPopupNavigator=function(){function l(){(function(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(S){var d=new v.CordovaPopupWindow(S);return Promise.resolve(d)},l}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaIFrameNavigator=void 0;var v=c(21);o.CordovaIFrameNavigator=function(){function l(){(function(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(S){S.popupWindowFeatures="hidden=yes";var d=new v.CordovaPopupWindow(S);return Promise.resolve(d)},l}()},function(u,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.Version="1.11.6"}])})})(Xn);var Lr=Xn.exports;const Rt=crypto,Vr=s=>s instanceof CryptoKey,bt=new TextEncoder,Kt=new TextDecoder;function Qn(...s){const n=s.reduce((c,{length:v})=>c+v,0),u=new Uint8Array(n);let o=0;for(const c of s)u.set(c,o),o+=c.length;return u}const Vo=s=>{let n=s;typeof n=="string"&&(n=bt.encode(n));const u=32768,o=[];for(let c=0;c<n.length;c+=u)o.push(String.fromCharCode.apply(null,n.subarray(c,c+u)));return btoa(o.join(""))},pr=s=>Vo(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Jo=s=>{const n=atob(s),u=new Uint8Array(n.length);for(let o=0;o<n.length;o++)u[o]=n.charCodeAt(o);return u},yr=s=>{let n=s;n instanceof Uint8Array&&(n=Kt.decode(n)),n=n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Jo(n)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class ut extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(n){var u;super(n),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(u=Error.captureStackTrace)==null||u.call(Error,this,this.constructor)}}class St extends ut{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(n,u="unspecified",o="unspecified"){super(n),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=u,this.reason=o}}class mn extends ut{static get code(){return"ERR_JWT_EXPIRED"}constructor(n,u="unspecified",o="unspecified"){super(n),this.code="ERR_JWT_EXPIRED",this.claim=u,this.reason=o}}class Wo extends ut{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class at extends ut{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Ce extends ut{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Jr extends ut{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class Zn extends ut{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class ei extends ut{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class qo extends ut{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class $o extends ut{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class zo extends ut{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}Rt.getRandomValues.bind(Rt);function Tt(s,n="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${n} must be ${s}`)}function hr(s,n){return s.name===n}function Rr(s){return parseInt(s.name.slice(4),10)}function Go(s){switch(s){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Yo(s,n){if(n.length&&!n.some(u=>s.usages.includes(u))){let u="CryptoKey does not support this operation, its usages must include ";if(n.length>2){const o=n.pop();u+=`one of ${n.join(", ")}, or ${o}.`}else n.length===2?u+=`one of ${n[0]} or ${n[1]}.`:u+=`${n[0]}.`;throw new TypeError(u)}}function Xo(s,n,...u){switch(n){case"HS256":case"HS384":case"HS512":{if(!hr(s.algorithm,"HMAC"))throw Tt("HMAC");const o=parseInt(n.slice(2),10);if(Rr(s.algorithm.hash)!==o)throw Tt(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!hr(s.algorithm,"RSASSA-PKCS1-v1_5"))throw Tt("RSASSA-PKCS1-v1_5");const o=parseInt(n.slice(2),10);if(Rr(s.algorithm.hash)!==o)throw Tt(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!hr(s.algorithm,"RSA-PSS"))throw Tt("RSA-PSS");const o=parseInt(n.slice(2),10);if(Rr(s.algorithm.hash)!==o)throw Tt(`SHA-${o}`,"algorithm.hash");break}case"EdDSA":{if(s.algorithm.name!=="Ed25519"&&s.algorithm.name!=="Ed448")throw Tt("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!hr(s.algorithm,"ECDSA"))throw Tt("ECDSA");const o=Go(n);if(s.algorithm.namedCurve!==o)throw Tt(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Yo(s,u)}function ti(s,n,...u){var o;if(u.length>2){const c=u.pop();s+=`one of type ${u.join(", ")}, or ${c}.`}else u.length===2?s+=`one of type ${u[0]} or ${u[1]}.`:s+=`of type ${u[0]}.`;return n==null?s+=` Received ${n}`:typeof n=="function"&&n.name?s+=` Received function ${n.name}`:typeof n=="object"&&n!=null&&(o=n.constructor)!=null&&o.name&&(s+=` Received an instance of ${n.constructor.name}`),s}const Nr=(s,...n)=>ti("Key must be ",s,...n);function ri(s,n,...u){return ti(`Key for the ${s} algorithm must be `,n,...u)}const ni=s=>Vr(s),vt=["CryptoKey"],ii=(...s)=>{const n=s.filter(Boolean);if(n.length===0||n.length===1)return!0;let u;for(const o of n){const c=Object.keys(o);if(!u||u.size===0){u=new Set(c);continue}for(const v of c){if(u.has(v))return!1;u.add(v)}}return!0};function Qo(s){return typeof s=="object"&&s!==null}function Vt(s){if(!Qo(s)||Object.prototype.toString.call(s)!=="[object Object]")return!1;if(Object.getPrototypeOf(s)===null)return!0;let n=s;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(s)===n}const oi=(s,n)=>{if(s.startsWith("RS")||s.startsWith("PS")){const{modulusLength:u}=n.algorithm;if(typeof u!="number"||u<2048)throw new TypeError(`${s} requires key modulusLength to be 2048 bits or larger`)}};function Zo(s){let n,u;switch(s.kty){case"RSA":{switch(s.alg){case"PS256":case"PS384":case"PS512":n={name:"RSA-PSS",hash:`SHA-${s.alg.slice(-3)}`},u=s.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":n={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.alg.slice(-3)}`},u=s.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":n={name:"RSA-OAEP",hash:`SHA-${parseInt(s.alg.slice(-3),10)||1}`},u=s.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(s.alg){case"ES256":n={name:"ECDSA",namedCurve:"P-256"},u=s.d?["sign"]:["verify"];break;case"ES384":n={name:"ECDSA",namedCurve:"P-384"},u=s.d?["sign"]:["verify"];break;case"ES512":n={name:"ECDSA",namedCurve:"P-521"},u=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":n={name:"ECDH",namedCurve:s.crv},u=s.d?["deriveBits"]:[];break;default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(s.alg){case"EdDSA":n={name:s.crv},u=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":n={name:s.crv},u=s.d?["deriveBits"]:[];break;default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new at('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:n,keyUsages:u}}const es=async s=>{if(!s.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:n,keyUsages:u}=Zo(s),o=[n,s.ext??!1,s.key_ops??u],c={...s};return delete c.alg,delete c.use,Rt.subtle.importKey("jwk",c,...o)};async function ts(s,n){if(!Vt(s))throw new TypeError("JWK must be an object");switch(n||(n=s.alg),s.kty){case"oct":if(typeof s.k!="string"||!s.k)throw new TypeError('missing "k" (Key Value) Parameter value');return yr(s.k);case"RSA":if(s.oth!==void 0)throw new at('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return es({...s,alg:n});default:throw new at('Unsupported "kty" (Key Type) Parameter value')}}const rs=(s,n)=>{if(!(n instanceof Uint8Array)){if(!ni(n))throw new TypeError(ri(s,n,...vt,"Uint8Array"));if(n.type!=="secret")throw new TypeError(`${vt.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},ns=(s,n,u)=>{if(!ni(n))throw new TypeError(ri(s,n,...vt));if(n.type==="secret")throw new TypeError(`${vt.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(u==="sign"&&n.type==="public")throw new TypeError(`${vt.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(u==="decrypt"&&n.type==="public")throw new TypeError(`${vt.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(n.algorithm&&u==="verify"&&n.type==="private")throw new TypeError(`${vt.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(n.algorithm&&u==="encrypt"&&n.type==="private")throw new TypeError(`${vt.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},si=(s,n,u)=>{s.startsWith("HS")||s==="dir"||s.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(s)?rs(s,n):ns(s,n,u)};function ai(s,n,u,o,c){if(c.crit!==void 0&&(o==null?void 0:o.crit)===void 0)throw new s('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(l=>typeof l!="string"||l.length===0))throw new s('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let v;u!==void 0?v=new Map([...Object.entries(u),...n.entries()]):v=n;for(const l of o.crit){if(!v.has(l))throw new at(`Extension Header Parameter "${l}" is not recognized`);if(c[l]===void 0)throw new s(`Extension Header Parameter "${l}" is missing`);if(v.get(l)&&o[l]===void 0)throw new s(`Extension Header Parameter "${l}" MUST be integrity protected`)}return new Set(o.crit)}const is=(s,n)=>{if(n!==void 0&&(!Array.isArray(n)||n.some(u=>typeof u!="string")))throw new TypeError(`"${s}" option must be an array of strings`);if(n)return new Set(n)},os=async s=>{if(s instanceof Uint8Array)return{kty:"oct",k:pr(s)};if(!Vr(s))throw new TypeError(Nr(s,...vt,"Uint8Array"));if(!s.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:n,key_ops:u,alg:o,use:c,...v}=await Rt.subtle.exportKey("jwk",s);return v},ss=os;async function as(s){return ss(s)}function ui(s,n){const u=`SHA-${s.slice(-3)}`;switch(s){case"HS256":case"HS384":case"HS512":return{hash:u,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:u,name:"RSA-PSS",saltLength:s.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:u,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:u,name:"ECDSA",namedCurve:n.namedCurve};case"EdDSA":return{name:n.name};default:throw new at(`alg ${s} is not supported either by JOSE or your javascript runtime`)}}function ci(s,n,u){if(Vr(n))return Xo(n,s,u),n;if(n instanceof Uint8Array){if(!s.startsWith("HS"))throw new TypeError(Nr(n,...vt));return Rt.subtle.importKey("raw",n,{hash:`SHA-${s.slice(-3)}`,name:"HMAC"},!1,[u])}throw new TypeError(Nr(n,...vt,"Uint8Array"))}const us=async(s,n,u,o)=>{const c=await ci(s,n,"verify");oi(s,c);const v=ui(s,c.algorithm);try{return await Rt.subtle.verify(v,c,u,o)}catch{return!1}};async function cs(s,n,u){if(!Vt(s))throw new Ce("Flattened JWS must be an object");if(s.protected===void 0&&s.header===void 0)throw new Ce('Flattened JWS must have either of the "protected" or "header" members');if(s.protected!==void 0&&typeof s.protected!="string")throw new Ce("JWS Protected Header incorrect type");if(s.payload===void 0)throw new Ce("JWS Payload missing");if(typeof s.signature!="string")throw new Ce("JWS Signature missing or incorrect type");if(s.header!==void 0&&!Vt(s.header))throw new Ce("JWS Unprotected Header incorrect type");let o={};if(s.protected)try{const K=yr(s.protected);o=JSON.parse(Kt.decode(K))}catch{throw new Ce("JWS Protected Header is invalid")}if(!ii(o,s.header))throw new Ce("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const c={...o,...s.header},v=ai(Ce,new Map([["b64",!0]]),u==null?void 0:u.crit,o,c);let l=!0;if(v.has("b64")&&(l=o.b64,typeof l!="boolean"))throw new Ce('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:w}=c;if(typeof w!="string"||!w)throw new Ce('JWS "alg" (Algorithm) Header Parameter missing or invalid');const S=u&&is("algorithms",u.algorithms);if(S&&!S.has(w))throw new Wo('"alg" (Algorithm) Header Parameter value not allowed');if(l){if(typeof s.payload!="string")throw new Ce("JWS Payload must be a string")}else if(typeof s.payload!="string"&&!(s.payload instanceof Uint8Array))throw new Ce("JWS Payload must be a string or an Uint8Array instance");let d=!1;typeof n=="function"&&(n=await n(o,s),d=!0),si(w,n,"verify");const f=Qn(bt.encode(s.protected??""),bt.encode("."),typeof s.payload=="string"?bt.encode(s.payload):s.payload);let h;try{h=yr(s.signature)}catch{throw new Ce("Failed to base64url decode the signature")}if(!await us(w,n,h,f))throw new zo;let I;if(l)try{I=yr(s.payload)}catch{throw new Ce("Failed to base64url decode the payload")}else typeof s.payload=="string"?I=bt.encode(s.payload):I=s.payload;const P={payload:I};return s.protected!==void 0&&(P.protectedHeader=o),s.header!==void 0&&(P.unprotectedHeader=s.header),d?{...P,key:n}:P}async function hs(s,n,u){if(s instanceof Uint8Array&&(s=Kt.decode(s)),typeof s!="string")throw new Ce("Compact JWS must be a string or Uint8Array");const{0:o,1:c,2:v,length:l}=s.split(".");if(l!==3)throw new Ce("Invalid Compact JWS");const w=await cs({payload:c,protected:o,signature:v},n,u),S={payload:w.payload,protectedHeader:w.protectedHeader};return typeof n=="function"?{...S,key:w.key}:S}const kt=s=>Math.floor(s.getTime()/1e3),hi=60,li=hi*60,Wr=li*24,ls=Wr*7,ds=Wr*365.25,fs=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Zt=s=>{const n=fs.exec(s);if(!n||n[4]&&n[1])throw new TypeError("Invalid time period format");const u=parseFloat(n[2]),o=n[3].toLowerCase();let c;switch(o){case"sec":case"secs":case"second":case"seconds":case"s":c=Math.round(u);break;case"minute":case"minutes":case"min":case"mins":case"m":c=Math.round(u*hi);break;case"hour":case"hours":case"hr":case"hrs":case"h":c=Math.round(u*li);break;case"day":case"days":case"d":c=Math.round(u*Wr);break;case"week":case"weeks":case"w":c=Math.round(u*ls);break;default:c=Math.round(u*ds);break}return n[1]==="-"||n[4]==="ago"?-c:c},_n=s=>s.toLowerCase().replace(/^application\//,""),gs=(s,n)=>typeof s=="string"?n.includes(s):Array.isArray(s)?n.some(Set.prototype.has.bind(new Set(s))):!1,ps=(s,n,u={})=>{const{typ:o}=u;if(o&&(typeof s.typ!="string"||_n(s.typ)!==_n(o)))throw new St('unexpected "typ" JWT header value',"typ","check_failed");let c;try{c=JSON.parse(Kt.decode(n))}catch{}if(!Vt(c))throw new Jr("JWT Claims Set must be a top-level JSON object");const{requiredClaims:v=[],issuer:l,subject:w,audience:S,maxTokenAge:d}=u,f=[...v];d!==void 0&&f.push("iat"),S!==void 0&&f.push("aud"),w!==void 0&&f.push("sub"),l!==void 0&&f.push("iss");for(const P of new Set(f.reverse()))if(!(P in c))throw new St(`missing required "${P}" claim`,P,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(c.iss))throw new St('unexpected "iss" claim value',"iss","check_failed");if(w&&c.sub!==w)throw new St('unexpected "sub" claim value',"sub","check_failed");if(S&&!gs(c.aud,typeof S=="string"?[S]:S))throw new St('unexpected "aud" claim value',"aud","check_failed");let h;switch(typeof u.clockTolerance){case"string":h=Zt(u.clockTolerance);break;case"number":h=u.clockTolerance;break;case"undefined":h=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:b}=u,I=kt(b||new Date);if((c.iat!==void 0||d)&&typeof c.iat!="number")throw new St('"iat" claim must be a number',"iat","invalid");if(c.nbf!==void 0){if(typeof c.nbf!="number")throw new St('"nbf" claim must be a number',"nbf","invalid");if(c.nbf>I+h)throw new St('"nbf" claim timestamp check failed',"nbf","check_failed")}if(c.exp!==void 0){if(typeof c.exp!="number")throw new St('"exp" claim must be a number',"exp","invalid");if(c.exp<=I-h)throw new mn('"exp" claim timestamp check failed',"exp","check_failed")}if(d){const P=I-c.iat,K=typeof d=="number"?d:Zt(d);if(P-h>K)throw new mn('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(P<0-h)throw new St('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return c};async function ys(s,n,u){var l;const o=await hs(s,n,u);if((l=o.protectedHeader.crit)!=null&&l.includes("b64")&&o.protectedHeader.b64===!1)throw new Jr("JWTs MUST NOT use unencoded payload");const v={payload:ps(o.protectedHeader,o.payload,u),protectedHeader:o.protectedHeader};return typeof n=="function"?{...v,key:o.key}:v}const vs=async(s,n,u)=>{const o=await ci(s,n,"sign");oi(s,o);const c=await Rt.subtle.sign(ui(s,o.algorithm),o,u);return new Uint8Array(c)};class ms{constructor(n){if(!(n instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=n}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}async sign(n,u){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Ce("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ii(this._protectedHeader,this._unprotectedHeader))throw new Ce("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader},c=ai(Ce,new Map([["b64",!0]]),u==null?void 0:u.crit,this._protectedHeader,o);let v=!0;if(c.has("b64")&&(v=this._protectedHeader.b64,typeof v!="boolean"))throw new Ce('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:l}=o;if(typeof l!="string"||!l)throw new Ce('JWS "alg" (Algorithm) Header Parameter missing or invalid');si(l,n,"sign");let w=this._payload;v&&(w=bt.encode(pr(w)));let S;this._protectedHeader?S=bt.encode(pr(JSON.stringify(this._protectedHeader))):S=bt.encode("");const d=Qn(S,bt.encode("."),w),f=await vs(l,n,d),h={signature:pr(f),payload:""};return v&&(h.payload=Kt.decode(w)),this._unprotectedHeader&&(h.header=this._unprotectedHeader),this._protectedHeader&&(h.protected=Kt.decode(S)),h}}class _s{constructor(n){this._flattened=new ms(n)}setProtectedHeader(n){return this._flattened.setProtectedHeader(n),this}async sign(n,u){const o=await this._flattened.sign(n,u);if(o.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}}function Nt(s,n){if(!Number.isFinite(n))throw new TypeError(`Invalid ${s} input`);return n}class Ss{constructor(n={}){if(!Vt(n))throw new TypeError("JWT Claims Set MUST be an object");this._payload=n}setIssuer(n){return this._payload={...this._payload,iss:n},this}setSubject(n){return this._payload={...this._payload,sub:n},this}setAudience(n){return this._payload={...this._payload,aud:n},this}setJti(n){return this._payload={...this._payload,jti:n},this}setNotBefore(n){return typeof n=="number"?this._payload={...this._payload,nbf:Nt("setNotBefore",n)}:n instanceof Date?this._payload={...this._payload,nbf:Nt("setNotBefore",kt(n))}:this._payload={...this._payload,nbf:kt(new Date)+Zt(n)},this}setExpirationTime(n){return typeof n=="number"?this._payload={...this._payload,exp:Nt("setExpirationTime",n)}:n instanceof Date?this._payload={...this._payload,exp:Nt("setExpirationTime",kt(n))}:this._payload={...this._payload,exp:kt(new Date)+Zt(n)},this}setIssuedAt(n){return typeof n>"u"?this._payload={...this._payload,iat:kt(new Date)}:n instanceof Date?this._payload={...this._payload,iat:Nt("setIssuedAt",kt(n))}:typeof n=="string"?this._payload={...this._payload,iat:Nt("setIssuedAt",kt(new Date)+Zt(n))}:this._payload={...this._payload,iat:Nt("setIssuedAt",n)},this}}class ws extends Ss{setProtectedHeader(n){return this._protectedHeader=n,this}async sign(n,u){var c;const o=new _s(bt.encode(JSON.stringify(this._payload)));if(o.setProtectedHeader(this._protectedHeader),Array.isArray((c=this._protectedHeader)==null?void 0:c.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Jr("JWTs MUST NOT use unencoded payload");return o.sign(n,u)}}function bs(s){switch(typeof s=="string"&&s.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new at('Unsupported "alg" value for a JSON Web Key Set')}}function Es(s){return s&&typeof s=="object"&&Array.isArray(s.keys)&&s.keys.every(Fs)}function Fs(s){return Vt(s)}function As(s){return typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}class xs{constructor(n){if(this._cached=new WeakMap,!Es(n))throw new Zn("JSON Web Key Set malformed");this._jwks=As(n)}async getKey(n,u){const{alg:o,kid:c}={...n,...u==null?void 0:u.header},v=bs(o),l=this._jwks.keys.filter(d=>{let f=v===d.kty;if(f&&typeof c=="string"&&(f=c===d.kid),f&&typeof d.alg=="string"&&(f=o===d.alg),f&&typeof d.use=="string"&&(f=d.use==="sig"),f&&Array.isArray(d.key_ops)&&(f=d.key_ops.includes("verify")),f&&o==="EdDSA"&&(f=d.crv==="Ed25519"||d.crv==="Ed448"),f)switch(o){case"ES256":f=d.crv==="P-256";break;case"ES256K":f=d.crv==="secp256k1";break;case"ES384":f=d.crv==="P-384";break;case"ES512":f=d.crv==="P-521";break}return f}),{0:w,length:S}=l;if(S===0)throw new ei;if(S!==1){const d=new qo,{_cached:f}=this;throw d[Symbol.asyncIterator]=async function*(){for(const h of l)try{yield await Sn(f,h,o)}catch{}},d}return Sn(this._cached,w,o)}}async function Sn(s,n,u){const o=s.get(n)||s.set(n,{}).get(n);if(o[u]===void 0){const c=await ts({...n,ext:!0},u);if(c instanceof Uint8Array||c.type!=="public")throw new Zn("JSON Web Key Set members must be public keys");o[u]=c}return o[u]}function Ps(s){const n=new xs(s);return async(u,o)=>n.getKey(u,o)}const Ts=async(s,n,u)=>{let o,c,v=!1;typeof AbortController=="function"&&(o=new AbortController,c=setTimeout(()=>{v=!0,o.abort()},n));const l=await fetch(s.href,{signal:o?o.signal:void 0,redirect:"manual",headers:u.headers}).catch(w=>{throw v?new $o:w});if(c!==void 0&&clearTimeout(c),l.status!==200)throw new ut("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await l.json()}catch{throw new ut("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function ks(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Or;var fr,Pn;(typeof navigator>"u"||!((Pn=(fr=navigator.userAgent)==null?void 0:fr.startsWith)!=null&&Pn.call(fr,"Mozilla/5.0 ")))&&(Or="jose/v5.2.4");class Rs{constructor(n,u){if(!(n instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(n.href),this._options={agent:u==null?void 0:u.agent,headers:u==null?void 0:u.headers},this._timeoutDuration=typeof(u==null?void 0:u.timeoutDuration)=="number"?u==null?void 0:u.timeoutDuration:5e3,this._cooldownDuration=typeof(u==null?void 0:u.cooldownDuration)=="number"?u==null?void 0:u.cooldownDuration:3e4,this._cacheMaxAge=typeof(u==null?void 0:u.cacheMaxAge)=="number"?u==null?void 0:u.cacheMaxAge:6e5}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(n,u){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(n,u)}catch(o){if(o instanceof ei&&this.coolingDown()===!1)return await this.reload(),this._local(n,u);throw o}}async reload(){this._pendingFetch&&ks()&&(this._pendingFetch=void 0);const n=new Headers(this._options.headers);Or&&!n.has("User-Agent")&&(n.set("User-Agent",Or),this._options.headers=Object.fromEntries(n.entries())),this._pendingFetch||(this._pendingFetch=Ts(this._url,this._timeoutDuration,this._options).then(u=>{this._local=Ps(u),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(u=>{throw this._pendingFetch=void 0,u})),await this._pendingFetch}}function Cs(s,n){const u=new Rs(s,n);return async(o,c)=>u.getKey(o,c)}function Cr(s){const n=(s==null?void 0:s.modulusLength)??2048;if(typeof n!="number"||n<2048)throw new at("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return n}async function Is(s,n){let u,o;switch(s){case"PS256":case"PS384":case"PS512":u={name:"RSA-PSS",hash:`SHA-${s.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Cr(n)},o=["sign","verify"];break;case"RS256":case"RS384":case"RS512":u={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Cr(n)},o=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":u={name:"RSA-OAEP",hash:`SHA-${parseInt(s.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Cr(n)},o=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":u={name:"ECDSA",namedCurve:"P-256"},o=["sign","verify"];break;case"ES384":u={name:"ECDSA",namedCurve:"P-384"},o=["sign","verify"];break;case"ES512":u={name:"ECDSA",namedCurve:"P-521"},o=["sign","verify"];break;case"EdDSA":{o=["sign","verify"];const c=(n==null?void 0:n.crv)??"Ed25519";switch(c){case"Ed25519":case"Ed448":u={name:c};break;default:throw new at("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{o=["deriveKey","deriveBits"];const c=(n==null?void 0:n.crv)??"P-256";switch(c){case"P-256":case"P-384":case"P-521":{u={name:"ECDH",namedCurve:c};break}case"X25519":case"X448":u={name:c};break;default:throw new at("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return Rt.subtle.generateKey(u,(n==null?void 0:n.extractable)??!1,o)}async function Us(s,n){return Is(s,n)}let lr;const Ds=new Uint8Array(16);function Ls(){if(!lr&&(lr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!lr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return lr(Ds)}const qe=[];for(let s=0;s<256;++s)qe.push((s+256).toString(16).slice(1));function Ns(s,n=0){return qe[s[n+0]]+qe[s[n+1]]+qe[s[n+2]]+qe[s[n+3]]+"-"+qe[s[n+4]]+qe[s[n+5]]+"-"+qe[s[n+6]]+qe[s[n+7]]+"-"+qe[s[n+8]]+qe[s[n+9]]+"-"+qe[s[n+10]]+qe[s[n+11]]+qe[s[n+12]]+qe[s[n+13]]+qe[s[n+14]]+qe[s[n+15]]}const Os=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wn={randomUUID:Os};function Hs(s,n,u){if(wn.randomUUID&&!n&&!s)return wn.randomUUID();s=s||{};const o=s.random||(s.rng||Ls)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,n){u=u||0;for(let c=0;c<16;++c)n[u+c]=o[c];return n}return Ns(o)}const vr=["ES256","RS256"],Ms="openid",Bs="offline_access",js="webid",Ks=[Ms,Bs,js].join(" ");async function di(s,n,u,o){let c;try{const{payload:v}=await ys(s,Cs(new URL(n)),{issuer:u,audience:o});c=v}catch(v){throw new Error(`Token verification failed: ${v.stack}`)}if(typeof c.webid=="string")return c.webid;if(typeof c.sub!="string")throw new Error(`The token ${JSON.stringify(c)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(c.sub),c.sub}catch(v){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${c.sub}] is invalid as a URL - error [${v}].`)}}function Vs(s){const n=new URL(s);return n.searchParams.delete("state"),n.searchParams.delete("code"),n.searchParams.delete("error"),n.searchParams.delete("error_description"),n.searchParams.delete("iss"),n}function Js(s,n){var u;return(u=n.find(o=>s.includes(o)))!==null&&u!==void 0?u:null}class dr extends Error{constructor(n){super(`Invalid response from OIDC provider: missing fields ${n}`),this.missingFields=n}}class Ws extends Error{constructor(n,u,o){super(n),this.error=u,this.errorDescription=o}}function qs(s){const n=new URL(s);return new URL(n.pathname,n.origin).toString()}async function fi(s,n,u){return new ws({htu:qs(s),htm:n.toUpperCase(),jti:Hs()}).setProtectedHeader({alg:vr[0],jwk:u.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(u.privateKey,{})}async function $s(){const{privateKey:s,publicKey:n}=await Us(vr[0]),u={privateKey:s,publicKey:await as(n)};return[u.publicKey.alg]=vr,u}function zs(s,n){var u,o,c,v;throw s.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(u=n.redirectUrl)===null||u===void 0?void 0:u.toString()}] is invalid - ${(o=s.error_description)!==null&&o!==void 0?o:""}`):s.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(n)} is invalid - ${(c=s.error_description)!==null&&c!==void 0?c:""}`):new Error(`Dynamic client registration failed: ${s.error} - ${(v=s.error_description)!==null&&v!==void 0?v:""}`)}function Gs(s,n){if(s.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(s)}`);if(n.redirectUrl&&(s.redirect_uris===void 0||s.redirect_uris[0]!==n.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(s.redirect_uris)} don't match the provided ${JSON.stringify([n.redirectUrl.toString()])}`)}async function Ys(s,n){var u;if(!n.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(n.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const o=Js(n.idTokenSigningAlgValuesSupported,vr),c={client_name:s.clientName,application_type:"web",redirect_uris:[(u=s.redirectUrl)===null||u===void 0?void 0:u.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:o,grant_types:["authorization_code","refresh_token"]},v={"Content-Type":"application/json"},l=await fetch(n.registrationEndpoint.toString(),{method:"POST",headers:v,body:JSON.stringify(c)});if(l.ok){const w=await l.json();return Gs(w,s),{clientId:w.client_id,clientSecret:w.client_secret,idTokenSignedResponseAlg:w.id_token_signed_response_alg,clientType:"dynamic"}}throw l.status===400&&zs(await l.json(),s),new Error(`Dynamic client registration failed: the server returned ${l.status} ${l.statusText} - ${await l.text()}`)}function Xs(s){return s.error!==void 0&&typeof s.error=="string"}function bn(s){return s.error_description!==void 0&&typeof s.error_description=="string"}function Qs(s){return s.error_uri!==void 0&&typeof s.error_uri=="string"}function Zs(s){return s.access_token!==void 0&&typeof s.access_token=="string"}function ea(s){return s.id_token!==void 0&&typeof s.id_token=="string"}function ta(s){return s.refresh_token!==void 0&&typeof s.refresh_token=="string"}function ra(s){return s.token_type!==void 0&&typeof s.token_type=="string"}function na(s){return s.expires_in===void 0||typeof s.expires_in=="number"}function ia(s,n){if(n.grantType&&(!s.grantTypesSupported||!s.grantTypesSupported.includes(n.grantType)))throw new Error(`The issuer [${s.issuer}] does not support the [${n.grantType}] grant`);if(!s.tokenEndpoint)throw new Error(`This issuer [${s.issuer}] does not have a token endpoint`)}function gi(s,n){if(Xs(s))throw new Ws(`Token endpoint returned error [${s.error}]${bn(s)?`: ${s.error_description}`:""}${Qs(s)?` (see ${s.error_uri})`:""}`,s.error,bn(s)?s.error_description:void 0);if(!Zs(s))throw new dr(["access_token"]);if(!ea(s))throw new dr(["id_token"]);if(!ra(s))throw new dr(["token_type"]);if(!na(s))throw new dr(["expires_in"]);if(!n&&s.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${s.token_type}].`);return s}async function oa(s,n,u,o){ia(s,u);const c={"content-type":"application/x-www-form-urlencoded"};let v;o&&(v=await $s(),c.DPoP=await fi(s.tokenEndpoint,"POST",v)),n.clientSecret&&(c.Authorization=`Basic ${btoa(`${n.clientId}:${n.clientSecret}`)}`);const l={grant_type:u.grantType,redirect_uri:u.redirectUrl,code:u.code,code_verifier:u.codeVerifier,client_id:n.clientId},w={method:"POST",headers:c,body:new URLSearchParams(l).toString()},d=await(await fetch(s.tokenEndpoint,w)).json(),f=gi(d,o),h=await di(f.id_token,s.jwksUri,s.issuer,n.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:ta(f)?f.refresh_token:void 0,webId:h,dpopKey:v,expiresIn:f.expires_in}}const sa=s=>{try{return new URL(s),!0}catch{return!1}};async function aa(s,n,u,o){if(u.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const c={grant_type:"refresh_token",refresh_token:s,scope:Ks};let v={};o!==void 0&&(v={DPoP:await fi(n.tokenEndpoint,"POST",o)});let l={};u.clientSecret!==void 0?l={Authorization:`Basic ${btoa(`${u.clientId}:${u.clientSecret}`)}`}:sa(u.clientId)&&(c.client_id=u.clientId);const w=await fetch(n.tokenEndpoint,{method:"POST",body:new URLSearchParams(c).toString(),headers:{...v,...l,"Content-Type":"application/x-www-form-urlencoded"}});let S;try{S=await w.json()}catch{throw new Error(`The token endpoint of issuer ${n.issuer} returned a malformed response.`)}const d=gi(S,o!==void 0),f=await di(d.id_token,n.jwksUri,n.issuer,u.clientId);return{accessToken:d.access_token,idToken:d.id_token,refreshToken:typeof d.refresh_token=="string"?d.refresh_token:void 0,webId:f,dpopKey:o,expiresIn:d.expires_in}}function ua(s){const n=Vs(s);return n.hash="",s.includes(`${n.origin}/`)?n.href:`${n.origin}${n.href.substring(n.origin.length+1)}`}async function ca(){await new Lr.OidcClient({response_mode:"query"}).clearStaleState(new Lr.WebStorageStateStore({}));const n=window.localStorage,u=[];for(let o=0;o<=n.length;o+=1){const c=n.key(o);c&&(c.match(/^oidc\..+$/)||c.match(/^solidClientAuthenticationUser:.+$/))&&u.push(c)}u.forEach(o=>n.removeItem(o))}class ha extends Fo{constructor(n,u){super(n,u)}}class la extends Eo{constructor(){super(...arguments),this.login=async(n,u)=>{var o,c;await this.sessionInfoManager.clear(n.sessionId);const v=(o=n.redirectUrl)!==null&&o!==void 0?o:ua(window.location.href);if(!On(v))throw new Error(`${v} is not a valid redirect URL, it is either a malformed IRI, includes a hash fragment, or reserved query parameters ('code' or 'state').`);await this.loginHandler.handle({...n,redirectUrl:v,clientName:(c=n.clientName)!==null&&c!==void 0?c:n.clientId,eventEmitter:u})},this.validateCurrentSession=async n=>{const u=await this.sessionInfoManager.get(n);return u===void 0||u.clientAppId===void 0||u.issuer===void 0?null:u},this.handleIncomingRedirect=async(n,u)=>{try{const o=await this.redirectHandler.handle(n,u);return this.fetch=o.fetch.bind(window),this.boundLogout=o.getLogoutUrl,await this.cleanUrlAfterRedirect(n),{isLoggedIn:o.isLoggedIn,webId:o.webId,sessionId:o.sessionId,expirationDate:o.expirationDate}}catch(o){await this.cleanUrlAfterRedirect(n),u.emit(je.ERROR,"redirect",o);return}}}async cleanUrlAfterRedirect(n){const u=co(n).href;for(window.history.replaceState(null,"",u);window.location.href!==u;)await new Promise(o=>{setTimeout(()=>o(),1)})}}function En(s){return typeof s.oidcIssuer=="string"}function Fn(s){return typeof s.redirectUrl=="string"}class da{constructor(n,u,o,c){this.storageUtility=n,this.oidcHandler=u,this.issuerConfigFetcher=o,this.clientRegistrar=c,this.storageUtility=n,this.oidcHandler=u,this.issuerConfigFetcher=o,this.clientRegistrar=c}async canHandle(n){return En(n)&&Fn(n)}async handle(n){if(!En(n))throw new Dr(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(n)}`);if(!Fn(n))throw new Dr(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(n)}`);const u=await this.issuerConfigFetcher.fetchConfig(n.oidcIssuer),o=await bo(n,u,this.storageUtility,this.clientRegistrar),c={issuer:u.issuer,dpop:n.tokenType.toLowerCase()==="dpop",...n,issuerConfiguration:u,client:o};return this.oidcHandler.handle(c)}}class fa extends ho{async handle(n){var u;const o={authority:n.issuer.toString(),client_id:n.client.clientId,client_secret:n.client.clientSecret,redirect_uri:n.redirectUrl,response_type:"code",scope:ao,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(u=n.prompt)!==null&&u!==void 0?u:"consent"},c=new Lr.OidcClient(o);try{const v=await c.createSigninRequest();return await this.handleRedirect({oidcLoginOptions:n,state:v.state._id,codeVerifier:v.state._code_verifier,targetUrl:v.url.toString()})}catch(v){console.error(v)}}}const ga=".well-known/openid-configuration",An={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},end_session_endpoint:{toKey:"endSessionEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function pa(s){const n={};return Object.keys(s).forEach(u=>{An[u]&&(n[An[u].toKey]=s[u])}),Array.isArray(n.scopesSupported)||(n.scopesSupported=["openid"]),n}class qr{constructor(n){this.storageUtility=n,this.storageUtility=n}static getLocalStorageKey(n){return`issuerConfig:${n}`}async fetchConfig(n){let u;const o=new URL(ga,n.endsWith("/")?n:`${n}/`).href,c=await fetch(o);try{u=pa(await c.json())}catch(v){throw new Dr(`[${n.toString()}] has an invalid configuration: ${v.message}`)}return await this.storageUtility.set(qr.getLocalStorageKey(n),JSON.stringify(u)),u}}async function ya(s,n){await Mn(s,n),await ca()}class va extends po{async get(n){const[u,o,c,v,l,w,S,d]=await Promise.all([this.storageUtility.getForUser(n,"isLoggedIn",{secure:!0}),this.storageUtility.getForUser(n,"webId",{secure:!0}),this.storageUtility.getForUser(n,"clientId",{secure:!1}),this.storageUtility.getForUser(n,"clientSecret",{secure:!1}),this.storageUtility.getForUser(n,"redirectUrl",{secure:!1}),this.storageUtility.getForUser(n,"refreshToken",{secure:!0}),this.storageUtility.getForUser(n,"issuer",{secure:!1}),this.storageUtility.getForUser(n,"tokenType",{secure:!1})]);if(typeof l=="string"&&!On(l)){await Promise.all([this.storageUtility.deleteAllUserData(n,{secure:!1}),this.storageUtility.deleteAllUserData(n,{secure:!0})]);return}if(d!==void 0&&!mo(d))throw new Error(`Tokens of type [${d}] are not supported.`);if(!(c===void 0&&u===void 0&&o===void 0&&w===void 0))return{sessionId:n,webId:o,isLoggedIn:u==="true",redirectUrl:l,refreshToken:w,issuer:S,clientAppId:c,clientAppSecret:v,tokenType:d??"DPoP"}}async clear(n){return ya(n,this.storageUtility)}}class ma{async canHandle(n){try{return new URL(n),!0}catch(u){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${u}`)}}async handle(n){return Hn()}}class _a{constructor(n,u,o,c,v){this.storageUtility=n,this.sessionInfoManager=u,this.issuerConfigFetcher=o,this.clientRegistrar=c,this.tokerRefresher=v,this.storageUtility=n,this.sessionInfoManager=u,this.issuerConfigFetcher=o,this.clientRegistrar=c,this.tokerRefresher=v}async canHandle(n){try{const u=new URL(n);return u.searchParams.get("code")!==null&&u.searchParams.get("state")!==null}catch(u){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${u}`)}}async handle(n,u){if(!await this.canHandle(n))throw new Error(`AuthCodeRedirectHandler cannot handle [${n}]: it is missing one of [code, state].`);const o=new URL(n),c=o.searchParams.get("state"),v=await this.storageUtility.getForUser(c,"sessionId",{errorIfNull:!0}),{issuerConfig:l,codeVerifier:w,redirectUrl:S,dpop:d}=await jn(v,this.storageUtility,this.issuerConfigFetcher),f=o.searchParams.get("iss");if(typeof f=="string"&&f!==l.issuer)throw new Error(`The value of the iss parameter (${f}) does not match the issuer identifier of the authorization server (${l.issuer}). See [rfc9207](https://www.rfc-editor.org/rfc/rfc9207.html#section-2.3-3.1.1)`);if(w===void 0)throw new Error(`The code verifier for session ${v} is missing from storage.`);if(S===void 0)throw new Error(`The redirect URL for session ${v} is missing from storage.`);const h=await this.clientRegistrar.getClient({sessionId:v},l),b=Date.now(),I=await oa(l,h,{grantType:"authorization_code",code:o.searchParams.get("code"),codeVerifier:w,redirectUrl:S},d);window.localStorage.removeItem(`oidc.${c}`);let P;I.refreshToken!==void 0&&(P={sessionId:v,refreshToken:I.refreshToken,tokenRefresher:this.tokerRefresher});const K=await Do(I.accessToken,{dpopKey:I.dpopKey,refreshOptions:P,eventEmitter:u,expiresIn:I.expiresIn});await this.storageUtility.setForUser(v,{webId:I.webId,isLoggedIn:"true"},{secure:!0});const L=await this.sessionInfoManager.get(v);if(!L)throw new Error(`Could not retrieve session: [${v}].`);return Object.assign(L,{fetch:K,getLogoutUrl:vo({idTokenHint:I.idToken,endSessionEndpoint:l.endSessionEndpoint}),expirationDate:typeof I.expiresIn=="number"?b+I.expiresIn*1e3:void 0})}}class Sa extends uo{constructor(n){super(n)}}class wa{get storage(){return window.localStorage}async get(n){return this.storage.getItem(n)||void 0}async set(n,u){this.storage.setItem(n,u)}async delete(n){this.storage.removeItem(n)}}class ba{redirect(n,u){u&&u.handleRedirect?u.handleRedirect(n):u&&u.redirectByReplacingState?window.history.replaceState({},"",n):window.location.href=n}}class Ea{constructor(n){this.storageUtility=n,this.storageUtility=n}async getClient(n,u){const[o,c,v,l]=await Promise.all([this.storageUtility.getForUser(n.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(n.sessionId,"clientSecret",{secure:!1}),this.storageUtility.getForUser(n.sessionId,"clientName",{secure:!1}),this.storageUtility.getForUser(n.sessionId,"clientType",{secure:!1})]);if(o&&wo(l))return{clientId:o,clientSecret:c,clientName:v,clientType:l};try{const w=await Ys(n,u),S={clientId:w.clientId,clientType:"dynamic"};return w.clientSecret&&(S.clientSecret=w.clientSecret),w.idTokenSignedResponseAlg&&(S.idTokenSignedResponseAlg=w.idTokenSignedResponseAlg),await this.storageUtility.setForUser(n.sessionId,S,{secure:!1}),w}catch(w){throw new Error(`Client registration failed: [${w}]`)}}}class Fa{async canHandle(n){try{return new URL(n).searchParams.has("error")}catch(u){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${u}`)}}async handle(n,u){if(u!==void 0){const o=new URL(n),c=o.searchParams.get("error"),v=o.searchParams.get("error_description");u.emit(je.ERROR,c,v)}return Hn()}}class Aa{constructor(n,u,o){this.storageUtility=n,this.issuerConfigFetcher=u,this.clientRegistrar=o,this.storageUtility=n,this.issuerConfigFetcher=u,this.clientRegistrar=o}async refresh(n,u,o,c){const v=await jn(n,this.storageUtility,this.issuerConfigFetcher),l=await this.clientRegistrar.getClient({sessionId:n},v.issuerConfig);if(u===void 0)throw new Error(`Session [${n}] has no refresh token to allow it to refresh its access token.`);if(v.dpop&&o===void 0)throw new Error(`For session [${n}], the key bound to the DPoP access token must be provided to refresh said access token.`);const w=await aa(u,v.issuerConfig,l,o);return w.refreshToken!==void 0&&(c==null||c.emit(je.NEW_REFRESH_TOKEN,w.refreshToken),await this.storageUtility.setForUser(n,{refreshToken:w.refreshToken})),w}}function xn(s){const n=new Ao,u=s.secureStorage||n,o=s.insecureStorage||new wa,c=new ha(u,o),v=new qr(c),l=new Ea(c),w=new va(c),S=new Aa(c,v,l),d=new ba,f=new da(c,new fa(c,d),v,l),h=new Sa([new Fa,new _a(c,w,v,l,S),new ma]);return new la(f,h,new go(w,d),w,v)}const Ir=`${Nn}currentSession`,Hr=`${Nn}currentUrl`;async function xa(s,n,u){var o;const c=await n.validateCurrentSession(s);return c!==null?(window.localStorage.setItem(Hr,window.location.href),await n.login({sessionId:s,prompt:"none",oidcIssuer:c.issuer,redirectUrl:c.redirectUrl,clientId:c.clientAppId,clientSecret:c.clientAppSecret,tokenType:(o=c.tokenType)!==null&&o!==void 0?o:"DPoP"},u.events),!0):!1}function Pa(s){return!!(s!=null&&s.isLoggedIn)}class Ta{constructor(n={},u=void 0){this.tokenRequestInProgress=!1,this.login=async o=>{var c;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...o,tokenType:(c=o.tokenType)!==null&&c!==void 0?c:"DPoP"},this.events),new Promise(()=>{})},this.fetch=(o,c)=>this.clientAuthentication.fetch(o,c),this.internalLogout=async(o,c)=>{window.localStorage.removeItem(Ir),await this.clientAuthentication.logout(this.info.sessionId,c),this.info.isLoggedIn=!1,o&&this.events.emit(je.LOGOUT)},this.logout=async o=>this.internalLogout(!0,o),this.handleIncomingRedirect=async(o={})=>{var c;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const v=typeof o=="string"?{url:o}:o,l=(c=v.url)!==null&&c!==void 0?c:window.location.href;this.tokenRequestInProgress=!0;const w=await this.clientAuthentication.handleIncomingRedirect(l,this.events);if(Pa(w)){this.setSessionInfo(w);const S=window.localStorage.getItem(Hr);S===null?this.events.emit(je.LOGIN):(window.localStorage.removeItem(Hr),this.events.emit(je.SESSION_RESTORED,S))}else if(v.restorePreviousSession===!0){const S=window.localStorage.getItem(Ir);if(S!==null&&await xa(S,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,w},this.events=new Ko,n.clientAuthentication?this.clientAuthentication=n.clientAuthentication:n.secureStorage&&n.insecureStorage?this.clientAuthentication=xn({secureStorage:n.secureStorage,insecureStorage:n.insecureStorage}):this.clientAuthentication=xn({}),n.sessionInfo?this.info={sessionId:n.sessionInfo.sessionId,isLoggedIn:!1,webId:n.sessionInfo.webId}:this.info={sessionId:u??jr(),isLoggedIn:!1},this.events.on(je.LOGIN,()=>window.localStorage.setItem(Ir,this.info.sessionId)),this.events.on(je.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.events.on(je.ERROR,()=>this.internalLogout(!1))}setSessionInfo(n){this.info.isLoggedIn=n.isLoggedIn,this.info.webId=n.webId,this.info.sessionId=n.sessionId,this.info.expirationDate=n.expirationDate,this.events.on(je.SESSION_EXTENDED,u=>{this.info.expirationDate=Date.now()+u*1e3})}}let Ur;function er(){return typeof Ur>"u"&&(Ur=new Ta),Ur}const ja=(...s)=>er().fetch(...s),Ka=(...s)=>er().login(...s),Va=(...s)=>er().logout(...s),Ja=(...s)=>er().handleIncomingRedirect(...s),Wa=()=>er().events;export{Wa as events,ja as fetch,Ja as handleIncomingRedirect,Ka as login,Va as logout};
